window.BabylonToolkitLicense = "I-ABCDEF12345";

// Xbox Project Shim Services
var EnableXboxLiveServices=!0

// babylon.toolkit.js
var __extends,BABYLON;!function(n){var i=function(){function n(n){this.motion=n.motion;this.posX=n.posX||0;this.posY=n.posY;this.weight=n.weight||0}return n.GetIdleBlendTree=function(n){for(var i,t=0,r=n;t<r.length;t++)if(i=r[t],0===i.posX&&0===i.posY)return i;return null},n.GetDefaultIdleBlendTree=function(){return n.DefaultIdleBlendTree},n.DefaultIdleBlendTree=new n({motion:"Idle",posX:0,posY:0}),n}(),t,r;n.BlendTreeValue=i;t=function(){function t(){}return t.ZCross=function(n,t){return n.x*t.y-t.x*n.y},t.ClampValue=function(n,t,i){return n<=t?t:n>=i?i:n},t.ClampVector=function(i,r,u){var f=n.Vector3.Zero();return t.ClampVectorToRef(i,r,u,f),f},t.ClampVectorToRef=function(n,i,r,u){null!=u&&(u.x=t.ClampValue(n.x,i,r),u.y=t.ClampValue(n.y,i,r),u.z=t.ClampValue(n.z,i,r))},t.GetSignedAngle=function(n,t){return Math.atan2(n.x*t.y-n.y*t.x,n.x*t.x+n.y*t.y)},t.GetBarycentricVector=function(i,r,u,f){var e=n.Vector3.Zero();return t.GetBarycentricVectorToRef(i,r,u,f,e),e},t.GetBarycentricVectorToRef=function(n,i,r,u,f){t.TempVector2_AB.set(0,0);t.TempVector2_AB.set(0,0);t.TempVector2_AB.set(0,0);r.subtractToRef(i,t.TempVector2_AB);u.subtractToRef(i,t.TempVector2_AC);n.subtractToRef(i,t.TempVector2_AP);var e=1/t.ZCross(t.TempVector2_AB,t.TempVector2_AC),o=e*t.ZCross(t.TempVector2_AB,t.TempVector2_AP),s=e*t.ZCross(t.TempVector2_AP,t.TempVector2_AC),h=1-o-s;null!=f&&(f.x=h,f.y=o,f.z=s)},t.GetLinearInterpolation=function(n,t,i,r,u){return t+(u-n)*((r-t)/(i-n))},t.TempVector2_AB=new n.Vector2(0,0),t.TempVector2_AC=new n.Vector2(0,0),t.TempVector2_AP=new n.Vector2(0,0),t}();n.BlendTreeUtils=t;r=function(){function r(){}return r.Calculate1DSimpleBlend=function(n,i){var f=i[0],e=i[i.length-1];if(n<=f.posY)f.weight=1;else if(n>=e.posY)e.weight=1;else{var o=r.GetRightNeighbourBlendTreeIndex(n,i),u=i[o-1],s=i[o],h=t.GetLinearInterpolation(u.posY,1,s.posY,0,n);u.weight=h;s.weight=1-u.weight}},r.Calculate2DSimpleDirectional=function(n,u,f){var l,o,y,s,e,h,a,c;for(r.TempVector2_IP.set(n,u),r.TempVector2_TA.set(0,0),r.TempVector2_TB.set(0,0),r.TempVector2_TC.set(0,0),r.TempVector3_BARY.set(0,0,0),l=!0,o=i.GetIdleBlendTree(f),o?(y=f.indexOf(o),f.splice(y,1)):(l=!1,o=i.GetDefaultIdleBlendTree()),f.sort(function(n,t){return Math.atan2(n.posY,n.posX)-Math.atan2(t.posY,t.posX)}),f.unshift(o),s=0,e=2;e<f.length;++e)r.TempVector2_TB.set(f[e-1].posX,f[e-1].posY),r.TempVector2_TC.set(f[e].posX,f[e].posY),t.GetBarycentricVectorToRef(r.TempVector2_IP,r.TempVector2_TA,r.TempVector2_TB,r.TempVector2_TC,r.TempVector3_BARY),t.ClampVectorToRef(r.TempVector3_BARY,0,1,r.TempVector3_BARY),r.TempVector3_BARY.z>0&&r.TempVector3_BARY.y>0&&(f[0].weight+=r.TempVector3_BARY.x,f[e-1].weight+=r.TempVector3_BARY.z,f[e].weight+=r.TempVector3_BARY.y,s+=r.TempVector3_BARY.x+r.TempVector3_BARY.y+r.TempVector3_BARY.z);for(r.TempVector2_TB.set(f[f.length-1].posX,f[f.length-1].posY),r.TempVector2_TC.set(f[1].posX,f[1].posY),t.GetBarycentricVectorToRef(r.TempVector2_IP,r.TempVector2_TA,r.TempVector2_TB,r.TempVector2_TC,r.TempVector3_BARY),t.ClampVectorToRef(r.TempVector3_BARY,0,1,r.TempVector3_BARY),r.TempVector3_BARY.z>0&&r.TempVector3_BARY.y>0&&(f[0].weight+=r.TempVector3_BARY.x,f[f.length-1].weight+=r.TempVector3_BARY.z,f[1].weight+=r.TempVector3_BARY.y,s+=r.TempVector3_BARY.x+r.TempVector3_BARY.y+r.TempVector3_BARY.z),h=0,a=f;h<a.length;h++)c=a[h],c.weight/=s;if(!l){f.shift();for(var w=o.weight/f.length,v=0,p=f;v<p.length;v++)c=p[v],c.weight+=w}},r.Calculate2DFreeformDirectional=function(i,u,f){var k,o,l,v,e;r.TempVector2_IP.set(i,u);r.TempVector2_POSI.set(0,0);r.TempVector2_POSJ.set(0,0);r.TempVector2_POSIP.set(0,0);r.TempVector2_POSIJ.set(0,0);for(var y=2,p=0,d=r.TempVector2_IP.length(),h=0;h<f.length;++h){e=f[h];r.TempVector2_POSI.set(e.posX,e.posY);for(var a=r.TempVector2_POSI.length(),g=d-a,nt=t.GetSignedAngle(r.TempVector2_POSI,r.TempVector2_IP),c=1,s=0;s<f.length;++s)if(s!==h){r.TempVector2_POSJ.set(f[s].posX,f[s].posY);var w=r.TempVector2_POSJ.length(),b=(a+w)/2,tt=g/b,it=(w-a)/b,rt=t.GetSignedAngle(r.TempVector2_POSI,r.TempVector2_POSJ);r.TempVector2_POSIP.set(tt,nt*y);r.TempVector2_POSIJ.set(it,rt*y);k=r.TempVector2_POSIJ.lengthSquared();o=n.Vector2.Dot(r.TempVector2_POSIP,r.TempVector2_POSIJ)/k;o=1-o;o=t.ClampValue(o,0,1);c=Math.min(o,c)}e.weight=c;p+=c}for(l=0,v=f;l<v.length;l++)e=v[l],e.weight/=p},r.Calculate2DFreeformCartesian=function(i,u,f){var a,h,c,o,y,s,l,v,e;for(r.TempVector2_IP.set(i,u),r.TempVector2_POSI.set(0,0),r.TempVector2_POSJ.set(0,0),r.TempVector2_POSIP.set(0,0),r.TempVector2_POSIJ.set(0,0),a=0,h=0;h<f.length;++h){for(e=f[h],r.TempVector2_POSI.set(e.posX,e.posY),r.TempVector2_IP.subtractToRef(r.TempVector2_POSI,r.TempVector2_POSIP),c=1,o=0;o<f.length;++o)o!==h&&(r.TempVector2_POSJ.set(f[o].posX,f[o].posY),r.TempVector2_POSJ.subtractToRef(r.TempVector2_POSI,r.TempVector2_POSIJ),y=r.TempVector2_POSIJ.lengthSquared(),s=n.Vector2.Dot(r.TempVector2_POSIP,r.TempVector2_POSIJ)/y,s=1-s,s=t.ClampValue(s,0,1),c=Math.min(c,s));e.weight=c;a+=c}for(l=0,v=f;l<v.length;l++)e=v[l],e.weight/=a},r.GetRightNeighbourBlendTreeIndex=function(n,t){t.sort(function(n,t){return n.posY-t.posY});for(var i=0;i<t.length;++i)if(t[i].posY>n)return i;return-1},r.TempVector2_IP=new n.Vector2(0,0),r.TempVector2_TA=new n.Vector2(0,0),r.TempVector2_TB=new n.Vector2(0,0),r.TempVector2_TC=new n.Vector2(0,0),r.TempVector2_POSI=new n.Vector2(0,0),r.TempVector2_POSJ=new n.Vector2(0,0),r.TempVector2_POSIP=new n.Vector2(0,0),r.TempVector2_POSIJ=new n.Vector2(0,0),r.TempVector3_BARY=new n.Vector3(0,0,0),r}();n.BlendTreeSystem=r}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(n){function t(t,i,r){return void 0===r&&(r={}),n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.start=function(){this.initAnimationState()},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t.prototype.initAnimationState=function(){console.warn("Dump Animation State Machine: "+this.transform.name);console.log(this)},t}(n.ScriptComponent);n.AnimationState=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(t){function i(n,i,r){void 0===r&&(r={});var u=t.call(this,n,i,r)||this;return u._audio=null,u._name=null,u._file=null,u._loop=!1,u._mute=!1,u._volume=1,u._pitch=1,u._priority=128,u._panstereo=0,u._mindistance=1,u._maxdistance=50,u._rolloffmode="linear",u._rollofffactor=1,u._playonawake=!0,u._spatialblend=0,u._reverbzonemix=1,u._bypasseffects=!1,u._bypassreverbzones=!1,u._bypasslistenereffects=!1,u._name=u.getEditorProperty("name",u._name),u._file=u.getEditorProperty("file",u._file),u._loop=u.getEditorProperty("loop",u._loop),u._mute=u.getEditorProperty("mute",u._mute),u._volume=u.getEditorProperty("volume",u._volume),u._pitch=u.getEditorProperty("pitch",u._pitch),u._priority=u.getEditorProperty("priority",u._priority),u._panstereo=u.getEditorProperty("panstereo",u._panstereo),u._playonawake=u.getEditorProperty("playonawake",u._playonawake),u._mindistance=u.getEditorProperty("mindistance",u._mindistance),u._maxdistance=u.getEditorProperty("maxdistance",u._maxdistance),u._rolloffmode=u.getEditorProperty("rolloffmode",u._rolloffmode),u._rollofffactor=u.getEditorProperty("rollofffactor",u._rollofffactor),u._spatialblend=u.getEditorProperty("spatialblend",u._spatialblend),u._reverbzonemix=u.getEditorProperty("reverbzonemix",u._reverbzonemix),u._bypasseffects=u.getEditorProperty("bypasseffects",u._bypasseffects),u._bypassreverbzones=u.getEditorProperty("bypassreverbzones",u._bypassreverbzones),u._bypasslistenereffects=u.getEditorProperty("bypasslistenereffects",u._bypasslistenereffects),u}return __extends(i,t),i.prototype.getSoundClip=function(){return this._audio},i.prototype.start=function(){this.initAudioSource()},i.prototype.destroy=function(){this.destroyAudioSource()},i.prototype.initAudioSource=function(){var t=this;if(null!=this._name&&""!==this._name||(this._name="Unknown"),null!=this._file&&""!==this._file){var r=n.SceneManager.GetRootUrl(this.scene),i=this._spatialblend>=.1,u="logarithmic"===this._rolloffmode?"exponential":"linear";this._audio=new n.Sound(this._name,r+this._file,this.scene,function(){t._audio.setVolume(t._mute===!0?0:t._volume);t._audio.setPlaybackRate(t._pitch)},{loop:this._loop,autoplay:this._playonawake,refDistance:this._mindistance,maxDistance:this._maxdistance,rolloffFactor:this._rollofffactor,spatialSound:i,distanceModel:u});this._audio.setPosition(this.transform.position.clone());i===!0&&this._audio.attachToMesh(this.transform)}},i.prototype.destroyAudioSource=function(){null!=this._audio&&(this._audio.dispose(),this._audio=null)},i}(n.ScriptComponent);n.AudioSource=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(t){function i(i,r,u){void 0===u&&(u={});var f=t.call(this,i,r,u)||this;return f.cameraType=0,f.mainCamera=!1,f.virtualReality=null,f.multiPlayerSetup=null,f.m_cameraRig=null,f.mainCamera="MainCamera"===f.getTransformTag(),f.cameraType=f.getEditorProperty("mainCameraType",f.cameraType),f.virtualReality=f.getEditorProperty("webVirtualReality",f.virtualReality),f.multiPlayerSetup=f.getEditorProperty("multiPlayerSetup",f.multiPlayerSetup),null!=f.multiPlayerSetup&&(n.UniversalCameraSystem.startupMode=f.multiPlayerSetup.playerStartupMode,n.UniversalCameraSystem.stereoCameras=f.multiPlayerSetup.stereoSideBySide),f}return __extends(i,t),i.prototype.isMainCamera=function(){return this.mainCamera},i.prototype.getCameraType=function(){return this.cameraType},i.prototype.start=function(){this.initCameraSystemState()},i.prototype.update=function(){this.updateCameraSystemState()},i.prototype.destroy=function(){this.destroyCameraSystemState()},i.prototype.initCameraSystemState=function(){var s,h,c,l,e,f,o,a,t,v,i,y,r,p,u;(n.Utilities.ValidateTransformQuaternion(this.transform),this.m_cameraRig=this.getCameraRig(),null!=this.m_cameraRig)&&(0===this.cameraType?null==n.UniversalCameraSystem.PlayerOneCamera&&(n.UniversalCameraSystem.PlayerOneCamera=this.m_cameraRig,n.UniversalCameraSystem.PlayerOneCamera.inertia=1):1===this.cameraType?null!=this.virtualReality&&this.virtualReality.experienceHelper===!0&&(s=!1,h=null,this.virtualReality.useCustomButton===!0&&null!=this.virtualReality.buttonElementID&&""!==this.virtualReality.buttonElementID&&(c=document.getElementById(this.virtualReality.buttonElementID),null!=c?(s=!0,h=c):n.Tools.Warn("Babylon.js failed to locate webvr button element id: "+this.virtualReality.buttonElementID)),l=null,e=null,null!=this.virtualReality.floorMeshesTags&&""!==this.virtualReality.floorMeshesTags||(this.virtualReality.floorMeshesTags="Navigation"),this.virtualReality.enableTeleportation===!0&&(e=this.scene.getMeshesByTags(this.virtualReality.floorMeshesTags)),l=this.virtualReality.enableTeleportation===!0&&null!=e&&e.length>0?{createDeviceOrientationCamera:1===this.virtualReality.defaultCamera,createFallbackVRDeviceOrientationFreeCamera:this.virtualReality.fallbackCamera,laserToggle:this.virtualReality.displayLaserBeam,useCustomVRButton:s,customVRButton:h,rayLength:this.virtualReality.rayCastLength,defaultHeight:this.virtualReality.defaultHeight,positionScale:this.virtualReality.positionScale,floorMeshes:e}:{createDeviceOrientationCamera:1===this.virtualReality.defaultCamera,createFallbackVRDeviceOrientationFreeCamera:this.virtualReality.fallbackCamera,laserToggle:this.virtualReality.displayLaserBeam,useCustomVRButton:s,customVRButton:h,rayLength:this.virtualReality.rayCastLength,defaultHeight:this.virtualReality.defaultHeight,positionScale:this.virtualReality.positionScale},n.UniversalCameraSystem.DefaultControllers=!0,f=this.scene.createDefaultVRExperience(l),null!=f&&(f.displayGaze=this.virtualReality.displayGazeIcon,this.virtualReality.enableInteractions===!0&&f.enableInteractions(),f.onControllerMeshLoadedObservable.add(function(t){"left"===t.hand?n.UniversalCameraSystem.LeftControllerStick=t:"right"===t.hand&&(n.UniversalCameraSystem.RightControllerStick=t)})),n.UniversalCameraSystem.VrCameraHelper=f):2===this.cameraType&&(o=this.m_cameraRig.name,null==n.UniversalCameraSystem.PlayerOneCamera&&(a=o+".1",t=this.m_cameraRig.clone(a),t.name=a,t.parent=null,t.position=this.transform.position.clone(),t.rotationQuaternion=this.transform.rotationQuaternion.clone(),t.viewport=new n.Viewport(0,0,0,0),t.setEnabled(!1),n.UniversalCameraSystem.PlayerOneCamera=t,n.UniversalCameraSystem.PlayerOneCamera.inertia=1),null==n.UniversalCameraSystem.PlayerTwoCamera&&(v=o+".2",i=this.m_cameraRig.clone(v),i.name=v,i.parent=null,i.position=this.transform.position.clone(),i.rotationQuaternion=this.transform.rotationQuaternion.clone(),i.viewport=new n.Viewport(0,0,0,0),i.setEnabled(!1),n.UniversalCameraSystem.PlayerTwoCamera=i,n.UniversalCameraSystem.PlayerTwoCamera.inertia=1),null==n.UniversalCameraSystem.PlayerThreeCamera&&(y=o+".3",r=this.m_cameraRig.clone(y),r.name=y,r.parent=null,r.position=this.transform.position.clone(),r.rotationQuaternion=this.transform.rotationQuaternion.clone(),r.viewport=new n.Viewport(0,0,0,0),r.setEnabled(!1),n.UniversalCameraSystem.PlayerThreeCamera=r,n.UniversalCameraSystem.PlayerThreeCamera.inertia=1),null==n.UniversalCameraSystem.PlayerFourCamera&&(p=o+".4",u=this.m_cameraRig.clone(p),u.name=p,u.parent=null,u.position=this.transform.position.clone(),u.rotationQuaternion=this.transform.rotationQuaternion.clone(),u.viewport=new n.Viewport(0,0,0,0),u.setEnabled(!1),n.UniversalCameraSystem.PlayerFourCamera=u,n.UniversalCameraSystem.PlayerFourCamera.inertia=1),n.UniversalCameraSystem.multiPlayerView=!0,n.UniversalCameraSystem.SetMultiPlayerViewLayout(this.scene,n.UniversalCameraSystem.startupMode)))},i.prototype.updateCameraSystemState=function(){null!=this.m_cameraRig&&(0===this.cameraType||1===this.cameraType||2===this.cameraType)},i.prototype.destroyCameraSystemState=function(){this.virtualReality=null},i.GetPlayerCamera=function(t){return n.UniversalCameraSystem.IsMultiPlayerView()?t===n.PlayerNumber.One?n.UniversalCameraSystem.PlayerOneCamera:t===n.PlayerNumber.Two?n.UniversalCameraSystem.PlayerTwoCamera:t===n.PlayerNumber.Three?n.UniversalCameraSystem.PlayerThreeCamera:t===n.PlayerNumber.Four?n.UniversalCameraSystem.PlayerFourCamera:null:t===n.PlayerNumber.One?null!=n.UniversalCameraSystem.WebVR?n.UniversalCameraSystem.WebVR.currentVRCamera:n.UniversalCameraSystem.PlayerOneCamera:(n.Tools.Warn("Babylon.js multi player camera not available for player: "+t),null)},Object.defineProperty(i,"WebVR",{get:function(){return n.UniversalCameraSystem.VrCameraHelper},enumerable:!0,configurable:!0}),i.GetWebVRLeftController=function(){return n.UniversalCameraSystem.LeftControllerStick},i.GetWebVRRightController=function(){return n.UniversalCameraSystem.RightControllerStick},i.GetWebVRLeftControllerPrefab=function(){return n.UniversalCameraSystem.LeftControllerPrefab},i.GetWebVRRightControllerPrefab=function(){return n.UniversalCameraSystem.RightControllerPrefab},i.ShowWebVRDefaultControllers=function(t,i){void 0===t&&(t=null);void 0===i&&(i=null);null!=n.UniversalCameraSystem.LeftControllerStick&&(n.UniversalCameraSystem.LeftControllerStick.mesh.setEnabled(!1),n.UniversalCameraSystem.LeftControllerStick.attachToMesh(n.UniversalCameraSystem.LeftControllerStick.defaultModel),n.UniversalCameraSystem.LeftControllerStick.mesh.setEnabled(!0),n.UniversalCameraSystem.DefaultControllers=!0);null!=n.UniversalCameraSystem.RightControllerStick&&(n.UniversalCameraSystem.RightControllerStick.mesh.setEnabled(!1),n.UniversalCameraSystem.RightControllerStick.attachToMesh(n.UniversalCameraSystem.RightControllerStick.defaultModel),n.UniversalCameraSystem.RightControllerStick.mesh.setEnabled(!0),n.UniversalCameraSystem.DefaultControllers=!0);null!=n.UniversalCameraSystem.WebVR&&(null!=t&&(n.UniversalCameraSystem.WebVR.displayGaze=t),null!=i&&(n.UniversalCameraSystem.WebVR.displayLaserPointer=i))},i.ShowWebVRCustomControllers=function(t,i){void 0===t&&(t=null);void 0===i&&(i=null);null!=n.UniversalCameraSystem.LeftControllerStick&&(n.UniversalCameraSystem.LeftControllerStick.mesh.setEnabled(!1),n.UniversalCameraSystem.LeftControllerStick.attachToMesh(n.UniversalCameraSystem.LeftControllerPrefab),n.UniversalCameraSystem.LeftControllerStick.mesh.setEnabled(!0),n.UniversalCameraSystem.DefaultControllers=!1);null!=n.UniversalCameraSystem.RightControllerStick&&(n.UniversalCameraSystem.RightControllerStick.mesh.setEnabled(!1),n.UniversalCameraSystem.RightControllerStick.attachToMesh(n.UniversalCameraSystem.RightControllerPrefab),n.UniversalCameraSystem.RightControllerStick.mesh.setEnabled(!0),n.UniversalCameraSystem.DefaultControllers=!1);null!=n.UniversalCameraSystem.WebVR&&(null!=t&&(n.UniversalCameraSystem.WebVR.displayGaze=t),null!=i&&(n.UniversalCameraSystem.WebVR.displayLaserPointer=i))},i.IsStereoCameras=function(){return n.UniversalCameraSystem.stereoCameras},i.IsMultiPlayerView=function(){return n.UniversalCameraSystem.multiPlayerView},i.GetMultiPlayerCount=function(){return n.UniversalCameraSystem.multiPlayerCount},i.ActivateMultiPlayerCameras=function(t){var i=!1;return null!=n.UniversalCameraSystem.multiPlayerCameras&&n.UniversalCameraSystem.multiPlayerCameras.length>0&&(t.activeCameras=n.UniversalCameraSystem.multiPlayerCameras,i=!0),i},i.DisposeMultiPlayerCameras=function(){null!=n.UniversalCameraSystem.PlayerOneCamera&&(n.UniversalCameraSystem.PlayerOneCamera.dispose(),n.UniversalCameraSystem.PlayerOneCamera=null);null!=n.UniversalCameraSystem.PlayerTwoCamera&&(n.UniversalCameraSystem.PlayerTwoCamera.dispose(),n.UniversalCameraSystem.PlayerTwoCamera=null);null!=n.UniversalCameraSystem.PlayerThreeCamera&&(n.UniversalCameraSystem.PlayerThreeCamera.dispose(),n.UniversalCameraSystem.PlayerThreeCamera=null);null!=n.UniversalCameraSystem.PlayerFourCamera&&(n.UniversalCameraSystem.PlayerFourCamera.dispose(),n.UniversalCameraSystem.PlayerFourCamera=null)},i.SetMultiPlayerViewLayout=function(t,i){var u=!1,r=n.Scalar.Clamp(i,1,4);return n.UniversalCameraSystem.IsMultiPlayerView()?(null!=n.UniversalCameraSystem.PlayerOneCamera&&null!=n.UniversalCameraSystem.PlayerTwoCamera&&null!=n.UniversalCameraSystem.PlayerThreeCamera&&null!=n.UniversalCameraSystem.PlayerFourCamera?(n.UniversalCameraSystem.multiPlayerCameras=[],1===r?(n.UniversalCameraSystem.PlayerOneCamera.viewport=new n.Viewport(0,0,1,1),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new n.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!1),n.UniversalCameraSystem.PlayerThreeCamera.viewport=new n.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!1),n.UniversalCameraSystem.PlayerFourCamera.viewport=new n.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerOneCamera)):2===r?(n.UniversalCameraSystem.stereoCameras===!0?(n.UniversalCameraSystem.PlayerOneCamera.viewport=new n.Viewport(0,0,.5,1),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new n.Viewport(.5,0,.5,1)):(n.UniversalCameraSystem.PlayerOneCamera.viewport=new n.Viewport(0,.5,1,.5),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new n.Viewport(0,0,1,.5)),n.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerThreeCamera.viewport=new n.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!1),n.UniversalCameraSystem.PlayerFourCamera.viewport=new n.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerOneCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerTwoCamera)):3===r?(n.UniversalCameraSystem.PlayerOneCamera.viewport=new n.Viewport(0,0,.5,1),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new n.Viewport(.5,.5,.5,.5),n.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerThreeCamera.viewport=new n.Viewport(.5,0,.5,.5),n.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerFourCamera.viewport=new n.Viewport(0,0,0,0),n.UniversalCameraSystem.PlayerFourCamera.setEnabled(!1),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerOneCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerTwoCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerThreeCamera)):4===r?(n.UniversalCameraSystem.PlayerOneCamera.viewport=new n.Viewport(0,.5,.5,.5),n.UniversalCameraSystem.PlayerTwoCamera.viewport=new n.Viewport(0,0,.5,.5),n.UniversalCameraSystem.PlayerTwoCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerThreeCamera.viewport=new n.Viewport(.5,.5,.5,.5),n.UniversalCameraSystem.PlayerThreeCamera.setEnabled(!0),n.UniversalCameraSystem.PlayerFourCamera.viewport=new n.Viewport(.5,0,.5,.5),n.UniversalCameraSystem.PlayerFourCamera.setEnabled(!0),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerOneCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerTwoCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerThreeCamera),n.UniversalCameraSystem.multiPlayerCameras.push(n.UniversalCameraSystem.PlayerFourCamera)):n.Tools.Warn("Babylon.js camera rig invalid player count specified: "+r)):n.Tools.Warn("Babylon.js camera rig failed to initialize multi player cameras"),n.UniversalCameraSystem.multiPlayerCount=r,u=n.UniversalCameraSystem.ActivateMultiPlayerCameras(t),u===!1&&n.Tools.Warn("Babylon.js camera rig failed to initialize multi player views")):n.Tools.Warn("Babylon.js camera rig multi player view option not enabled"),u},i.VrCameraHelper=null,i.DefaultControllers=!0,i.LeftControllerStick=null,i.RightControllerStick=null,i.LeftControllerPrefab=null,i.RightControllerPrefab=null,i.PlayerOneCamera=null,i.PlayerTwoCamera=null,i.PlayerThreeCamera=null,i.PlayerFourCamera=null,i.multiPlayerView=!1,i.multiPlayerCount=1,i.multiPlayerCameras=null,i.stereoCameras=!0,i.startupMode=1,i}(n.ScriptComponent);n.UniversalCameraSystem=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(t){function i(i,r,u){void 0===u&&(u={});var f=t.call(this,i,r,u)||this;return f._abstractMesh=null,f._avatarRadius=.5,f._avatarHeight=2,f._skinWidth=.08,f._stepOffset=.3,f._slopeLimit=45,f._minMoveDistance=.001,f._isPhysicsReady=!1,f._maxCollisions=4,f._useGhostSweepTest=!1,f._tmpAmmoQuaternion=null,f._tmpOriginQuaternion=null,f._tmpRotateQuaternion=null,f._tmpBabylonQuaternion=null,f._tmpBabylonEulerVector=null,f._tmpCollisionContacts=null,f.m_character=null,f.m_ghostShape=null,f.m_ghostObject=null,f.m_ghostCollision=null,f.m_ghostTransform=null,f.m_ghostPosition=null,f.m_ghostRotation=null,f.m_startPosition=null,f.m_startRotation=null,f.m_startTransform=null,f.m_walkDirection=null,f.m_warpPosition=null,f.m_turningRate=0,f.m_moveDeltaX=0,f.m_moveDeltaZ=0,f.m_physicsEngine=null,f._onCollisionEnterObservable=new n.Observable,f._onCollisionStayObservable=new n.Observable,f._onCollisionExitObservable=new n.Observable,f._abstractMesh=f.getAbstractMesh(),f._avatarRadius=f.getEditorProperty("avatarRadius",f._avatarRadius),f._avatarHeight=f.getEditorProperty("avatarHeight",f._avatarHeight),f._skinWidth=f.getEditorProperty("skinWidth",f._skinWidth),f._slopeLimit=f.getEditorProperty("slopeLimit",f._slopeLimit),f._stepOffset=f.getEditorProperty("stepOffset",f._stepOffset),f._minMoveDistance=f.getEditorProperty("minMoveDistance",f._minMoveDistance),f._useGhostSweepTest=f.getEditorProperty("useGhostSweepTest",f._useGhostSweepTest),f._tmpAmmoQuaternion=new Ammo.btQuaternion(0,0,0,1),f._tmpOriginQuaternion=new Ammo.btQuaternion(0,0,0,1),f._tmpRotateQuaternion=new Ammo.btQuaternion(0,0,0,1),f._tmpBabylonQuaternion=new n.Quaternion(0,0,0,1),f._tmpBabylonEulerVector=new n.Vector3(0,0,0),f._tmpBabylonQuaternion=new n.Quaternion(0,0,0,1),f.m_warpPosition=new Ammo.btVector3(0,0,0),f.m_walkDirection=new Ammo.btVector3(0,0,0),f.m_physicsEngine=n.SceneManager.GetPhysicsEngine(f.scene),f.setMaxNotifications(f._maxCollisions),f}return __extends(i,t),i.prototype.getAvatarRadius=function(){return this._avatarRadius},i.prototype.getAvatarHeight=function(){return this._avatarHeight},i.prototype.getSkinWidth=function(){return this._skinWidth},i.prototype.getStepOffset=function(){return this._stepOffset},i.prototype.getUseSweepTest=function(){return this._useGhostSweepTest},i.prototype.getMinMoveDistance=function(){return this._minMoveDistance},i.prototype.setMinMoveDistance=function(n){this._minMoveDistance=n},i.prototype.getVerticalVelocity=function(){return null!=this.m_character&&this.m_character.getVerticalVelocity?this.m_character.getVerticalVelocity():0},i.prototype.setMaxJumpHeight=function(n){null!=this.m_character&&this.m_character.setMaxJumpHeight(n)},i.prototype.setFallingSpeed=function(n){null!=this.m_character&&this.m_character.setFallSpeed(n)},i.prototype.getSlopeLimit=function(){return null!=this.m_character?this.m_character.getMaxSlope():0},i.prototype.setSlopeLimit=function(n){null!=this.m_character&&this.m_character.setMaxSlope(n)},i.prototype.setUpAxis=function(n){null!=this.m_character&&this.m_character.setUpAxis(n)},i.prototype.getGravity=function(){return null!=this.m_character?this.m_character.getGravity():0},i.prototype.setGravity=function(n){null!=this.m_character&&this.m_character.setGravity(n)},i.prototype.isGrounded=function(){return null!=this.m_character&&this.m_character.onGround()},i.prototype.isReady=function(){return null!=this.m_character},i.prototype.canJump=function(){return null!=this.m_character&&this.m_character.canJump()},i.prototype.internalWarp=function(n){null!=this.m_character&&this.m_character.warp(n)},i.prototype.internalJump=function(){null!=this.m_character&&this.m_character.jump()},i.prototype.internalSetJumpSpeed=function(n){null!=this.m_character&&this.m_character.setJumpSpeed(n)},i.prototype.internalSetWalkDirection=function(n){null!=this.m_character&&this.m_character.setWalkDirection(n)},i.prototype.internalSetVelocityForTimeInterval=function(n,t){null!=this.m_character&&this.m_character.setVelocityForTimeInterval(n,t)},i.prototype.start=function(){this.initMovementState()},i.prototype.update=function(){this.updateMovementState()},i.prototype.after=function(){this.afterMovementState()},i.prototype.destroy=function(){this.destroyMovementState()},i.prototype.initMovementState=function(){n.Utilities.ValidateTransformQuaternion(this.transform);var t=n.SceneManager.GetPhysicsWorld(this.scene);null!=t?(this.m_startPosition=new Ammo.btVector3(this.transform.position.x,this.transform.position.y,this.transform.position.z),this.m_startRotation=new Ammo.btQuaternion(this.transform.rotationQuaternion.x,this.transform.rotationQuaternion.y,this.transform.rotationQuaternion.z,this.transform.rotationQuaternion.w),this.m_startTransform=new Ammo.btTransform,this.m_startTransform.setIdentity(),this.m_startTransform.setOrigin(this.m_startPosition),this.m_startTransform.setRotation(this.m_startRotation),this.m_ghostShape=new Ammo.btCapsuleShape(this._avatarRadius,.5*this._avatarHeight),this.m_ghostShape.setMargin(this._skinWidth),this.m_ghostObject=new Ammo.btPairCachingGhostObject,this.m_ghostObject.setWorldTransform(this.m_startTransform),this.m_ghostObject.setCollisionShape(this.m_ghostShape),this.m_ghostObject.setCollisionFlags(n.CollisionFlags.CF_CHARACTER_OBJECT),this.m_ghostCollision=Ammo.castObject(this.m_ghostObject,Ammo.btCollisionObject),this.m_ghostCollision.entity=this._abstractMesh,this.m_character=new Ammo.btKinematicCharacterController(this.m_ghostObject,this.m_ghostShape,this._stepOffset),this.m_character.setUseGhostSweepTest(this._useGhostSweepTest),this.m_character.setUpInterpolate(!0),this.m_character.setMaxSlope(this._slopeLimit*n.System.Deg2Rad),this.m_character.setGravity(n.System.Gravity3G),t.addCollisionObject(this.m_ghostObject,n.CollisionFilters.CharacterFilter,n.CollisionFilters.StaticFilter|n.CollisionFilters.DefaultFilter|n.CollisionFilters.CharacterFilter),t.addAction(this.m_character)):n.Tools.Warn("Null physics world detected. Failed to create character controller: "+this.transform.name);this._isPhysicsReady=null!=this.m_physicsEngine&&null!=this._tmpCollisionContacts&&null!=this.m_ghostObject&&null!=this._abstractMesh;this.updateMovementState();this.afterMovementState()},i.prototype.syncMovementState=function(){this._isPhysicsReady===!0&&(this.m_ghostTransform=this.m_ghostObject.getWorldTransform(),null!=this.m_ghostTransform?(this.m_ghostPosition=this.m_ghostTransform.getOrigin(),this.m_ghostRotation=this.m_ghostTransform.getRotation()):(this.m_ghostPosition=null,this.m_ghostRotation=null))},i.prototype.updateMovementState=function(){this.syncMovementState();this._isPhysicsReady===!0&&(0!==this.m_turningRate&&null!=this.m_ghostTransform&&null!=this.m_ghostRotation&&(this._tmpBabylonQuaternion.set(this.m_ghostRotation.x(),this.m_ghostRotation.y(),this.m_ghostRotation.z(),this.m_ghostRotation.w()),n.Utilities.ToEulerToRef(this._tmpBabylonQuaternion,this._tmpBabylonEulerVector),this._tmpBabylonEulerVector.y+=this.m_turningRate,n.Utilities.FromEulerToRef(this._tmpBabylonEulerVector.x,this._tmpBabylonEulerVector.y,this._tmpBabylonEulerVector.z,this._tmpBabylonQuaternion),this._tmpAmmoQuaternion.setValue(this._tmpBabylonQuaternion.x,this._tmpBabylonQuaternion.y,this._tmpBabylonQuaternion.z,this._tmpBabylonQuaternion.w),this.m_ghostTransform.setRotation(this._tmpAmmoQuaternion),this.m_ghostObject.setWorldTransform(this.m_ghostTransform)),null!=this.m_walkDirection&&this.internalSetWalkDirection(this.m_walkDirection))},i.prototype.afterMovementState=function(){this.syncMovementState();this._isPhysicsReady===!0&&(null!=this.m_ghostPosition&&this.transform.position.set(this.m_ghostPosition.x(),this.m_ghostPosition.y(),this.m_ghostPosition.z()),null!=this.m_ghostRotation&&this.transform.rotationQuaternion.set(this.m_ghostRotation.x(),this.m_ghostRotation.y(),this.m_ghostRotation.z(),this.m_ghostRotation.w()));this.parseGhostCollisionContacts()},i.prototype.parseGhostCollisionContacts=function(){var n,i,e,r,o,s,u,f,t;if(this._isPhysicsReady===!0){var h=this._onCollisionEnterObservable.hasObservers(),c=this._onCollisionStayObservable.hasObservers(),l=this._onCollisionExitObservable.hasObservers();if(h||c||l){for(n=0,n=0;n<this._tmpCollisionContacts.length;n++)this._tmpCollisionContacts[n].reset=!0;if(i=this.m_ghostObject.getNumOverlappingObjects(),i>this._maxCollisions&&(i=this._maxCollisions),i>0)for(n=0;n<i;n++)if(e=this.m_ghostObject.getOverlappingObject(n),null!=e&&(r=Ammo.castObject(e,Ammo.btCollisionObject),null!=r&&null!=r.entity&&r.isActive())){for(o=-1,s=r.entity,n=0;n<this._tmpCollisionContacts.length;n++)if(u=this._tmpCollisionContacts[n],null!=u.mesh&&u.mesh===s){u.state=1;u.reset=!1;o=n;break}if(o===-1)for(n=0;n<this._tmpCollisionContacts.length;n++)if(f=this._tmpCollisionContacts[n],null==f.mesh){f.mesh=s;f.state=0;f.reset=!1;break}}for(n=0;n<this._tmpCollisionContacts.length;n++)t=this._tmpCollisionContacts[n],t.reset===!0?(l&&null!=t.mesh&&this._onCollisionExitObservable.notifyObservers(t.mesh),t.mesh=null,t.state=0,t.reset=!1):0===t.state?h&&null!=t.mesh&&this._onCollisionEnterObservable.notifyObservers(t.mesh):c&&null!=t.mesh&&this._onCollisionStayObservable.notifyObservers(t.mesh)}}},i.prototype.destroyMovementState=function(){this.m_physicsEngine=null;null!=this.m_character&&(Ammo.destroy(this.m_character),this.m_character=null);null!=this.m_ghostObject&&(Ammo.destroy(this.m_ghostObject),this.m_ghostObject=null);null!=this.m_ghostShape&&(Ammo.destroy(this.m_ghostShape),this.m_ghostShape=null);null!=this.m_ghostCollision&&(Ammo.destroy(this.m_ghostCollision),this.m_ghostCollision=null);null!=this.m_ghostPosition&&(Ammo.destroy(this.m_ghostPosition),this.m_ghostPosition=null);null!=this.m_ghostRotation&&(Ammo.destroy(this.m_ghostRotation),this.m_ghostRotation=null);null!=this.m_ghostTransform&&(Ammo.destroy(this.m_ghostTransform),this.m_ghostTransform=null);null!=this.m_startPosition&&(Ammo.destroy(this.m_startPosition),this.m_startPosition=null);null!=this.m_startRotation&&(Ammo.destroy(this.m_startRotation),this.m_startRotation=null);null!=this.m_startTransform&&(Ammo.destroy(this.m_startTransform),this.m_startTransform=null);null!=this.m_warpPosition&&(Ammo.destroy(this.m_warpPosition),this.m_warpPosition=null);null!=this.m_walkDirection&&(Ammo.destroy(this.m_walkDirection),this.m_walkDirection=null);null!=this._tmpAmmoQuaternion&&(Ammo.destroy(this._tmpAmmoQuaternion),this._tmpAmmoQuaternion=null);null!=this._tmpOriginQuaternion&&(Ammo.destroy(this._tmpOriginQuaternion),this._tmpOriginQuaternion=null);null!=this._tmpRotateQuaternion&&(Ammo.destroy(this._tmpRotateQuaternion),this._tmpRotateQuaternion=null);this._onCollisionEnterObservable.clear();this._onCollisionEnterObservable=null;this._onCollisionStayObservable.clear();this._onCollisionStayObservable=null;this._onCollisionExitObservable.clear();this._onCollisionExitObservable=null;this._tmpCollisionContacts=null;this._abstractMesh=null},i.prototype.registerOnCollisionEnter=function(n){return this._onCollisionEnterObservable.add(n)},i.prototype.unregisterOnCollisionEnter=function(n){return this._onCollisionEnterObservable.remove(n)},i.prototype.registerOnCollisionStay=function(n){return this._onCollisionStayObservable.add(n)},i.prototype.unregisterOnCollisionStay=function(n){return this._onCollisionStayObservable.remove(n)},i.prototype.registerOnCollisionExit=function(n){return this._onCollisionExitObservable.add(n)},i.prototype.unregisterOnCollisionExit=function(n){return this._onCollisionExitObservable.remove(n)},i.prototype.setMaxNotifications=function(t){this._maxCollisions=t;this._tmpCollisionContacts=[];for(var i=0;i<this._maxCollisions;i++)this._tmpCollisionContacts.push(new n.CollisionContactInfo)},i.prototype.setActivationState=function(n){null!=this.m_ghostCollision&&this.m_ghostCollision.setActivationState&&this.m_ghostCollision.setActivationState(n)},i.prototype.getCollisionFilterGroup=function(){var n=-1;return null!=this.m_ghostCollision&&this.m_ghostCollision.getBroadphaseHandle&&(n=this.m_ghostCollision.getBroadphaseHandle().get_m_collisionFilterGroup()),n},i.prototype.setCollisionFilterGroup=function(n){null!=this.m_ghostCollision&&this.m_ghostCollision.getBroadphaseHandle&&this.m_ghostCollision.getBroadphaseHandle().set_m_collisionFilterGroup(n)},i.prototype.getCollisionFilterMask=function(){var n=-1;return null!=this.m_ghostCollision&&this.m_ghostCollision.getBroadphaseHandle&&(n=this.m_ghostCollision.getBroadphaseHandle().get_m_collisionFilterMask()),n},i.prototype.setCollisionFilterMask=function(n){null!=this.m_ghostCollision&&this.m_ghostCollision.getBroadphaseHandle&&this.m_ghostCollision.getBroadphaseHandle().set_m_collisionFilterMask(n)},i.prototype.getContactProcessingThreshold=function(){return null!=this.m_ghostCollision&&this.m_ghostCollision.getContactProcessingThreshold&&this.m_ghostCollision.getContactProcessingThreshold(),-1},i.prototype.setContactProcessingThreshold=function(n){null!=this.m_ghostCollision&&this.m_ghostCollision.setContactProcessingThreshold&&this.m_ghostCollision.setContactProcessingThreshold(n)},i.prototype.setGhostWorldTransform=function(n,t){null!=this.m_ghostObject&&null!=this.m_ghostTransform&&(null!=this.m_ghostPosition&&null!=n&&(this.m_ghostPosition.setValue(n.x,n.y,n.z),this.m_ghostTransform.setOrigin(this.m_ghostPosition)),null!=this.m_ghostRotation&&null!=t&&(this.m_ghostRotation.setValue(t.x,t.y,t.z,t.w),this.m_ghostTransform.setRotation(this.m_ghostRotation)),this.m_ghostObject.setWorldTransform(this.m_ghostTransform))},i.prototype.move=function(n){null!=n&&(this.m_moveDeltaX=n.x,this.m_moveDeltaZ=n.z,Math.abs(n.x)<this._minMoveDistance&&(n.x>0?this.m_moveDeltaX=this._minMoveDistance:n.x<0&&(this.m_moveDeltaX=-this._minMoveDistance)),Math.abs(n.z)<this._minMoveDistance&&(n.z>0?this.m_moveDeltaZ=this._minMoveDistance:n.z<0&&(this.m_moveDeltaZ=-this._minMoveDistance)),null!=this.m_walkDirection&&this.m_walkDirection.setValue(this.m_moveDeltaX,0,this.m_moveDeltaZ))},i.prototype.turn=function(n){this.m_turningRate=n},i.prototype.jump=function(n){this.internalSetJumpSpeed(n);this.internalJump()},i.prototype.warp=function(n){null!=this.m_warpPosition&&(this.m_warpPosition.setValue(n.x,n.y,n.z),this.internalWarp(this.m_warpPosition))},i}(n.ScriptComponent);n.CharacterController=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(t){function i(n,i,r){return void 0===r&&(r={}),t.call(this,n,i,r)||this}return __extends(i,t),Object.defineProperty(i.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasAgentInfo",{get:function(){return null!=this.info},enumerable:!0,configurable:!0}),i.prototype.start=function(){},i.prototype.update=function(){},i.prototype.after=function(){},i.prototype.destroy=function(){},i.prototype.setDestination=function(){this.hasAgentInfo||n.Tools.Warn("Null navigation agent metadata. Set agent destination ignored.")},i.GetNavigationMesh=function(t){return n.SceneManager.GetAbstractMesh(t,"NavigationMesh")},i.GetNavigationZone=function(){return"scene"},i.BuildNavigationNodes=function(t,i){var r,u,f;return void 0===i&&(i=null),r=null,u=i||n.NavigationAgent.GetNavigationMesh(t),null!=u?(r=new Navigation,f=r.buildNodes(u),null!=f?r.setZoneData(n.NavigationAgent.GetNavigationZone(),f):n.Tools.Warn("Failed to build navigation zone nodes")):n.Tools.Warn("Failed to locate scene navigation mesh"),r},i.FindNavigationPath=function(t,i,r){var u=n.NavigationAgent.GetNavigationZone(),f=t.getGroup(u,i);return t.findPath(i,r,u,f)},i}(n.ScriptComponent);n.NavigationAgent=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(n){function t(t,i,r){return void 0===r&&(r={}),n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(n.ScriptComponent);n.NetworkSystem=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(n){function t(t,i,r){return void 0===r&&(r={}),n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(n.ScriptComponent);n.ShurikenParticleSystem=t}(BABYLON||(BABYLON={}));!function(n){var t=function(){function t(t,i,r){this._centerMass=new n.Vector3(0,0,0);this._chassisMesh=null;this._tempVectorPos=new n.Vector3(0,0,0);this.lockedWheelIndexes=null;this.m_vehicle=null;this.m_vehicleTuning=null;this.m_vehicleRaycaster=null;this.m_vehicleColliders=null;this.m_tempTransform=null;this.m_tempPosition=null;this.m_wheelDirectionCS0=null;this.m_wheelAxleCS=null;this._chassisMesh=t;this._centerMass=r;this.m_vehicleColliders=this._chassisMesh.metadata.wheels;this.m_vehicleTuning=new Ammo.btVehicleTuning;this.m_vehicleRaycaster=new Ammo.btSmoothVehicleRaycaster(i);this.m_vehicle=new Ammo.btRaycastVehicle(this.m_vehicleTuning,this._chassisMesh.physicsImpostor.physicsBody,this.m_vehicleRaycaster);this.m_vehicle.setCoordinateSystem(0,1,2);this.m_wheelDirectionCS0=new Ammo.btVector3(0,-1,0);this.m_wheelAxleCS=new Ammo.btVector3(-1,0,0);this.m_tempPosition=null;this.m_tempTransform=null;i.addAction(this.m_vehicle);this.setupWheelInformation()}return t.prototype.getUpAxis=function(){if(null!=this.m_vehicle)return this.m_vehicle.getUpAxis()},t.prototype.getRightAxis=function(){if(null!=this.m_vehicle)return this.m_vehicle.getRightAxis()},t.prototype.getForwardAxis=function(){if(null!=this.m_vehicle)return this.m_vehicle.getForwardAxis()},t.prototype.getForwardVector=function(){if(null!=this.m_vehicle)return this.m_vehicle.getForwardVector()},t.prototype.getNumWheels=function(){if(null!=this.m_vehicle)return this.m_vehicle.getNumWheels()},t.prototype.getWheelInfo=function(n){if(null!=this.m_vehicle)return this.m_vehicle.getWheelInfo(n)},t.prototype.resetSuspension=function(){null!=this.m_vehicle&&this.m_vehicle.resetSuspension()},t.prototype.setPitchControl=function(n){null!=this.m_vehicle&&this.m_vehicle.setPitchControl(n)},t.prototype.setEngineForce=function(n,t){null!=this.m_vehicle&&this.m_vehicle.applyEngineForce(n,t)},t.prototype.setBrakingForce=function(n,t){null!=this.m_vehicle&&this.m_vehicle.setBrake(n,t)},t.prototype.getWheelTransform=function(n){if(null!=this.m_vehicle)return this.m_vehicle.getWheelTransformWS(n)},t.prototype.updateWheelTransform=function(n,t){null!=this.m_vehicle&&this.m_vehicle.updateWheelTransform(n,t)},t.prototype.getUserConstraintType=function(){if(null!=this.m_vehicle)return this.m_vehicle.getUserConstraintType()},t.prototype.setUserConstraintType=function(n){null!=this.m_vehicle&&this.m_vehicle.setUserConstraintType(n)},t.prototype.setUserConstraintId=function(n){null!=this.m_vehicle&&this.m_vehicle.setUserConstraintId(n)},t.prototype.getUserConstraintId=function(){if(null!=this.m_vehicle)return this.m_vehicle.getUserConstraintId()},t.prototype.getRawCurrentSpeedKph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()},t.prototype.getRawCurrentSpeedMph=function(){if(null!=this.m_vehicle)return this.m_vehicle.getCurrentSpeedKmHour()*n.System.Kph2Mph},t.prototype.getAbsCurrentSpeedKph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())},t.prototype.getAbsCurrentSpeedMph=function(){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getCurrentSpeedKmHour())*n.System.Kph2Mph},t.prototype.getVehicleTuningSystem=function(){return this.m_vehicleTuning},t.prototype.getChassisWorldTransform=function(){if(null!=this.m_vehicle)return this.m_vehicle.getChassisWorldTransform()},t.prototype.dispose=function(){this.deleteWheelInformation();null!=this.m_vehicle&&(Ammo.destroy(this.m_vehicle),this.m_vehicle=null);null!=this.m_vehicleTuning&&(Ammo.destroy(this.m_vehicleTuning),this.m_vehicleTuning=null);null!=this.m_vehicleRaycaster&&(Ammo.destroy(this.m_vehicleRaycaster),this.m_vehicleRaycaster=null);null!=this.m_wheelDirectionCS0&&(Ammo.destroy(this.m_wheelDirectionCS0),this.m_wheelDirectionCS0=null);null!=this.m_wheelAxleCS&&(Ammo.destroy(this.m_wheelAxleCS),this.m_wheelAxleCS=null);null!=this.m_tempPosition&&(Ammo.destroy(this.m_tempPosition),this.m_tempPosition=null);null!=this.m_tempTransform&&(Ammo.destroy(this.m_tempTransform),this.m_tempTransform=null);this.m_vehicleColliders=null},t.prototype.getStabilizingForce=function(){var n=-1;return null!=this.m_vehicle&&this.m_vehicle.get_m_stabilizingForce&&(n=this.m_vehicle.get_m_stabilizingForce()),n},t.prototype.setStabilizingForce=function(n){null!=this.m_vehicle&&this.m_vehicle.set_m_stabilizingForce&&this.m_vehicle.set_m_stabilizingForce(n)},t.prototype.getCollisionFilterGroup=function(){var n=-1;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_collisionFilterGroup&&(n=this.m_vehicleRaycaster.get_m_collisionFilterGroup()),n},t.prototype.setCollisionFilterGroup=function(n){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_collisionFilterGroup&&this.m_vehicleRaycaster.set_m_collisionFilterGroup(n)},t.prototype.getCollisionFilterMask=function(){var n=-1;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_collisionFilterMask&&(n=this.m_vehicleRaycaster.get_m_collisionFilterMask()),n},t.prototype.setCollisionFilterMask=function(n){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_collisionFilterMask&&this.m_vehicleRaycaster.set_m_collisionFilterMask(n)},t.prototype.getInterpolateMeshNormals=function(){var n=-1;return null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.get_m_interpolateMeshNormals&&(n=this.m_vehicleRaycaster.get_m_interpolateMeshNormals()),n},t.prototype.setInterpolateMeshNormals=function(n){null!=this.m_vehicleRaycaster&&this.m_vehicleRaycaster.set_m_interpolateMeshNormals&&this.m_vehicleRaycaster.set_m_interpolateMeshNormals(n)},t.prototype.getWheelIndexByID=function(n){var i=-1,t,r;if(null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0)for(t=0;t<this.m_vehicleColliders.length;t++)if(r=this.m_vehicleColliders[t],n.toLowerCase()===r.id.toLowerCase()){i=t;break}return i},t.prototype.getWheelIndexByName=function(n){var i=-1,t,r;if(null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0)for(t=0;t<this.m_vehicleColliders.length;t++)if(r=this.m_vehicleColliders[t],n.toLowerCase()===r.name.toLowerCase()){i=t;break}return i},t.prototype.getWheelColliderInfo=function(n){var t=-1;return null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0&&this.m_vehicleColliders.length>n&&(t=this.m_vehicleColliders[n]),t},t.prototype.setWheelTransformMesh=function(n,t){if(null!=t){var i=this.getWheelInfo(n);null!=i&&(i.transform=t)}},t.prototype.getVisualSteeringAngle=function(n){var i=0,t=this.getWheelInfo(n);return null!=t&&null!=t.steeringAngle&&(i=t.steeringAngle),i},t.prototype.setVisualSteeringAngle=function(n,t){var i=this.getWheelInfo(t);null!=i&&(i.steeringAngle=n)},t.prototype.getPhysicsSteeringAngle=function(n){if(null!=this.m_vehicle)return Math.abs(this.m_vehicle.getSteeringValue(n))},t.prototype.setPhysicsSteeringAngle=function(n,t){null!=this.m_vehicle&&this.m_vehicle.setSteeringValue(n,t)},t.prototype.setupWheelInformation=function(){var r;if(null!=this._chassisMesh&&null!=this._chassisMesh.physicsImpostor&&null!=this._chassisMesh.physicsImpostor.physicsBody&&this._chassisMesh.physicsImpostor.physicsBody.setActivationState(n.CollisionState.DISABLE_DEACTIVATION),null!=this.m_vehicle&&null!=this.m_vehicleColliders&&this.m_vehicleColliders.length>0){for(r=-1,r=0;r<this.m_vehicleColliders.length;r++){var t=this.m_vehicleColliders[r],f=null!=t.name?t.name:"Unknown",e=null!=t.radius?t.radius:.5,o=null!=t.position&&t.position.length>=3?t.position[0]:1,s=null!=t.position&&t.position.length>=3?t.position[2]:-1,h=null!=t.connectionpoint?t.connectionpoint:.2,c=null!=t.suspensionrestlength?t.suspensionrestlength:0,l=null!=t.frontwheel||f.toLowerCase().indexOf("front")>=0,a=s,v=o,y=-this._centerMass.x,p=-this._centerMass.z;this.m_vehicle.addWheel(new Ammo.btVector3(v+y,h,a+p),this.m_wheelDirectionCS0,this.m_wheelAxleCS,c,e,this.m_vehicleTuning,l)}if(this.m_vehicle.getNumWheels()===this.m_vehicleColliders.length)for(r=0;r<this.m_vehicleColliders.length;r++){var t=this.m_vehicleColliders[r],w=null!=t.maxsuspensionforce?t.maxsuspensionforce:6e3,b=null!=t.maxsuspensiontravel?t.maxsuspensiontravel:500,k=null!=t.rollinfluence?t.rollinfluence:.2,u=null!=t.frictionslip?t.frictionslip:10,d=null!=t.suspensionstiffness?t.suspensionstiffness:20,g=null!=t.dampingcompression?t.dampingcompression:3.5,nt=null!=t.dampingrelaxation?t.dampingrelaxation:4.5,i=this.m_vehicle.getWheelInfo(r);null!=i&&(i.steeringAngle=0,i.rotationBoost=0,i.defaultFriction=u,i.set_m_frictionSlip(u),i.set_m_rollInfluence(k),i.set_m_maxSuspensionForce(w),i.set_m_maxSuspensionTravelCm(b),i.set_m_suspensionStiffness(d),i.set_m_wheelsDampingCompression(g),i.set_m_wheelsDampingRelaxation(nt))}else n.Tools.Warn("Failed to create proper number of wheels for: "+this._chassisMesh.name)}},t.prototype.updateWheelInformation=function(){var f=this.getNumWheels(),i,t,e,r,o;if(f>0)for(i=0;i<f;i++)if(t=this.getWheelInfo(i),null!=t&&(e=this.lockedWheelInformation(i),(this.updateWheelTransform(i,!1),this.m_tempTransform=this.getWheelTransform(i),this.m_tempPosition=this.m_tempTransform.getOrigin(),null!=t.transform)&&(r=t.transform,null!=r.parent&&(n.Utilities.ConvertAmmoVector3ToRef(this.m_tempPosition,this._tempVectorPos),n.Utilities.InverseTransformPointToRef(r.parent,this._tempVectorPos,this._tempVectorPos),r.position.y=this._tempVectorPos.y,o=null!=t.steeringAngle?t.steeringAngle:0,n.Quaternion.FromEulerAnglesToRef(0,o,0,r.rotationQuaternion),null!=t.spinner&&t.spinner.addRotation&&e===!1)))){var s=0,u=null!=t.get_m_deltaRotation?t.get_m_deltaRotation():0,h=null!=t.rotationBoost?t.rotationBoost:0;s=u<0?u+-h:u+h;t.spinner.addRotation(s,0,0)}},t.prototype.lockedWheelInformation=function(n){var i=!1,t;if(null!=this.lockedWheelIndexes&&this.lockedWheelIndexes.length>0)for(t=0;t<this.lockedWheelIndexes.length;t++)if(this.lockedWheelIndexes[t]===n){i=!0;break}return i},t.prototype.deleteWheelInformation=function(){var i=this.getNumWheels(),t,n;if(i>0)for(t=0;t<i;t++)n=this.getWheelInfo(t),null!=n&&(null!=n.transform&&delete n.transform,null!=n.spinner&&delete n.spinner,null!=n.steeringAngle&&delete n.steeringAngle,null!=n.rotationBoost&&delete n.rotationBoost,null!=n.defaultFriction&&delete n.defaultFriction)},t}();n.RaycastVehicle=t}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(){function n(){this.mesh=null;this.state=0;this.reset=!1}return n}(),i;n.CollisionContactInfo=t;i=function(i){function r(t,r,u){void 0===u&&(u={});var f=i.call(this,t,r,u)||this;return f._abstractMesh=null,f._isKinematic=!1,f._maxCollisions=4,f._isPhysicsReady=!1,f._centerOfMass=new n.Vector3(0,0,0),f._raycastVehicle=null,f._tmpGravityVector=null,f._tmpCollisionContacts=null,f.m_physicsWorld=null,f.m_physicsEngine=null,f._onCollisionEnterObservable=new n.Observable,f._onCollisionStayObservable=new n.Observable,f._onCollisionExitObservable=new n.Observable,f._abstractMesh=f.getAbstractMesh(),f._isKinematic=f.getEditorProperty("isKinematic",f._isKinematic),f.m_physicsWorld=n.SceneManager.GetPhysicsWorld(f.scene),f.m_physicsEngine=n.SceneManager.GetPhysicsEngine(f.scene),null!=f.transform.metadata&&null!=f.transform.metadata.unity&&null!=f.transform.metadata.unity.physics&&(f._centerOfMass=null!=f.transform.metadata.unity.physics.center?n.Utilities.ParseVector3(f.transform.metadata.unity.physics.center,f._centerOfMass):f._centerOfMass),f.setMaxNotifications(f._maxCollisions),f}return __extends(r,i),Object.defineProperty(r.prototype,"isKinematic",{get:function(){return this._isKinematic},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"centerOfMass",{get:function(){return this._centerOfMass},enumerable:!0,configurable:!0}),r.prototype.start=function(){this.initRigidbodyState()},r.prototype.update=function(){this.updateRigidbodyState()},r.prototype.after=function(){this.afterRigidbodyState()},r.prototype.destroy=function(){this.destroyRigidbodyState()},r.prototype.initRigidbodyState=function(){n.Utilities.ValidateTransformQuaternion(this.transform);this._isPhysicsReady=null!=this.m_physicsEngine&&null!=this._tmpCollisionContacts&&null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody;var t=this._isKinematic===!0?n.CollisionFilters.StaticFilter:n.CollisionFilters.DefaultFilter,i=this._isKinematic===!0?n.CollisionFilters.AllFilter^n.CollisionFilters.StaticFilter:n.CollisionFilters.AllFilter;this.setCollisionFilterGroup(t);this.setCollisionFilterMask(i);this.resetBodyCollisionContacts()},r.prototype.updateRigidbodyState=function(){this.syncronizeVehicleController()},r.prototype.afterRigidbodyState=function(){this.parseBodyCollisionContacts();this.resetBodyCollisionContacts()},r.prototype.destroyRigidbodyState=function(){this.m_physicsWorld=null;this.m_physicsEngine=null;null!=this._raycastVehicle&&(this._raycastVehicle.dispose(),this._raycastVehicle=null);null!=this._tmpGravityVector&&(Ammo.destroy(this._tmpGravityVector),this._tmpGravityVector=null);this._onCollisionEnterObservable.clear();this._onCollisionEnterObservable=null;this._onCollisionStayObservable.clear();this._onCollisionStayObservable=null;this._onCollisionExitObservable.clear();this._onCollisionExitObservable=null;this._tmpCollisionContacts=null;this._abstractMesh=null},r.prototype.syncronizeVehicleController=function(){null!=this._raycastVehicle&&this._raycastVehicle.updateWheelInformation()},r.prototype.parseBodyCollisionContacts=function(){var n,u,f,l,e,o,i,r,t;if(this._isPhysicsReady===!0){var s=this._onCollisionEnterObservable.hasObservers(),h=this._onCollisionStayObservable.hasObservers(),c=this._onCollisionExitObservable.hasObservers();if(s||h||c){for(n=0,n=0;n<this._tmpCollisionContacts.length;n++)this._tmpCollisionContacts[n].reset=!0;if(u=0,null!=this._abstractMesh.physicsImpostor.tmpCollisionObjects){f=this._abstractMesh.physicsImpostor.tmpCollisionObjects;for(l in f){for(e=-1,o=f[l],n=0;n<this._tmpCollisionContacts.length;n++)if(i=this._tmpCollisionContacts[n],null!=i.mesh&&i.mesh===o){i.state=1;i.reset=!1;e=n;break}if(e===-1)for(n=0;n<this._tmpCollisionContacts.length;n++)if(r=this._tmpCollisionContacts[n],null==r.mesh){r.mesh=o;r.state=0;r.reset=!1;break}if(u++,u>this._maxCollisions)break}}for(n=0;n<this._tmpCollisionContacts.length;n++)t=this._tmpCollisionContacts[n],t.reset===!0?(c&&null!=t.mesh&&this._onCollisionExitObservable.notifyObservers(t.mesh),t.mesh=null,t.state=0,t.reset=!1):0===t.state?s&&null!=t.mesh&&this._onCollisionEnterObservable.notifyObservers(t.mesh):h&&null!=t.mesh&&this._onCollisionStayObservable.notifyObservers(t.mesh)}}},r.prototype.resetBodyCollisionContacts=function(){if(this._isPhysicsReady===!0){var n=this._onCollisionEnterObservable.hasObservers(),t=this._onCollisionStayObservable.hasObservers(),i=this._onCollisionExitObservable.hasObservers();this._abstractMesh.physicsImpostor.tmpCollisionObjects=n||t||i?{}:null}},r.prototype.registerOnCollisionEnter=function(n){return this._onCollisionEnterObservable.add(n)},r.prototype.unregisterOnCollisionEnter=function(n){return this._onCollisionEnterObservable.remove(n)},r.prototype.registerOnCollisionStay=function(n){return this._onCollisionStayObservable.add(n)},r.prototype.unregisterOnCollisionStay=function(n){return this._onCollisionStayObservable.remove(n)},r.prototype.registerOnCollisionExit=function(n){return this._onCollisionExitObservable.add(n)},r.prototype.unregisterOnCollisionExit=function(n){return this._onCollisionExitObservable.remove(n)},r.prototype.setGravity=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setGravity&&null!=n&&(null==this._tmpGravityVector&&(this._tmpGravityVector=new Ammo.btVector3(0,0,0)),this._tmpGravityVector.setValue(n.x,n.y,n.z),this._abstractMesh.physicsImpostor.physicsBody.setGravity(this._tmpGravityVector))},r.prototype.getGravity=function(){var t=new n.Vector3(0,0,0);return this.getGravityToRef(t),t},r.prototype.getGravityToRef=function(t){if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getGravity){var i=this._abstractMesh.physicsImpostor.physicsBody.getGravity();n.Utilities.ConvertAmmoVector3ToRef(i,t)}},r.prototype.getMass=function(){var n=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(n=this._abstractMesh.physicsImpostor.mass),n},r.prototype.setMass=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&this._abstractMesh.physicsImpostor.mass!==n&&(this._abstractMesh.physicsImpostor.mass=n)},r.prototype.getFriction=function(){var n=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(n=this._abstractMesh.physicsImpostor.friction),n},r.prototype.setFriction=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&this._abstractMesh.physicsImpostor.friction!==n&&(this._abstractMesh.physicsImpostor.friction=n)},r.prototype.getRestitution=function(){var n=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(n=this._abstractMesh.physicsImpostor.restitution),n},r.prototype.setRestitution=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&this._abstractMesh.physicsImpostor.restitution!==n&&(this._abstractMesh.physicsImpostor.restitution=n)},r.prototype.getLinearVelocity=function(){var n=null;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(n=this._abstractMesh.physicsImpostor.getLinearVelocity()),n},r.prototype.setLinearVelocity=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=n&&this._abstractMesh.physicsImpostor.setLinearVelocity(n)},r.prototype.getAngularVelocity=function(){var n=null;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&(n=this._abstractMesh.physicsImpostor.getAngularVelocity()),n},r.prototype.setAngularVelocity=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=n&&this._abstractMesh.physicsImpostor.setAngularVelocity(n)},r.prototype.getWorldTransform=function(){var t=null,n;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(n=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),null!=n&&n.getWorldTransform&&(t=n.getWorldTransform())),t},r.prototype.getTransformPositionToRef=function(t){var i=this.getWorldTransform(),r;null!=i&&null!=t&&(r=i.getOrigin(),n.Utilities.ConvertAmmoVector3ToRef(r,t))},r.prototype.getTransformRotationToRef=function(t){var i=this.getWorldTransform(),r;null!=i&&null!=t&&(r=i.getRotation(),n.Utilities.ConvertAmmoQuaternionToRef(r,t))},r.prototype.clearForces=function(){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.clearForces&&this._abstractMesh.physicsImpostor.physicsBody.clearForces()},r.prototype.applyTorque=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyTorque&&null!=t&&(null==n.RigidbodyPhysics.TempAmmoVector&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyTorque(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyLocalTorque=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyLocalTorque&&null!=t&&(null==n.RigidbodyPhysics.TempAmmoVector&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyLocalTorque(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyImpulse=function(t,i){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyImpulse&&null!=t&&(null==n.RigidbodyPhysics.TempAmmoVector&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),null==n.RigidbodyPhysics.TempAmmoVectorAux&&(n.RigidbodyPhysics.TempAmmoVectorAux=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),n.RigidbodyPhysics.TempAmmoVectorAux.setValue(i.x,i.y,i.z),this._abstractMesh.physicsImpostor.physicsBody.applyImpulse(n.RigidbodyPhysics.TempAmmoVector,n.RigidbodyPhysics.TempAmmoVectorAux))},r.prototype.applyCentralImpulse=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralImpulse&&null!=t&&(null==n.RigidbodyPhysics.TempAmmoVector&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralImpulse(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyTorqueImpulse=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyTorqueImpulse&&null!=t&&(null==n.RigidbodyPhysics.TempAmmoVector&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyTorqueImpulse(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyForce=function(t,i){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyForce&&null!=t&&(null==n.RigidbodyPhysics.TempAmmoVector&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),null==n.RigidbodyPhysics.TempAmmoVectorAux&&(n.RigidbodyPhysics.TempAmmoVectorAux=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),n.RigidbodyPhysics.TempAmmoVectorAux.setValue(i.x,i.y,i.z),this._abstractMesh.physicsImpostor.physicsBody.applyForce(n.RigidbodyPhysics.TempAmmoVector,n.RigidbodyPhysics.TempAmmoVectorAux))},r.prototype.applyCentralForce=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralForce&&null!=t&&(null==n.RigidbodyPhysics.TempAmmoVector&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralForce(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.applyCentralLocalForce=function(t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.applyCentralLocalForce&&null!=t&&(null==n.RigidbodyPhysics.TempAmmoVector&&(n.RigidbodyPhysics.TempAmmoVector=new Ammo.btVector3(0,0,0)),n.RigidbodyPhysics.TempAmmoVector.setValue(t.x,t.y,t.z),this._abstractMesh.physicsImpostor.physicsBody.applyCentralLocalForce(n.RigidbodyPhysics.TempAmmoVector))},r.prototype.getLinearFactor=function(){var n=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getLinearFactor&&(n=this._abstractMesh.physicsImpostor.physicsBody.getLinearFactor()),n},r.prototype.setLinearFactor=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setLinearFactor&&this._abstractMesh.physicsImpostor.physicsBody.setLinearFactor(n)},r.prototype.getAngularFactor=function(){var n=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getAngularFactor&&(n=this._abstractMesh.physicsImpostor.physicsBody.getAngularFactor()),n},r.prototype.setAngularFactor=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setAngularFactor&&this._abstractMesh.physicsImpostor.physicsBody.setAngularFactor(n)},r.prototype.getAngularDamping=function(){var n=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getAngularDamping&&(n=this._abstractMesh.physicsImpostor.physicsBody.getAngularDamping()),n},r.prototype.getLinearDamping=function(){var n=0;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getLinearDamping&&(n=this._abstractMesh.physicsImpostor.physicsBody.getLinearDamping()),n},r.prototype.setDamping=function(n,t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setDamping&&this._abstractMesh.physicsImpostor.physicsBody.setDamping(n,t)},r.prototype.setSleepingThresholds=function(n,t){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.setSleepingThresholds&&this._abstractMesh.physicsImpostor.physicsBody.setSleepingThresholds(n,t)},r.prototype.setMaxNotifications=function(n){this._maxCollisions=n;this._tmpCollisionContacts=[];for(var i=0;i<this._maxCollisions;i++)this._tmpCollisionContacts.push(new t)},r.prototype.setActivationState=function(n){if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody){var t=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject);null!=t&&t.setActivationState&&t.setActivationState(n)}},r.prototype.getCollisionFilterGroup=function(){var n=-1;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&(n=this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().get_m_collisionFilterGroup()),n},r.prototype.setCollisionFilterGroup=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().set_m_collisionFilterGroup(n)},r.prototype.getCollisionFilterMask=function(){var n=-1;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&(n=this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().get_m_collisionFilterMask()),n},r.prototype.setCollisionFilterMask=function(n){null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy&&this._abstractMesh.physicsImpostor.physicsBody.getBroadphaseProxy().set_m_collisionFilterMask(n)},r.prototype.getCollisionShapeType=function(){var i=-1,t,n;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(t=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),null!=t&&(n=t.getCollisionShape(),null!=n&&n.getShapeType&&(i=n.getShapeType()))),i},r.prototype.getCollisionShapeMargin=function(){var i=-1,t,n;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(t=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),null!=t&&(n=t.getCollisionShape(),null!=n&&n.getMargin&&(i=n.getMargin()))),i},r.prototype.setCollisionShapeMargin=function(n){var i,t;null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(i=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),null!=i&&(t=i.getCollisionShape(),null!=t&&t.setMargin&&t.setMargin(n)))},r.prototype.getContactProcessingThreshold=function(){var t=-1,n;return null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody&&(n=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject),null!=n&&n.getContactProcessingThreshold&&(t=n.getContactProcessingThreshold())),t},r.prototype.setContactProcessingThreshold=function(n){if(null!=this._abstractMesh&&null!=this._abstractMesh.physicsImpostor&&null!=this._abstractMesh.physicsImpostor.physicsBody){var t=Ammo.castObject(this._abstractMesh.physicsImpostor.physicsBody,Ammo.btCollisionObject);null!=t&&t.setContactProcessingThreshold&&t.setContactProcessingThreshold(n)}},r.prototype.hasRaycastVehicle=function(){return this._isPhysicsReady===!0&&null!=this._abstractMesh.metadata&&null!=this._abstractMesh.metadata.wheels},r.prototype.getRaycastVehicle=function(){if(null==this._raycastVehicle)if(this.hasRaycastVehicle()){var t=n.SceneManager.GetRightHanded(this.scene);t===!0&&n.Tools.Warn("Raycast vehicle not supported for right handed scene: "+this._abstractMesh.name);this._raycastVehicle=new n.RaycastVehicle(this._abstractMesh,this.m_physicsWorld,this._centerOfMass)}else n.Tools.Warn("No wheel collider metadata info for: "+this.transform.name);return this._raycastVehicle},r.CreatePhysicsMetadata=function(t,i,r,u){void 0===i&&(i=0);void 0===r&&(r=.05);void 0===u&&(u=null);var f=null!=u?u:new n.Vector3(0,0,0);return{type:"rigidbody",mass:t,ldrag:i,adrag:r,center:{x:f.x,y:f.y,z:f.z}}},r.CreateCollisionMetadata=function(n,t,i,r,u,f){return void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=0),void 0===u&&(u=.6),void 0===f&&(f=.6),{type:n,trigger:t,convexmesh:i,restitution:r,dynamicfriction:u,staticfriction:f,wheelinformation:null}},r.CreatePhysicsProperties=function(n,t,i,r,u){return void 0===t&&(t=0),void 0===i&&(i=.05),void 0===r&&(r=!0),void 0===u&&(u=!1),{mass:n,drag:t,angularDrag:i,useGravity:r,isKinematic:u}},r.SetupPhysicsComponent=function(t,i){var r=null!=i.metadata&&null!=i.metadata.unity?i.metadata.unity:null,e,l,f;if(null!=r&&null!=r.physics&&(e=null!=r.physics.mass?r.physics.mass:0,l=null!=r.physics.center?n.Utilities.ParseVector3(r.physics.center,n.Vector3.Zero()):n.Vector3.Zero(),"rigidbody"===r.physics.type))if(null!=r.collision&&null!=r.collision.type){var w=null!=r.collision.convexmesh&&r.collision.convexmesh,b=null!=r.collision.dynamicfriction?r.collision.dynamicfriction:.6,k=(null!=r.collision.staticfriction?r.collision.staticfriction:.6,null!=r.collision.restitution?r.collision.restitution:0),d=null!=r.collision.trigger&&r.collision.trigger,o=null!=r.collision.type?r.collision.type:"BoxCollider",a=n.PhysicsImpostor.BoxImpostor;a="MeshCollider"===o?w===!0?n.PhysicsImpostor.ConvexHullImpostor:n.PhysicsImpostor.MeshImpostor:"CapsuleCollider"===o?n.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===o?n.PhysicsImpostor.SphereImpostor:n.PhysicsImpostor.BoxImpostor;n.SceneManager.CreatePhysicsImpostor(t,i,a,{mass:e,friction:b,restitution:k});n.RigidbodyPhysics.ConfigRigidbodyPhysics(t,i,!1,d,r.physics)}else{var s=0,v=0,h=0,y=!1,p=0,u=null,c=i.getChildren(null,!0);null!=c&&c.length>0&&c.forEach(function(n){n.position.subtractInPlace(l)});f=i.getChildren(null,!1);null!=f&&f.length>0&&f.forEach(function(f){var e,o;if(null!=f.metadata&&null!=f.metadata.unity&&null!=f.metadata.unity.collision)if(e=f.metadata.unity.collision,o=null!=e.wheelinformation?e.wheelinformation:null,null!=o)null==u&&(u=[]),u.push(o);else{f.parent!==i&&f.setParent(i);var l=null!=e.dynamicfriction?e.dynamicfriction:.6,a=null!=e.staticfriction?e.staticfriction:.6,w=null!=e.restitution?e.restitution:0,k=null!=e.trigger&&e.trigger,c=null!=e.type?e.type:"BoxCollider",b=n.PhysicsImpostor.BoxImpostor;b="MeshCollider"===c?n.PhysicsImpostor.ConvexHullImpostor:"CapsuleCollider"===c?n.PhysicsImpostor.CapsuleImpostor:"SphereCollider"===c?n.PhysicsImpostor.SphereImpostor:n.PhysicsImpostor.BoxImpostor;l>s&&(s=l);a>v&&(v=a);w>h&&(h=w);1==k&&(y=!0);n.SceneManager.CreatePhysicsImpostor(t,f,b,{mass:0,friction:0,restitution:0});n.RigidbodyPhysics.ConfigRigidbodyPhysics(t,f,!0,!1,r.physics);p++}});p>0&&(n.SceneManager.CreatePhysicsImpostor(t,i,n.PhysicsImpostor.NoImpostor,{mass:e,friction:s,restitution:h}),n.RigidbodyPhysics.ConfigRigidbodyPhysics(t,i,!1,y,r.physics));null!=u&&u.length>0&&(i.metadata.wheels=u);f=null}},r.ConfigRigidbodyPhysics=function(t,i,r,u,f){null!=i&&(null!=i.physicsImpostor?i.physicsImpostor.executeNativeFunction(function(r,e){var s,c,h,l,a,v,y,p,o;if(e.activate&&e.activate(),s=Ammo.castObject(e,Ammo.btCollisionObject),s.entity=i,c=n.SceneManager.GetPhysicsWorld(t),null!=c&&c.generateInternalEdgeInfo&&(h=s.getCollisionShape(),null!=h&&h.getShapeType&&(l=h.getShapeType(),21===l&&(a=Ammo.castObject(h,Ammo.btBvhTriangleMeshShape),s.triangleMapInfo=new Ammo.btTriangleInfoMap,c.generateInternalEdgeInfo(a,s.triangleMapInfo)))),v=null==f||null==f.gravity||f.gravity,(v===!1&&(e.setGravity?e.setGravity(new Ammo.btVector3(0,0,0)):n.Tools.Warn("Physics engine set gravity override not supported for: "+i.name)),e.setDamping)?(y=null!=f&&null!=f.ldrag?f.ldrag:0,p=null!=f&&null!=f.adrag?f.adrag:.05,e.setDamping(y,p)):n.Tools.Warn("Physics engine set drag damping not supported for: "+i.name),e.setCollisionFlags&&e.getCollisionFlags?u===!0?e.setCollisionFlags(e.getCollisionFlags()|n.CollisionFlags.CF_NO_CONTACT_RESPONSE|n.CollisionFlags.CF_CUSTOM_MATERIAL_CALLBACK):e.setCollisionFlags(e.getCollisionFlags()|n.CollisionFlags.CF_CUSTOM_MATERIAL_CALLBACK):n.Tools.Warn("Physics engine set collision flags not supported for: "+i.name),o=null!=f&&null!=f.freeze?f.freeze:null,null!=o){if(e.setLinearFactor){var w=null!=o.positionx&&o.positionx===!0?0:1,b=null!=o.positiony&&o.positiony===!0?0:1,k=null!=o.positionz&&o.positionz===!0?0:1;e.setLinearFactor(new Ammo.btVector3(w,b,k))}else n.Tools.Warn("Physics engine set linear factor not supported for: "+i.name);if(e.setAngularFactor){var d=null!=o.rotationx&&o.rotationx===!0?0:1,g=null!=o.rotationy&&o.rotationy===!0?0:1,nt=null!=o.rotationz&&o.rotationz===!0?0:1;e.setAngularFactor(new Ammo.btVector3(d,g,nt))}else n.Tools.Warn("Physics engine set angular factor not supported for: "+i.name)}}):n.Tools.Warn("No valid physics impostor to setup for "+i.name))},r.TempAmmoVector=null,r.TempAmmoVectorAux=null,r}(n.ScriptComponent);n.RigidbodyPhysics=i}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var e=function(){function n(){this._defines={};this._defines={}}return n.prototype.getDefines=function(){return this._defines},n.prototype.defineBoolean=function(n){this._defines[n]=!0},n.prototype.defineNumeric=function(n,t){this._defines[n]=t},n.ShaderIndexer=0,n}(),u,f,t,i,r;n.UniversalShaderDefines=e;u=function(){function n(){}return n}();n.UniversalAlbedoChunks=u;f=function(){function n(){}return n}();n.UniversalDiffuseChunks=f;t=function(t){function i(i,r){var u=t.call(this,i,r)||this;return u.universalMaterial=!0,u.locals=null,u.terrainInfo=null,u._defines=null,u._uniforms=[],u._samplers=[],u._textures={},u._vectors4={},u._floats={},u.locals=new n.UniversalShaderDefines,u._defines=null,u._setupAttachAfterBind(),u.enableShaderChunks=!1,u.materialShaderChunks=new n.UniversalAlbedoChunks,u.customShaderNameResolve=u._buildCustomShader,u.customShaderChunkResolve(),u}return __extends(i,t),i.prototype.updateShaderChunks=function(){},i.prototype.getClassName=function(){return"UniversalAlbedoMaterial"},i.prototype.getShaderName=function(){return"pbr"},i.prototype.getShaderChunk=function(){return null},i.prototype.getShaderDefines=function(){return this._defines},i.prototype.getTexture=function(n){return this._textures[n]},i.prototype.getVector4=function(n){return this._vectors4[n]},i.prototype.getFloat=function(n){return this._floats[n]},i.prototype.setTexture=function(n,t,i){return void 0===i&&(i=!1),i===!0&&this.checkSampler(n),this._textures[n]=t,this},i.prototype.setVector4=function(n,t,i){return void 0===i&&(i=!1),i===!0&&this.checkUniform(n),this._vectors4[n]=t,this},i.prototype.setFloat=function(n,t,i){return void 0===i&&(i=!1),i===!0&&this.checkUniform(n),this._floats[n]=t,this},i.prototype.checkUniform=function(n){this._uniforms.indexOf(n)===-1&&(this._uniforms.push(n),this.locals.defineBoolean(n.toUpperCase()))},i.prototype.checkSampler=function(n){this._samplers.indexOf(n)===-1&&(this._samplers.push(n),this.locals.defineBoolean(n.toUpperCase()),this.checkUniform(n+"Infos"),this.checkUniform(n+"Matrix"))},i.prototype.getAnimatables=function(){var i=t.prototype.getAnimatables.call(this),r,n;for(r in this._textures)n=this._textures[r],n&&n.animations&&n.animations.length>0&&i.push(n);return i},i.prototype.getActiveTextures=function(){var i=t.prototype.getActiveTextures.call(this),r,n;for(r in this._textures)n=this._textures[r],n&&i.push(n);return i},i.prototype.hasTexture=function(n){var i,u,r;if(t.prototype.hasTexture.call(this,n))return!0;i=!1;for(u in this._textures)if(r=this._textures[u],r===r){i=!0;break}return i},i.prototype.dispose=function(n,i){var r,u;if(i)for(r in this._textures)u=this._textures[r],u&&u.dispose(),this._textures[r]=null;this._textures={};t.prototype.dispose.call(this,n,i)},i.prototype.clone=function(t){var i,f=this,r=n.SerializationHelper.Clone(function(){return new n.UniversalAlbedoMaterial(t,f.getScene())},this),u;r._textures={};for(i in this._textures)u=this._textures[i],u&&r.setTexture(i,u.clone(),!0);r._vectors4={};for(i in this._vectors4)r.setVector4(i,this._vectors4[i].clone(),!0);r._floats={};for(i in this._floats)r.setFloat(i,this._floats[i],!0);return r},i.prototype.serialize=function(){var t,i=n.SerializationHelper.Serialize(this),r;i.customType="BABYLON.UniversalAlbedoMaterial";i.textures={};for(t in this._textures)r=this._textures[t],r&&(i.textures[t]=r.serialize());i.vectors4={};for(t in this._vectors4)i.vectors4[t]=this._vectors4[t].asArray();i.floats={};for(t in this._floats)i.floats[t]=this._floats[t];return i},i.Parse=function(t,i,r){var u,f=n.SerializationHelper.Parse(function(){return new n.UniversalAlbedoMaterial(t.name,i)},t,i,r),e;for(u in t.textures)e=t.textures[u],e&&f.setTexture(u,n.Texture.Parse(e,i,r),!0);for(u in t.vectors4)f.setVector4(u,n.Vector4.FromArray(t.vectors4[u]),!0);for(u in t.floats)f.setFloat(u,t.floats[u],!0);return f},i.prototype.customShaderChunkResolve=function(){var d=this.getShaderChunk(),i,t,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k;null!=d&&""!==d&&(i=d+"ShaderChunks",null!=n.Effect.ShadersStore[i]?(t=n.Effect.ShadersStore[i],r=n.Utilities.HasOwnProperty(t,"VertexBegin")?t.VertexBegin:null,null!=r&&""!==r&&(this.materialShaderChunks.Vertex_Begin=r),u=n.Utilities.HasOwnProperty(t,"VertexDefinitions")?t.VertexDefinitions:null,null!=u&&""!==u&&(this.materialShaderChunks.Vertex_Definitions=u),f=n.Utilities.HasOwnProperty(t,"VertexMainBegin")?t.VertexMainBegin:null,null!=f&&""!==f&&(this.materialShaderChunks.Vertex_MainBegin=f),e=n.Utilities.HasOwnProperty(t,"VertexUpdatePosition")?t.VertexUpdatePosition:null,null!=e&&""!==e&&(this.materialShaderChunks.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated")),o=n.Utilities.HasOwnProperty(t,"VertexUpdateNormal")?t.VertexUpdateNormal:null,null!=o&&""!==o&&(this.materialShaderChunks.Vertex_Before_NormalUpdated=o.replace("result","normalUpdated")),s=n.Utilities.HasOwnProperty(t,"VertexMainEnd")?t.VertexMainEnd:null,null!=s&&""!==s&&(this.materialShaderChunks.Vertex_MainEnd=s),h=n.Utilities.HasOwnProperty(t,"FragmentBegin")?t.FragmentBegin:null,null!=h&&""!==h&&(this.materialShaderChunks.Fragment_Begin=h),c=n.Utilities.HasOwnProperty(t,"FragmentDefinitions")?t.FragmentDefinitions:null,null!=c&&""!==c&&(this.materialShaderChunks.Fragment_Definitions=c),l=n.Utilities.HasOwnProperty(t,"FragmentMainBegin")?t.FragmentMainBegin:null,null!=l&&""!==l&&(this.materialShaderChunks.Fragment_MainBegin=l),a=n.Utilities.HasOwnProperty(t,"FragmentUpdateAlbedo")?t.FragmentUpdateAlbedo:null,null!=a&&""!==a&&(this.materialShaderChunks.Fragment_Custom_Albedo=a.replace("result","surfaceAlbedo")),v=n.Utilities.HasOwnProperty(t,"FragmentUpdateAlpha")?t.FragmentUpdateAlpha:null,null!=v&&""!==v&&(this.materialShaderChunks.Fragment_Custom_Alpha=v.replace("result","alpha")),y=n.Utilities.HasOwnProperty(t,"FragmentMetallicRoughness")?t.FragmentMetallicRoughness:null,null!=y&&""!==y&&(this.materialShaderChunks.Fragment_MetallicRoughness=y),p=n.Utilities.HasOwnProperty(t,"FragmentMicroSurface")?t.FragmentMicroSurface:null,null!=p&&""!==p&&(this.materialShaderChunks.Fragment_MicroSurface=p),w=n.Utilities.HasOwnProperty(t,"FragmentBeforeLights")?t.FragmentBeforeLights:null,null!=w&&""!==w&&(this.materialShaderChunks.Fragment_Before_Lights=w),b=n.Utilities.HasOwnProperty(t,"FragmentBeforeFog")?t.FragmentBeforeFog:null,null!=b&&""!==b&&(this.materialShaderChunks.Fragment_Before_Fog=b),k=n.Utilities.HasOwnProperty(t,"FragmentBeforeFragColor")?t.FragmentBeforeFragColor:null,null!=k&&""!==k&&(this.materialShaderChunks.Fragment_Before_FragColor=k.replace("result","color"))):n.Tools.Warn("Failed To Locate Shader Chunk Base: "+i))},i.prototype._buildCustomShader=function(n,t,i,r,u){var e,o,s,c,f,l,a;if(this._defines=u,e=this.getShaderName(),null!=e&&""!==e||(e=n),null!=e&&""!==e||(e="pbr"),o=this.locals.getDefines(),null!=o&&null!=this._defines&&(s=Object.keys(o),null!=s&&s.length>0)){for(var y=this._defines,h=0,v=s;h<v.length;h++)c=v[h],y[c]=o[c];this._defines.rebuild()}if(f=0,null!=this._uniforms&&this._uniforms.length>0)for(f=0;f<this._uniforms.length;f++)l=this._uniforms[f],t.indexOf(l)===-1&&t.push(l);if(f=0,null!=this._samplers&&this._samplers.length>0)for(f=0;f<this._samplers.length;f++)a=this._samplers[f],r.indexOf(a)===-1&&r.push(a);return this.enableShaderChunks===!0?this._createShaderChunks(e):e},i.prototype._createShaderChunks=function(t){var i,u,f;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1;i=this.getShaderChunk();null!=i&&""!==i||(i=t);n.UniversalShaderDefines.ShaderIndexer++;var r=(i+"Custom"+n.UniversalShaderDefines.ShaderIndexer).trim(),e=n.Effect.ShadersStore[t+"VertexShader"],o=n.Effect.ShadersStore[t+"PixelShader"];return this.updateShaderChunks(),u=r+"VertexShader",n.Effect.ShadersStore[u]=e.replace("#define CUSTOM_VERTEX_BEGIN",this.materialShaderChunks.Vertex_Begin?this.materialShaderChunks.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions:"").replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.materialShaderChunks.Vertex_MainBegin?this.materialShaderChunks.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.materialShaderChunks.Vertex_Before_PositionUpdated?this.materialShaderChunks.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.materialShaderChunks.Vertex_Before_NormalUpdated?this.materialShaderChunks.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd:""),f=r+"PixelShader",n.Effect.ShadersStore[f]=o.replace("#define CUSTOM_FRAGMENT_BEGIN",this.materialShaderChunks.Fragment_Begin?this.materialShaderChunks.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.materialShaderChunks.Fragment_MainBegin?this.materialShaderChunks.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.materialShaderChunks.Fragment_Custom_Albedo?this.materialShaderChunks.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.materialShaderChunks.Fragment_Custom_Alpha?this.materialShaderChunks.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.materialShaderChunks.Fragment_MetallicRoughness?this.materialShaderChunks.Fragment_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.materialShaderChunks.Fragment_MicroSurface?this.materialShaderChunks.Fragment_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.materialShaderChunks.Fragment_Before_Lights?this.materialShaderChunks.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog?this.materialShaderChunks.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.materialShaderChunks.Fragment_Before_FragColor?this.materialShaderChunks.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=r,r},i.prototype._attachAfterBind=function(n,t){var i,u=this.getScene(),r;if(u.texturesEnabled)for(i in this._textures)r=this._textures[i],null!=r&&(t.setTexture(i,r),t.setFloat2(i+"Infos",r.coordinatesIndex,r.level),t.setMatrix(i+"Matrix",r.getTextureMatrix()));for(i in this._vectors4)t.setVector4(i,this._vectors4[i]);for(i in this._floats)t.setFloat(i,this._floats[i])},i.prototype._setupAttachAfterBind=function(){var t=this,n=this._afterBind;this._afterBind=function(i,r){if(t._attachAfterBind(i,r),n)try{n(i,r)}catch(u){}}},i}(n.PBRMaterial);n.UniversalAlbedoMaterial=t;n._TypeStore.RegisteredTypes.UniversalAlbedoMaterial=t;i=function(t){function i(i,r){var u=t.call(this,i,r)||this;return u.universalMaterial=!0,u.locals=null,u.terrainInfo=null,u._defines=null,u._uniforms=[],u._samplers=[],u._textures={},u._vectors4={},u._floats={},u.locals=new n.UniversalShaderDefines,u._defines=null,u._setupAttachAfterBind(),u.enableShaderChunks=!1,u.materialShaderChunks=new n.UniversalDiffuseChunks,u.customShaderNameResolve=u._buildCustomShader,u.customShaderChunkResolve(),u}return __extends(i,t),i.prototype.updateShaderChunks=function(){},i.prototype.getClassName=function(){return"UniversalDiffuseMaterial"},i.prototype.getShaderName=function(){return"default"},i.prototype.getShaderChunk=function(){return null},i.prototype.getShaderDefines=function(){return this._defines},i.prototype.getTexture=function(n){return this._textures[n]},i.prototype.getVector4=function(n){return this._vectors4[n]},i.prototype.getFloat=function(n){return this._floats[n]},i.prototype.setTexture=function(n,t,i){return void 0===i&&(i=!1),i===!0&&this.checkSampler(n),this._textures[n]=t,this},i.prototype.setVector4=function(n,t,i){return void 0===i&&(i=!1),i===!0&&this.checkUniform(n),this._vectors4[n]=t,this},i.prototype.setFloat=function(n,t,i){return void 0===i&&(i=!1),i===!0&&this.checkUniform(n),this._floats[n]=t,this},i.prototype.checkUniform=function(n){this._uniforms.indexOf(n)===-1&&(this._uniforms.push(n),this.locals.defineBoolean(n.toUpperCase()))},i.prototype.checkSampler=function(n){this._samplers.indexOf(n)===-1&&(this._samplers.push(n),this.locals.defineBoolean(n.toUpperCase()),this.checkUniform(n+"Infos"),this.checkUniform(n+"Matrix"))},i.prototype.getAnimatables=function(){var i=t.prototype.getAnimatables.call(this),r,n;for(r in this._textures)n=this._textures[r],n&&n.animations&&n.animations.length>0&&i.push(n);return i},i.prototype.getActiveTextures=function(){var i=t.prototype.getActiveTextures.call(this),r,n;for(r in this._textures)n=this._textures[r],n&&i.push(n);return i},i.prototype.hasTexture=function(n){var i,u,r;if(t.prototype.hasTexture.call(this,n))return!0;i=!1;for(u in this._textures)if(r=this._textures[u],r===r){i=!0;break}return i},i.prototype.dispose=function(n,i){var r,u;if(i)for(r in this._textures)u=this._textures[r],u&&u.dispose(),this._textures[r]=null;this._textures={};t.prototype.dispose.call(this,n,i)},i.prototype.clone=function(t){var i,f=this,r=n.SerializationHelper.Clone(function(){return new n.UniversalDiffuseMaterial(t,f.getScene())},this),u;r._textures={};for(i in this._textures)u=this._textures[i],u&&r.setTexture(i,u.clone(),!0);r._vectors4={};for(i in this._vectors4)r.setVector4(i,this._vectors4[i].clone(),!0);r._floats={};for(i in this._floats)r.setFloat(i,this._floats[i],!0);return r},i.prototype.serialize=function(){var t,i=n.SerializationHelper.Serialize(this),r;i.customType="BABYLON.UniversalDiffuseMaterial";i.textures={};for(t in this._textures)r=this._textures[t],r&&(i.textures[t]=r.serialize());i.vectors4={};for(t in this._vectors4)i.vectors4[t]=this._vectors4[t].asArray();i.floats={};for(t in this._floats)i.floats[t]=this._floats[t];return i},i.Parse=function(t,i,r){var u,f=n.SerializationHelper.Parse(function(){return new n.UniversalDiffuseMaterial(t.name,i)},t,i,r),e;for(u in t.textures)e=t.textures[u],e&&f.setTexture(u,n.Texture.Parse(e,i,r),!0);for(u in t.vectors4)f.setVector4(u,n.Vector4.FromArray(t.vectors4[u]),!0);for(u in t.floats)f.setFloat(u,t.floats[u],!0);return f},i.prototype.customShaderChunkResolve=function(){var b=this.getShaderChunk(),i,t,r,u,f,e,o,s,h,c,l,a,v,y,p,w;null!=b&&""!==b&&(i=b+"ShaderChunks",null!=n.Effect.ShadersStore[i]?(t=n.Effect.ShadersStore[i],r=n.Utilities.HasOwnProperty(t,"VertexBegin")?t.VertexBegin:null,null!=r&&""!==r&&(this.materialShaderChunks.Vertex_Begin=r),u=n.Utilities.HasOwnProperty(t,"VertexDefinitions")?t.VertexDefinitions:null,null!=u&&""!==u&&(this.materialShaderChunks.Vertex_Definitions=u),f=n.Utilities.HasOwnProperty(t,"VertexMainBegin")?t.VertexMainBegin:null,null!=f&&""!==f&&(this.materialShaderChunks.Vertex_MainBegin=f),e=n.Utilities.HasOwnProperty(t,"VertexUpdatePosition")?t.VertexUpdatePosition:null,null!=e&&""!==e&&(this.materialShaderChunks.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated")),o=n.Utilities.HasOwnProperty(t,"VertexUpdateNormal")?t.VertexUpdateNormal:null,null!=o&&""!==o&&(this.materialShaderChunks.Vertex_Before_NormalUpdated=o.replace("result","normalUpdated")),s=n.Utilities.HasOwnProperty(t,"VertexMainEnd")?t.VertexMainEnd:null,null!=s&&""!==s&&(this.materialShaderChunks.Vertex_MainEnd=s),h=n.Utilities.HasOwnProperty(t,"FragmentBegin")?t.FragmentBegin:null,null!=h&&""!==h&&(this.materialShaderChunks.Fragment_Begin=h),c=n.Utilities.HasOwnProperty(t,"FragmentDefinitions")?t.FragmentDefinitions:null,null!=c&&""!==c&&(this.materialShaderChunks.Fragment_Definitions=c),l=n.Utilities.HasOwnProperty(t,"FragmentMainBegin")?t.FragmentMainBegin:null,null!=l&&""!==l&&(this.materialShaderChunks.Fragment_MainBegin=l),a=n.Utilities.HasOwnProperty(t,"FragmentUpdateDiffuse")?t.FragmentUpdateDiffuse:null,null!=a&&""!==a&&(this.materialShaderChunks.Fragment_Custom_Diffuse=a.replace("result","diffuseColor")),v=n.Utilities.HasOwnProperty(t,"FragmentUpdateAlpha")?t.FragmentUpdateAlpha:null,null!=v&&""!==v&&(this.materialShaderChunks.Fragment_Custom_Alpha=v.replace("result","alpha")),y=n.Utilities.HasOwnProperty(t,"FragmentBeforeLights")?t.FragmentBeforeLights:null,null!=y&&""!==y&&(this.materialShaderChunks.Fragment_Before_Lights=y),p=n.Utilities.HasOwnProperty(t,"FragmentBeforeFog")?t.FragmentBeforeFog:null,null!=p&&""!==p&&(this.materialShaderChunks.Fragment_Before_Fog=p),w=n.Utilities.HasOwnProperty(t,"FragmentBeforeFragColor")?t.FragmentBeforeFragColor:null,null!=w&&""!==w&&(this.materialShaderChunks.Fragment_Before_FragColor=w.replace("result","color"))):n.Tools.Warn("Failed To Locate Shader Chunk Base: "+i))},i.prototype._buildCustomShader=function(n,t,i,r,u){var e,o,s,c,f,l,a;if(this._defines=u,e=this.getShaderName(),null!=e&&""!==e||(e=n),null!=e&&""!==e||(e="default"),o=this.locals.getDefines(),null!=o&&null!=this._defines&&(s=Object.keys(o),null!=s&&s.length>0)){for(var y=this._defines,h=0,v=s;h<v.length;h++)c=v[h],y[c]=o[c];this._defines.rebuild()}if(f=0,null!=this._uniforms&&this._uniforms.length>0)for(f=0;f<this._uniforms.length;f++)l=this._uniforms[f],t.indexOf(l)===-1&&t.push(l);if(f=0,null!=this._samplers&&this._samplers.length>0)for(f=0;f<this._samplers.length;f++)a=this._samplers[f],r.indexOf(a)===-1&&r.push(a);return this.enableShaderChunks===!0?this._createShaderChunks(e):e},i.prototype._createShaderChunks=function(t){var i,u,f;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1;i=this.getShaderChunk();null!=i&&""!==i||(i=t);n.UniversalShaderDefines.ShaderIndexer++;var r=(i+"Custom"+n.UniversalShaderDefines.ShaderIndexer).trim(),e=n.Effect.ShadersStore[t+"VertexShader"],o=n.Effect.ShadersStore[t+"PixelShader"];return this.updateShaderChunks(),u=r+"VertexShader",n.Effect.ShadersStore[u]=e.replace("#define CUSTOM_VERTEX_BEGIN",this.materialShaderChunks.Vertex_Begin?this.materialShaderChunks.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",this.materialShaderChunks.Vertex_Definitions?this.materialShaderChunks.Vertex_Definitions:"").replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.materialShaderChunks.Vertex_MainBegin?this.materialShaderChunks.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.materialShaderChunks.Vertex_Before_PositionUpdated?this.materialShaderChunks.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.materialShaderChunks.Vertex_Before_NormalUpdated?this.materialShaderChunks.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.materialShaderChunks.Vertex_MainEnd?this.materialShaderChunks.Vertex_MainEnd:""),f=r+"PixelShader",n.Effect.ShadersStore[f]=o.replace("#define CUSTOM_FRAGMENT_BEGIN",this.materialShaderChunks.Fragment_Begin?this.materialShaderChunks.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",this.materialShaderChunks.Fragment_Definitions?this.materialShaderChunks.Fragment_Definitions:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.materialShaderChunks.Fragment_MainBegin?this.materialShaderChunks.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE",this.materialShaderChunks.Fragment_Custom_Diffuse?this.materialShaderChunks.Fragment_Custom_Diffuse:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.materialShaderChunks.Fragment_Custom_Alpha?this.materialShaderChunks.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.materialShaderChunks.Fragment_Before_Lights?this.materialShaderChunks.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.materialShaderChunks.Fragment_Before_Fog?this.materialShaderChunks.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.materialShaderChunks.Fragment_Before_FragColor?this.materialShaderChunks.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=r,r},i.prototype._attachAfterBind=function(n,t){var i,u=this.getScene(),r;if(u.texturesEnabled)for(i in this._textures)r=this._textures[i],null!=r&&(t.setTexture(i,r),t.setFloat2(i+"Infos",r.coordinatesIndex,r.level),t.setMatrix(i+"Matrix",r.getTextureMatrix()));for(i in this._vectors4)t.setVector4(i,this._vectors4[i]);for(i in this._floats)t.setFloat(i,this._floats[i])},i.prototype._setupAttachAfterBind=function(){var t=this,n=this._afterBind;this._afterBind=function(i,r){if(t._attachAfterBind(i,r),n)try{n(i,r)}catch(u){}}},i}(n.StandardMaterial);n.UniversalDiffuseMaterial=i;n._TypeStore.RegisteredTypes.UniversalDiffuseMaterial=i;r=function(t){function i(n,i){var r=t.call(this,n,i)||this;return r.enableShaderChunks=!0,r}return __extends(i,t),i.prototype.getClassName=function(){return"UniversalTerrainMaterial"},i.prototype.getShaderName=function(){return"pbr"},i.prototype.getShaderChunk=function(){return null},i.prototype.updateShaderChunks=function(){var u="surfaceAlbedo",t="splatmapSampler",i="detailsSampler",r="normalsSampler",f=n.System.GammaCorrection;this.materialShaderChunks.Vertex_Definitions=null!=this.materialShaderChunks.Vertex_Definitions&&""!==this.materialShaderChunks.Vertex_Definitions?this.formatTerrainVertexDefintions()+this.materialShaderChunks.Vertex_Definitions:this.formatTerrainVertexDefintions();this.materialShaderChunks.Vertex_MainEnd=null!=this.materialShaderChunks.Vertex_MainEnd&&""!==this.materialShaderChunks.Vertex_MainEnd?this.formatTerrainVertexMainEnd()+this.materialShaderChunks.Vertex_MainEnd:this.formatTerrainVertexMainEnd();this.materialShaderChunks.Fragment_Definitions=null!=this.materialShaderChunks.Fragment_Definitions&&""!==this.materialShaderChunks.Fragment_Definitions?this.formatTerrainFragmentDefintions(t,i,r)+this.materialShaderChunks.Fragment_Definitions:this.formatTerrainFragmentDefintions(t,i,r);this.materialShaderChunks.Fragment_Custom_Albedo=null!=this.materialShaderChunks.Fragment_Custom_Albedo&&""!==this.materialShaderChunks.Fragment_Custom_Albedo?this.formatTerrainFragmentUpdateColor(this.terrainInfo,u,t,i,r,f)+this.materialShaderChunks.Fragment_Custom_Albedo:this.formatTerrainFragmentUpdateColor(this.terrainInfo,u,t,i,r,f)},i.prototype.formatTerrainVertexDefintions=function(){return"\r\n#define TERRAIN_VERTEX_DEFINITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\n\r\n"},i.prototype.formatTerrainVertexMainEnd=function(){return"\r\n#define TERRAIN_VERTEX_MAIN_END\r\n\r\n#ifdef UV1\r\nvSplatmapUV = uv;\r\n#endif\r\n\r\n"},i.prototype.formatTerrainFragmentDefintions=function(n,t,i){return"\r\n#define TERRAIN_FRAGMENT_DEFNITIONS\r\n\r\nvarying vec2 vSplatmapUV;\r\nuniform sampler2D "+n+";\r\nuniform sampler2D "+t+";\r\nuniform sampler2D "+i+";\r\n\r\nfloat calculateMipmapLevel(const in vec2 uvs, const in vec2 size)\r\n{\r\n    vec2 dx = dFdx(uvs * size.x);\r\n    vec2 dy = dFdy(uvs * size.y);\r\n    float d = max(dot(dx, dx), dot(dy, dy));\r\n    return 0.4 * log2(d);\r\n}\r\n\r\nvec4 sampleTextureAtlas2D(const in sampler2D atlas, const in float gamma, const in vec2 tile, const in vec4 rect, in vec2 uvs, in float lod)\r\n{\r\n    if (lod < 0.0) lod = clamp(calculateMipmapLevel(uvs, vec2(tile.x, tile.x)), 0.0, tile.y);   // Tile Info (tile.xy)\r\n    float size = pow(2.0, tile.y - lod);                                                        // Tile Bits (tile.y)\r\n    float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n    float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n    uvs = fract(uvs);                                                                           // Perfrom Tiling (fract)\r\n    uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n    uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    vec4 color = texture2DLodEXT(atlas, uvs, lod);\r\n    if (gamma != 1.0) {\r\n        color.r = pow(color.r, gamma);\r\n        color.g = pow(color.g, gamma);\r\n        color.b = pow(color.b, gamma);\r\n    }\r\n    return color;\r\n}\r\n\r\nvec4 sampleSplatmapAtlas2D(const in sampler2D atlas, const in vec2 tile, const in vec4 rect, in vec2 uvs)\r\n{\r\n    float size = pow(2.0, tile.y);                                                              // Tile Bits (tile.y)\r\n\t   float sizex = size / rect.z;                                                                // Tile Width (rect.z)\r\n\t   float sizey = size / rect.w;                                                                // Tile Height (rect.w)\r\n\t   uvs.x = uvs.x * ((sizex * rect.z - 1.0) / sizex) + 0.5 / sizex + rect.z * rect.x;           // Tile Position X (rect.x)\r\n\t   uvs.y = uvs.y * ((sizey * rect.w - 1.0) / sizey) + 0.5 / sizey + rect.w * rect.y;           // Tile Position Y (rect.y)\r\n    return texture2D(atlas, uvs);\r\n}\r\n\r\nvec3 blendSplatmapAtlasColors(const in vec4 splatmap, in vec4 color1, in vec4 color2, in vec4 color3, in vec4 color4, in vec3 mixbuffer)\r\n{\r\n    mixbuffer += (color1.rgb * splatmap.r);\r\n    mixbuffer += (color2.rgb * splatmap.g);\r\n    mixbuffer += (color3.rgb * splatmap.b);\r\n    mixbuffer += (color4.rgb * splatmap.a);\r\n    return mixbuffer;\r\n}\r\n\r\nvec3 perturbNormalSamplerColor(mat3 cotangentFrame, vec3 samplerColor, float scale)\r\n{\r\n    vec3 map = samplerColor.xyz;\r\n    map = map * 2.00787402 - 1.00787402;\r\n    #ifdef NORMALXYSCALE\r\n        map = normalize(map * vec3(scale, scale, 1.0));\r\n    #endif\r\n    return normalize(cotangentFrame * map);\r\n}\r\n\r\n\r\n"},i.prototype.formatTerrainFragmentUpdateColor=function(n,t,i,r,u,f){var o,e,c,a,s,h,l;if(void 0===f&&(f=1),o="",null!=n&&null!=n.textureAtlas&&null!=n.splatmapAtlas&&n.splatmapCount>1){for(o="\r\n#define TERRAIN_FRAGMENT_UPDATE_COLOR\r\n\r\nvec3 normalsColor = vec3(0.5, 0.5, 1.0);\r\nvec3 normalsBuffer = vec3(0.0, 0.0, 0.0);\r\nvec3 splatmapBuffer = vec3(0.0, 0.0, 0.0);\r\nfloat autoMipMapLevel = -1.0;\r\nfloat normalCorrection = 1.0;\r\nfloat detailCorrection = "+f.toFixed(4)+";\r\n\r\n#if defined(ALBEDO) && defined("+i.toUpperCase()+") && defined("+r.toUpperCase()+")\r\n\r\n// Reset Normal Values\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    uvOffset = vec2(0.0, 0.0);\r\n    #ifdef NORMAL\r\n        normalW = normalize(vNormalW);\r\n    #else\r\n        normalW = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n    #endif\r\n    #ifdef CLEARCOAT\r\n        clearCoatNormalW = normalW;\r\n    #endif\r\n    #if defined(BUMP) || defined(PARALLAX)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV);\r\n        #endif\r\n    #elif defined(ANISOTROPIC)\r\n        #if defined(TANGENT) && defined(NORMAL)\r\n            TBN = vTBN;\r\n        #else\r\n            TBN = cotangent_frame(normalW, vPositionW, vSplatmapUV, vec2(1.0, 1.0));\r\n        #endif\r\n    #endif\r\n    #ifdef PARALLAX\r\n        invTBN = transposeMat3(TBN);\r\n    #endif\r\n    normalW = perturbNormalSamplerColor(TBN, normalsColor, 1.0);\r\n#endif\r\n\r\n// Global Atlas Values\r\nfloat splatTileSize = "+n.splatmapAtlas[2].toFixed(4)+";\r\nfloat splatTileBits = "+n.splatmapAtlas[3].toFixed(4)+";\r\nfloat detailTileSize = "+n.textureAtlas[2].toFixed(4)+";\r\nfloat detailTileBits = "+n.textureAtlas[3].toFixed(4)+";\r\n\r\n// Sample splatmap textures\r\n",e=0,c=0;c<n.splatmapCount;c++)e=4*c,a=n["splatmapRect"+c],(o+="vec4 splatmapRect"+c+" = vec4("+a[0].toFixed(4)+", "+a[1].toFixed(4)+", "+a[2].toFixed(4)+", "+a[3].toFixed(4)+");\r\n",o+="vec4 splatmapAlbedo"+c+" = sampleSplatmapAtlas2D("+i+", vec2(splatTileSize, splatTileBits), splatmapRect"+c+", (vSplatmapUV + uvOffset));\r\n",o+="vec4 textureAlbedo"+(e+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",o+="vec4 textureAlbedo"+(e+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",o+="vec4 textureAlbedo"+(e+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",o+="vec4 textureAlbedo"+(e+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",n["textureRect"+(e+0)])&&(s=n["textureRect"+(e+0)],h=n["textureInfo"+(e+0)],o+="vec4 textureRect"+(e+0)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n",o+="vec2 textureScale"+(e+0)+" = vec2("+h[0].toFixed(4)+", "+h[1].toFixed(4)+");\r\n",o+="vec2 textureOffset"+(e+0)+" = vec2("+h[2].toFixed(4)+", "+h[3].toFixed(4)+");\r\n",o+="vec2 textureTileUV"+(e+0)+" = ((vSplatmapUV + textureOffset"+(e+0)+") * textureScale"+(e+0)+");\r\n",o+="textureAlbedo"+(e+0)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(e+0)+", textureTileUV"+(e+0)+", autoMipMapLevel);\r\n"),n["textureRect"+(e+1)]&&(s=n["textureRect"+(e+1)],h=n["textureInfo"+(e+1)],o+="vec4 textureRect"+(e+1)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n",o+="vec2 textureScale"+(e+1)+" = vec2("+h[0].toFixed(4)+", "+h[1].toFixed(4)+");\r\n",o+="vec2 textureOffset"+(e+1)+" = vec2("+h[2].toFixed(4)+", "+h[3].toFixed(4)+");\r\n",o+="vec2 textureTileUV"+(e+1)+" = ((vSplatmapUV + textureOffset"+(e+1)+") * textureScale"+(e+1)+");\r\n",o+="textureAlbedo"+(e+1)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(e+1)+", textureTileUV"+(e+1)+", autoMipMapLevel);\r\n"),n["textureRect"+(e+2)]&&(s=n["textureRect"+(e+2)],h=n["textureInfo"+(e+2)],o+="vec4 textureRect"+(e+2)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n",o+="vec2 textureScale"+(e+2)+" = vec2("+h[0].toFixed(4)+", "+h[1].toFixed(4)+");\r\n",o+="vec2 textureOffset"+(e+2)+" = vec2("+h[2].toFixed(4)+", "+h[3].toFixed(4)+");\r\n",o+="vec2 textureTileUV"+(e+2)+" = ((vSplatmapUV + textureOffset"+(e+2)+") * textureScale"+(e+2)+");\r\n",o+="textureAlbedo"+(e+2)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(e+2)+", textureTileUV"+(e+2)+", autoMipMapLevel);\r\n"),n["textureRect"+(e+3)]&&(s=n["textureRect"+(e+3)],h=n["textureInfo"+(e+3)],o+="vec4 textureRect"+(e+3)+" = vec4("+s[0].toFixed(4)+", "+s[1].toFixed(4)+", "+s[2].toFixed(4)+", "+s[3].toFixed(4)+");\r\n",o+="vec2 textureScale"+(e+3)+" = vec2("+h[0].toFixed(4)+", "+h[1].toFixed(4)+");\r\n",o+="vec2 textureOffset"+(e+3)+" = vec2("+h[2].toFixed(4)+", "+h[3].toFixed(4)+");\r\n",o+="vec2 textureTileUV"+(e+3)+" = ((vSplatmapUV + textureOffset"+(e+3)+") * textureScale"+(e+3)+");\r\n",o+="textureAlbedo"+(e+3)+" = sampleTextureAtlas2D("+r+", detailCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(e+3)+", textureTileUV"+(e+3)+", autoMipMapLevel);\r\n"),(o+="splatmapBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+c+", textureAlbedo"+(e+0)+", textureAlbedo"+(e+1)+", textureAlbedo"+(e+2)+", textureAlbedo"+(e+3)+", splatmapBuffer);\r\n",o+="#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n",o+="    #if defined("+u.toUpperCase()+")\r\n",o+="        vec4 normalColor"+(e+0)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",o+="        vec4 normalColor"+(e+1)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",o+="        vec4 normalColor"+(e+2)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",o+="        vec4 normalColor"+(e+3)+" = vec4(0.0, 0.0, 0.0, 1.0);\r\n",n["textureRect"+(e+0)])&&(l=n["normalsScale"+(e+0)],o+="        float normalScale"+(e+0)+" = "+l.toFixed(4)+";\r\n",o+="        normalColor"+(e+0)+" = sampleTextureAtlas2D("+u+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(e+0)+", textureTileUV"+(e+0)+", autoMipMapLevel);\r\n",o+="        normalColor"+(e+0)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(e+0)+".rgb, normalScale"+(e+0)+");\r\n"),n["textureRect"+(e+1)]&&(l=n["normalsScale"+(e+1)],o+="        float normalScale"+(e+1)+" = "+l.toFixed(4)+";\r\n",o+="        normalColor"+(e+1)+" = sampleTextureAtlas2D("+u+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(e+1)+", textureTileUV"+(e+1)+", autoMipMapLevel);\r\n",o+="        normalColor"+(e+1)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(e+1)+".rgb, normalScale"+(e+1)+");\r\n"),n["textureRect"+(e+2)]&&(l=n["normalsScale"+(e+2)],o+="        float normalScale"+(e+2)+" = "+l.toFixed(4)+";\r\n",o+="        normalColor"+(e+2)+" = sampleTextureAtlas2D("+u+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(e+2)+", textureTileUV"+(e+2)+", autoMipMapLevel);\r\n",o+="        normalColor"+(e+2)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(e+2)+".rgb, normalScale"+(e+2)+");\r\n"),n["textureRect"+(e+3)]&&(l=n["normalsScale"+(e+3)],o+="        float normalScale"+(e+3)+" = "+l.toFixed(4)+";\r\n",o+="        normalColor"+(e+3)+" = sampleTextureAtlas2D("+u+", normalCorrection, vec2(detailTileSize, detailTileBits), textureRect"+(e+3)+", textureTileUV"+(e+3)+", autoMipMapLevel);\r\n",o+="        normalColor"+(e+3)+".rgb = perturbNormalSamplerColor(TBN, normalColor"+(e+3)+".rgb, normalScale"+(e+3)+");\r\n"),o+="        normalsBuffer = blendSplatmapAtlasColors(splatmapAlbedo"+c+", normalColor"+(e+0)+", normalColor"+(e+1)+", normalColor"+(e+2)+", normalColor"+(e+3)+", normalsBuffer);\r\n",o+="    #endif\r\n",o+="#endif\r\n",o+="\r\n";o+="// Update Color Values\r\n"+t+".rgb = splatmapBuffer;\r\n#if defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC)\r\n    #if defined("+u.toUpperCase()+")\r\n        normalW = normalsBuffer;\r\n    #endif\r\n    #if defined(FORCENORMALFORWARD) && defined(NORMAL)\r\n        vec3 faceNormal = normalize(cross(dFdx(vPositionW), dFdy(vPositionW))) * vEyePosition.w;\r\n        #if defined(TWOSIDEDLIGHTING)\r\n            faceNormal = gl_FrontFacing ? faceNormal : -faceNormal;\r\n        #endif\r\n        normalW *= sign(dot(normalW, faceNormal));\r\n    #endif\r\n    #if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\r\n        normalW = gl_FrontFacing ? normalW : -normalW;\r\n    #endif\r\n#endif\r\n\r\n#endif\r\n\r\n"}return o},i}(n.UniversalAlbedoMaterial);n.UniversalTerrainMaterial=r;n._TypeStore.RegisteredTypes.UniversalTerrainMaterial=r}(BABYLON||(BABYLON={}));__extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(n){var t=function(t){function i(n,i,r){return void 0===r&&(r={}),t.call(this,n,i,r)||this}return __extends(i,t),i.prototype.start=function(){},i.prototype.update=function(){},i.prototype.after=function(){},i.prototype.destroy=function(){},i.IsXboxLivePluginEnabled=function(){return!!window.isXboxLivePluginEnabled&&window.isXboxLivePluginEnabled()},i.IsXboxLiveUserSignedIn=function(t,i){if(void 0===t&&(t=null),void 0===i&&(i=n.PlayerNumber.One),n.WindowsPlatform.IsXboxLivePluginEnabled()){var r=null!=t?n.WindowsPlatform.GetXboxLiveSystemUser(t,i):n.WindowsPlatform.GetXboxLiveUser(i);return null!=r&&1==r.isSignedIn}return!1},i.XboxLiveUserSignIn=function(t,i,r,u){void 0===t&&(t=n.PlayerNumber.One);n.WindowsPlatform.IsXboxLivePluginEnabled()&&n.WindowsPlatform.XboxLiveUserSilentSignIn(t,function(f){f.status===Microsoft.Xbox.Services.System.SignInStatus.userInteractionRequired?n.WindowsPlatform.XboxLiveUserDialogSignIn(t,function(n){i&&i(n)},r,u):i&&i(f)},r,u)},i.XboxLiveUserSilentSignIn=function(t,i,r,u){return void 0===t&&(t=n.PlayerNumber.One),n.WindowsPlatform.IsXboxLivePluginEnabled()?n.WindowsPlatform.GetXboxLiveUser(t).signInSilentlyAsync(null).then(i,r,u):null},i.XboxLiveUserDialogSignIn=function(t,i,r,u){return void 0===t&&(t=n.PlayerNumber.One),n.WindowsPlatform.IsXboxLivePluginEnabled()?n.WindowsPlatform.GetXboxLiveUser(t).signInAsync(null).then(i,r,u):null},i.LoadXboxLiveUserProfile=function(t,i,r,u){return void 0===t&&(t=n.PlayerNumber.One),n.WindowsPlatform.IsXboxLivePluginEnabled()?n.WindowsPlatform.GetXboxLiveUserContext(t).profileService.getUserProfileAsync(n.WindowsPlatform.GetXboxLiveUser(t).xboxUserId).then(i,r,u):null},i.GetXboxLiveUser=function(t){void 0===t&&(t=n.PlayerNumber.One);var i=null;if(n.WindowsPlatform.IsXboxLivePluginEnabled())switch(t){case n.PlayerNumber.One:i=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserOne();break;case n.PlayerNumber.Two:i=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserTwo();break;case n.PlayerNumber.Three:i=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserThree();break;case n.PlayerNumber.Four:i=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveUserFour()}return i},i.GetXboxLiveSystemUser=function(t,i){void 0===i&&(i=n.PlayerNumber.One);var r=null;if(n.WindowsPlatform.IsXboxLivePluginEnabled())switch(i){case n.PlayerNumber.One:r=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserOne(t);break;case n.PlayerNumber.Two:r=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserTwo(t);break;case n.PlayerNumber.Three:r=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserThree(t);break;case n.PlayerNumber.Four:r=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveSystemUserFour(t)}return r},i.GetXboxLiveUserContext=function(t){void 0===t&&(t=n.PlayerNumber.One);var i=null;if(n.WindowsPlatform.IsXboxLivePluginEnabled())switch(t){case n.PlayerNumber.One:i=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextOne();break;case n.PlayerNumber.Two:i=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextTwo();break;case n.PlayerNumber.Three:i=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextThree();break;case n.PlayerNumber.Four:i=window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextFour()}return i},i.ResetXboxLiveUserContext=function(t){if(void 0===t&&(t=n.PlayerNumber.One),n.WindowsPlatform.IsXboxLivePluginEnabled()&&n.WindowsPlatform.IsXboxLivePluginEnabled())switch(t){case n.PlayerNumber.One:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextOne();break;case n.PlayerNumber.Two:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextTwo();break;case n.PlayerNumber.Three:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextThree();break;case n.PlayerNumber.Four:window.BabylonToolkit.XboxLive.Plugin.resetXboxLiveUserContextFour()}},i.GetXboxLiveContextProperty=function(t){return n.WindowsPlatform.IsXboxLivePluginEnabled()?window.BabylonToolkit.XboxLive.Plugin.getXboxLiveContextProperty(t):null},i.SetXboxLiveContextProperty=function(t,i){n.WindowsPlatform.IsXboxLivePluginEnabled()&&window.BabylonToolkit.XboxLive.Plugin.setXboxLiveContextProperty(t,i)},i.ResetXboxLivePropertyContexts=function(){n.WindowsPlatform.IsXboxLivePluginEnabled()&&window.BabylonToolkit.XboxLive.Plugin.resetXboxLivePropertyContexts()},i.SetXboxLiveSignOutHandler=function(t){void 0===t&&(t=null);n.WindowsPlatform.IsXboxLivePluginEnabled()&&(window.BabylonToolkit.XboxLive.Plugin.onusersignout=t)},i}(n.ScriptComponent);n.WindowsPlatform=t}(BABYLON||(BABYLON={}));BABYLON.SceneManager.IsXboxOne()&&navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="gamepad");BABYLON.SceneManager.IsWindows()&&"undefined"!=typeof Windows.UI.ViewManagement&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode&&"undefined"!=typeof Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow)

// worker.js
var versionStamp="###VERSION###",installFiles=["###INSTALL###"];self.addEventListener("message",function(n){if(n.data!=null&&n.data==="version"&&n.ports!=null&&n.ports.length>0){var t=n.ports[0];t&&t.postMessage&&t.postMessage(versionStamp)}});self.addEventListener("install",function(n){n.waitUntil(caches.open(versionStamp).then(function(n){var t=installFiles.map(function(t){var i=new URL(t,location.href),r;return i.search+=(i.search?"&":"?")+"time="+(new Date).getTime().toString(),r=new Request(i,{mode:"no-cors"}),fetch(r,{cache:"no-store"}).then(function(i){if(i.status>=400)throw new Error("request for "+t+" failed with status "+i.statusText);return n.put(t,i)}).catch(function(){})});return Promise.all(t).then(function(){return self.skipWaiting()})}).catch(function(){}))});self.addEventListener("activate",function(n){return n.waitUntil(caches.keys().then(function(n){return Promise.all(n.map(function(n){if(n!==versionStamp)return caches.delete(n)}))})),self.clients.claim()});self.addEventListener("fetch",function(n){if(n.request.cache==="only-if-cached"&&n.request.mode!=="same-origin"){var t=n.request.clone();console.warn("Chrome Dev Tools. Request cache has only-if-cached, but not same-origin.",t.cache,t.mode,"request redirect:",t.redirect,t.url,t);return}n.respondWith(caches.match(n.request).then(function(t){return t||fetch(n.request,{cache:"no-store"})}))})

// BabylonPlayground.js
var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},PROJECT;(function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.keys=!0,u.show=!0,u.popup=!1,u.views=!1,u.xbox=!1,u.keys=u.getEditorProperty("enableDebugKeys",u.keys),u.show=u.getEditorProperty("showDebugLabels",u.show),u.popup=u.getEditorProperty("popupDebugPanel",u.popup),u.views=u.getEditorProperty("togglePlayerViews",u.views),u.xbox=u.getEditorProperty("allowXboxLiveSignIn",u.xbox),BABYLON.SceneManager.IsWindows()&&(u.popup=!1),BABYLON.Tools.Log("Debug information overlay loaded"),u}return __extends(t,n),t.prototype.start=function(){var n=this,t,i;this.show===!0;this.keys===!0&&(this.views===!0&&(console.log("Enable Multiplayer Keys"),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num1,function(){BABYLON.UniversalCameraSystem.SetMultiPlayerViewLayout(n.scene,1);console.log("1 player pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num2,function(){BABYLON.UniversalCameraSystem.SetMultiPlayerViewLayout(n.scene,2);console.log("2 players pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num3,function(){BABYLON.UniversalCameraSystem.SetMultiPlayerViewLayout(n.scene,3);console.log("3 players pressed")}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.Num4,function(){BABYLON.UniversalCameraSystem.SetMultiPlayerViewLayout(n.scene,4);console.log("4 players pressed")})),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.R,function(){window.location.reload()}),BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.I,function(){n.popup===!0?BABYLON.SceneManager.PopupDebug(n.scene):BABYLON.SceneManager.ToggleDebug(n.scene,!0,null)}),BABYLON.SceneManager.IsXboxOne()?navigator.gamepadInputEmulation&&BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.M,function(){navigator.gamepadInputEmulation=navigator.gamepadInputEmulation!=="mouse"?"mouse":"gamepad"}):BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.F,function(){n.scene.getEngine().enterFullscreen(!0)}),BABYLON.WindowsPlatform.IsXboxLivePluginEnabled()&&this.xbox===!0&&BABYLON.SceneManager.OnKeyboardPress(BABYLON.UserInputKey.X,function(){var n=BABYLON.PlayerNumber.One;BABYLON.WindowsPlatform.IsXboxLiveUserSignedIn(null,n)?(BABYLON.Tools.Warn("Xbox Live User Already Signed In"),BABYLON.SceneManager.AlertMessage("User Already Signed In","Xbox Live Warning")):(BABYLON.Tools.Log("===> Trying Xbox Live Sign In For Player: "+n.toString()),BABYLON.WindowsPlatform.XboxLiveUserSignIn(n,function(){var t=BABYLON.WindowsPlatform.GetXboxLiveUser(n),i="("+t.xboxUserId+") - "+t.gamertag;BABYLON.SceneManager.AlertMessage(i,"Xbox Live User Signed In")},function(n){console.log(n);var t="Encountered Sign Error";BABYLON.Tools.Warn(t);BABYLON.SceneManager.AlertMessage(t,"Xbox Live Warning")}))}));t=this.scene.getEngine().webGLVersion<2?"red":"#0c0";i=BABYLON.SceneManager.GetWebGLVersionString(this.scene);BABYLON.Utilities.PrintToScreen(i,t)},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.DebugInformation=t})(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){var h,f;r===void 0&&(r={});var u=n.call(this,t,i,r)||this,o=u.getEditorProperty("type",0),s={mass:u.getEditorProperty("mass",1),friction:u.getEditorProperty("friction",.3),restitution:u.getEditorProperty("restitution",.3),pressure:u.getEditorProperty("pressure",200),velocityIterations:u.getEditorProperty("velocityIterations",20),positionIterations:u.getEditorProperty("positionIterations",20),stiffness:u.getEditorProperty("stiffness",1),margin:u.getEditorProperty("margin",0),damping:u.getEditorProperty("damping",.01)},e=u.getTransformMesh(),c=u.getEditorProperty("forceSharedVertices",!0);return c===!0&&e.forceSharedVertices(),h=u.getEditorProperty("increaseVertices",4),h>0&&e.increaseVertices(h),f=null,o===0?f=new BABYLON.PhysicsImpostor(e,BABYLON.PhysicsImpostor.SoftbodyImpostor,s,u.scene):o===1?f=new BABYLON.PhysicsImpostor(e,BABYLON.PhysicsImpostor.ClothImpostor,s,u.scene):o===2&&(f=new BABYLON.PhysicsImpostor(e,BABYLON.PhysicsImpostor.RopeImpostor,s,u.scene)),f!=null&&f.executeNativeFunction(function(){}),u}return __extends(t,n),t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.SoftbodyMesh=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.deltaFactor=2,u.attachCamera=!0,u.cameraPivot=null,u.cameraRigger=null,u.movementSpeed=1,u.jumpingVelocity=10,u.playerMovement=BABYLON.Vector3.Zero(),u.playerTurnRate=0,u.cameraPitchRate=0,u.horzSensitivity=1,u.vertSensitivity=1,u.mouseSensitivity=1,u.minimumPitchAngle=-60,u.maximumPitchAngle=60,u.isCharacterGrounded=!1,u.isCharacterJumpFrame=!1,u.cameraEulerAngles=BABYLON.Vector3.Zero(),u.characterController=null,u.buttonJump=BABYLON.Xbox360Button.A,u.keyboardJump=BABYLON.UserInputKey.SpaceBar,u.playerNumber=BABYLON.PlayerNumber.One,u.playerDeltaX=0,u.playerDeltaZ=0,u.playerMouseX=0,u.playerMouseY=0,u.playerEyeLevel=.5,u.attachCamera=u.getEditorProperty("attachCamera",u.attachCamera),u.playerNumber=u.getEditorProperty("playerNumber",u.playerNumber),u.playerEyeLevel=u.getEditorProperty("playerEyeLevel",u.playerEyeLevel),u.movementSpeed=u.getEditorProperty("movementSpeed",u.movementSpeed),u.mouseSensitivity=u.getEditorProperty("mouseSensitivity",u.mouseSensitivity),u.minimumPitchAngle=u.getEditorProperty("minimumPitchAngle",u.minimumPitchAngle),u.maximumPitchAngle=u.getEditorProperty("maximumPitchAngle",u.maximumPitchAngle),u.vertSensitivity=u.getEditorProperty("verticalSensitivity",u.vertSensitivity),u.horzSensitivity=u.getEditorProperty("horizontalSensitivity",u.horzSensitivity),u.jumpingVelocity=u.getEditorProperty("impulseJumpVelocity",u.jumpingVelocity),u.playerNumber==BABYLON.PlayerNumber.One&&(BABYLON.UserInputOptions.PointerAngularSensibility=BABYLON.UserInputOptions.PointerAngularSensibility*u.mouseSensitivity),u}return __extends(t,n),t.prototype.isCharacterJumping=function(){return!1},t.prototype.isCharacterFalling=function(){return!1},t.prototype.getCharacterController=function(){return this.characterController},t.prototype.start=function(){this.setupFirstPersonController()},t.prototype.update=function(){this.updateFirstPersonController()},t.prototype.destroy=function(){this.destroyFirstPersonController()},t.prototype.setupFirstPersonController=function(){this.cameraPivot=this.getChildTransform("Pivot");this.cameraPivot==null&&(this.cameraPivot=new BABYLON.TransformNode("Pivot",this.scene),this.cameraPivot.setParent(this.transform),this.cameraPivot.position=new BABYLON.Vector3(0,this.playerEyeLevel,0));BABYLON.Utilities.ValidateTransformQuaternion(this.cameraPivot);this.attachCamera===!0&&(this.cameraRigger=BABYLON.SceneManager.GetTransformNode(this.scene,"Main Camera"),this.cameraRigger!=null&&this.cameraPivot!=null?(this.cameraPivot.position=new BABYLON.Vector3(0,this.playerEyeLevel,0),this.cameraRigger.setParent(this.cameraPivot),this.cameraRigger.position=new BABYLON.Vector3(0,0,0),this.cameraRigger.rotationQuaternion=BABYLON.Quaternion.Identity(),console.log("FPC: Attached main camera to player controller: "+this.transform.name)):BABYLON.Tools.Warn("Failed to locate camera or local pivot for: "+this.transform.name));this.characterController=this.getComponent("BABYLON.CharacterController");this.characterController==null&&BABYLON.Tools.Warn("Failed to locate character controller for: "+this.transform.name);this.characterController!=null&&(this.characterController.registerOnCollisionEnter(function(n){var t=BABYLON.SceneManager.GetTransformTag(n)}),this.characterController.registerOnCollisionStay(function(n){var t=BABYLON.SceneManager.GetTransformTag(n)}),this.characterController.registerOnCollisionExit(function(n){var t=BABYLON.SceneManager.GetTransformTag(n)}))},t.prototype.updateFirstPersonController=function(){var n=this.getDeltaSeconds();this.playerDeltaX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Horizontal,this.playerNumber);this.playerDeltaZ=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Vertical,this.playerNumber);this.playerMouseX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseX,this.playerNumber);this.playerMouseY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseY,this.playerNumber);Math.abs(this.playerDeltaX)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerDeltaX=0);Math.abs(this.playerDeltaZ)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerDeltaZ=0);Math.abs(this.playerMouseX)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerMouseX=0);Math.abs(this.playerMouseY)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerMouseY=0);this.characterController!=null&&(this.isCharacterGrounded=this.characterController.isGrounded(),this.isCharacterJumpFrame=!1,this.playerTurnRate=this.playerMouseX*this.horzSensitivity*this.deltaFactor,this.characterController.turn(this.playerTurnRate),this.cameraPitchRate=this.playerMouseY*this.vertSensitivity*this.deltaFactor,this.cameraPivot.rotate(BABYLON.Axis.X,-(this.cameraPitchRate*BABYLON.System.Deg2Rad),BABYLON.Space.LOCAL),BABYLON.Utilities.ToEulerToRef(this.cameraPivot.rotationQuaternion,this.cameraEulerAngles),this.cameraEulerAngles.x=BABYLON.Scalar.Clamp(this.cameraEulerAngles.x,this.minimumPitchAngle,this.maximumPitchAngle),BABYLON.Utilities.FromEulerToRef(this.cameraEulerAngles.x,this.cameraEulerAngles.y,this.cameraEulerAngles.z,this.cameraPivot.rotationQuaternion),this.isCharacterGrounded===!0&&(this.playerMovement.x=this.playerDeltaX,this.playerMovement.y=0,this.playerMovement.z=this.playerDeltaZ,this.isCharacterJumpFrame=BABYLON.SceneManager.GetKeyboardInput(this.keyboardJump)||BABYLON.SceneManager.GetGamepadButtonInput(this.buttonJump),BABYLON.Utilities.TransformDirectionToRef(this.transform,this.playerMovement,this.playerMovement),BABYLON.Vector3.NormalizeToRef(this.playerMovement,this.playerMovement),this.playerMovement.scaleInPlace(BABYLON.System.WalkingVelocity*this.movementSpeed*n),this.characterController.move(this.playerMovement),this.isCharacterJumpFrame===!0&&this.characterController.jump(this.jumpingVelocity)))},t.prototype.destroyFirstPersonController=function(){this.cameraPivot=null;this.cameraRigger=null;this.characterController=null},t}(BABYLON.ScriptComponent);n.FirstPersonController=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.deltaFactor=2,u.attachCamera=!0,u.cameraPivot=null,u.cameraRigger=null,u.movementSpeed=1,u.jumpingVelocity=10,u.playerMovement=BABYLON.Vector3.Zero(),u.playerTurnRate=0,u.cameraPitchRate=0,u.horzSensitivity=1,u.vertSensitivity=1,u.mouseSensitivity=1,u.minimumPitchAngle=-60,u.maximumPitchAngle=60,u.isCharacterGrounded=!1,u.isCharacterJumpFrame=!1,u.characterController=null,u.buttonJump=BABYLON.Xbox360Button.A,u.keyboardJump=BABYLON.UserInputKey.SpaceBar,u.playerNumber=BABYLON.PlayerNumber.One,u.playerDeltaX=0,u.playerDeltaZ=0,u.playerMouseX=0,u.playerMouseY=0,u.attachCamera=u.getEditorProperty("attachCamera",u.attachCamera),u.playerNumber=u.getEditorProperty("playerNumber",u.playerNumber),u.movementSpeed=u.getEditorProperty("movementSpeed",u.movementSpeed),u.mouseSensitivity=u.getEditorProperty("mouseSensitivity",u.mouseSensitivity),u.minimumPitchAngle=u.getEditorProperty("minimumPitchAngle",u.minimumPitchAngle),u.maximumPitchAngle=u.getEditorProperty("maximumPitchAngle",u.maximumPitchAngle),u.vertSensitivity=u.getEditorProperty("verticalSensitivity",u.vertSensitivity),u.horzSensitivity=u.getEditorProperty("horizontalSensitivity",u.horzSensitivity),u.jumpingVelocity=u.getEditorProperty("impulseJumpVelocity",u.jumpingVelocity),u.playerNumber==BABYLON.PlayerNumber.One&&(BABYLON.UserInputOptions.PointerAngularSensibility=BABYLON.UserInputOptions.PointerAngularSensibility*u.mouseSensitivity),u}return __extends(t,n),t.prototype.getCharacterController=function(){return this.characterController},t.prototype.start=function(){this.setupThirdPersonController()},t.prototype.update=function(){this.updateThirdPersonController()},t.prototype.destroy=function(){this.destroyThirdPersonController()},t.prototype.setupThirdPersonController=function(){this.cameraPivot=this.getChildTransform("Pivot");this.cameraPivot==null&&(this.cameraPivot=new BABYLON.TransformNode("Pivot",this.scene),this.cameraPivot.setParent(this.transform),this.cameraPivot.position=new BABYLON.Vector3(0,1.85,0));BABYLON.Utilities.ValidateTransformQuaternion(this.cameraPivot);this.attachCamera===!0&&(this.cameraRigger=BABYLON.SceneManager.GetTransformNode(this.scene,"Main Camera"),this.cameraRigger!=null&&this.cameraPivot!=null?(this.cameraRigger.setParent(this.cameraPivot),this.cameraRigger.position=new BABYLON.Vector3(0,0,-4.5),this.cameraRigger.rotationQuaternion=BABYLON.Quaternion.Identity(),console.log("TPC: Attached main camera to player controller: "+this.transform.name)):BABYLON.Tools.Warn("Failed to locate camera or local pivot for: "+this.transform.name));this.characterController=this.getComponent("BABYLON.CharacterController");this.characterController==null&&BABYLON.Tools.Warn("Failed to locate character controller for: "+this.transform.name)},t.prototype.updateThirdPersonController=function(){this.playerDeltaX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Horizontal,this.playerNumber);this.playerDeltaZ=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Vertical,this.playerNumber);this.playerMouseX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseX,this.playerNumber);this.playerMouseY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseY,this.playerNumber);Math.abs(this.playerDeltaX)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerDeltaX=0);Math.abs(this.playerDeltaZ)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerDeltaZ=0);Math.abs(this.playerMouseX)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerMouseX=0);Math.abs(this.playerMouseY)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerMouseY=0);this.characterController!=null},t.prototype.destroyThirdPersonController=function(){this.cameraPivot=null;this.cameraRigger=null;this.characterController=null},t}(BABYLON.ScriptComponent);n.ThirdPersonController=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){var u,f;return r===void 0&&(r={}),u=n.call(this,t,i,r)||this,u.target=null,u.distance=10,u.height=1.5,u.heightOffset=0,u.heightDamping=2,u.rotationDamping=2,u.startBehindTarget=!0,u.followBehindTarget=!0,u.targetAngles=new BABYLON.Vector3(0,0,0),u.transformAngles=new BABYLON.Vector3(0,0,0),u.positionBuffer=new BABYLON.Vector3(0,0,0),u.rotationBuffer=new BABYLON.Quaternion(0,0,0,1),u.tempRotationBuffer=new BABYLON.Vector3(0,0,0),u.distance=u.getEditorProperty("distance",u.distance),u.height=u.getEditorProperty("height",u.height),u.heightOffset=u.getEditorProperty("heightOffset",u.heightOffset),u.heightDamping=u.getEditorProperty("heightDamping",u.heightDamping),u.rotationDamping=u.getEditorProperty("rotationDamping",u.rotationDamping),u.startBehindTarget=u.getEditorProperty("startBehindTarget",u.startBehindTarget),u.followBehindTarget=u.getEditorProperty("followBehindTarget",u.followBehindTarget),u.distance<=0&&(u.distance=10),u.height<=0&&(u.distance=1.5),u.heightDamping<=0&&(u.heightDamping=4),u.rotationDamping<=0&&(u.rotationDamping=2),f=u.getEditorProperty("target"),f!=null&&(u.target=BABYLON.Utilities.ParseTransform(u.scene,f)),u}return __extends(t,n),t.prototype.start=function(){this.target!=null&&this.startBehindTarget===!0},t.prototype.update=function(){var n;if(this.target!=null){if(this.followBehindTarget===!0){n=this.getDeltaSeconds();BABYLON.Utilities.ToEulerToRef(this.target.rotationQuaternion,this.targetAngles);BABYLON.Utilities.ToEulerToRef(this.transform.rotationQuaternion,this.transformAngles);var r=this.targetAngles.y,u=this.target.position.y+this.height,t=this.transformAngles.y,i=this.transform.position.y;t=BABYLON.Scalar.LerpAngle(t,r,this.rotationDamping*n);i=BABYLON.Scalar.Lerp(i,u,this.heightDamping*n);BABYLON.Utilities.FromEulerToRef(0,t,0,this.rotationBuffer);BABYLON.Utilities.MultiplyQuaternionByVectorToRef(this.rotationBuffer,BABYLON.Vector3.Forward(),this.tempRotationBuffer);this.tempRotationBuffer.scaleInPlace(this.distance);this.positionBuffer.copyFrom(this.target.position);this.positionBuffer.subtractInPlace(this.tempRotationBuffer);this.transform.position.set(this.positionBuffer.x,i+this.heightOffset,this.positionBuffer.z)}this.transform.lookAt(this.target.position)}},t.prototype.destroy=function(){this.target=null;this.targetAngles=null;this.transformAngles=null;this.positionBuffer=null;this.rotationBuffer=null;this.tempRotationBuffer=null},t}(BABYLON.ScriptComponent);n.SmoothFollowTarget=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){var u,f;return r===void 0&&(r={}),u=n.call(this,t,i,r)||this,u._waypointMeshLines=null,u._waypointSplineCurve=null,u._waypointTransformNodes=null,u._waypointSplinePositions=null,u._waypointSphereMaterial=null,u.resolution=1,u.closedLoop=!0,u.drawLines=!1,u.drawPoints=!1,u.drawTraces=!1,u.pointSize=.5,u.lineHeight=.25,u.lineColor=new BABYLON.Color3(1,1,1),u.pointColor=new BABYLON.Color3(1,1,1),u.traceColor=new BABYLON.Color3(1,1,1),u.resolution=u.getEditorProperty("resolution",u.resolution),u.closedLoop=u.getEditorProperty("closedLoop",u.closedLoop),u.drawLines=u.getEditorProperty("drawLines",u.drawLines),u.drawPoints=u.getEditorProperty("drawPoints",u.drawPoints),u.drawTraces=u.getEditorProperty("drawTraces",u.drawTraces),u.pointSize=u.getEditorProperty("pointSize",u.pointSize),u.lineHeight=u.getEditorProperty("lineHeight",u.lineHeight),u.lineColor=BABYLON.Utilities.ParseColor3(u.getEditorProperty("lineColor",u.lineColor)),u.pointColor=BABYLON.Utilities.ParseColor3(u.getEditorProperty("pointColor",u.pointColor)),u.traceColor=BABYLON.Utilities.ParseColor3(u.getEditorProperty("traceColor",u.traceColor)),u._waypointSphereMaterial=new BABYLON.StandardMaterial(u.transform.name+".SplineMaterial",u.scene),u._waypointSphereMaterial.diffuseColor=u.pointColor,u._waypointTransformNodes=u.transform.getChildren(null,!0),u._waypointTransformNodes!=null&&u._waypointTransformNodes.length>0&&(f=[],u._waypointTransformNodes.forEach(function(n){if(BABYLON.Utilities.ValidateTransformQuaternion(n),f.push(n.getAbsolutePosition().clone()),u.drawPoints===!0){var t=BABYLON.MeshBuilder.CreateSphere(n.name+".WireSphere",{segments:24,diameter:u.pointSize*2},u.scene);t.parent=n;t.position.set(0,0,0);t.visibility=.25;t.isVisible=!0;t.material=u._waypointSphereMaterial}}),u._waypointSplineCurve=BABYLON.Curve3.CreateCatmullRomSpline(f,u.resolution,u.closedLoop),u._waypointSplineCurve!=null&&(u._waypointSplinePositions=u._waypointSplineCurve.getPoints()),u._waypointSplinePositions!=null&&console.warn("DEBUG: Waypoint Manager - "+u.transform.name+": ("+u._waypointTransformNodes.length+" - "+u._waypointSplinePositions.length+" - "+u._waypointSplineCurve.length().toFixed(2)+")")),u}return __extends(t,n),t.prototype.getSplineCurve=function(){return this._waypointSplineCurve},t.prototype.getSplineCurveLength=function(){return this._waypointSplineCurve!=null?this._waypointSplineCurve.length():0},t.prototype.getSplineCurvePositions=function(){return this._waypointSplinePositions},t.prototype.getControlPointTransforms=function(){return this._waypointTransformNodes},t.prototype.start=function(){this._waypointSplinePositions!=null&&this.drawLines===!0&&(this._waypointMeshLines=BABYLON.MeshBuilder.CreateLines(this.transform.name+".SplineMesh",{points:this._waypointSplinePositions},this.scene),this._waypointMeshLines.parent=this.transform,this._waypointMeshLines.color=this.lineColor,this._waypointMeshLines.position.y+=this.lineHeight)},t.prototype.destroy=function(){this.lineColor=null;this._waypointSplineCurve=null;this._waypointTransformNodes=null;this._waypointSplinePositions=null;this._waypointMeshLines!=null&&(this._waypointMeshLines.dispose(),this._waypointMeshLines=null)},t}(BABYLON.ScriptComponent);n.WaypointManager=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.baseColor=BABYLON.Color3.White(),u.baseMaterial=null,u.baseColor=BABYLON.Utilities.ParseColor3(u.getEditorProperty("baseColor",u.baseColor)),u}return __extends(t,n),t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.PaintshopManager=t}(PROJECT||(PROJECT={})),function(n){var t=function(){function n(){this.Pos=BABYLON.Vector3.Zero();this.Normal=BABYLON.Vector3.Zero();this.Tangent=BABYLON.Vector4.Zero();this.Posl=BABYLON.Vector3.Zero();this.Posr=BABYLON.Vector3.Zero();this.Intensity=0;this.LastIndex=-1}return n}(),i;n.SkidmarkSection=t;i=function(n){function i(t,r,u){u===void 0&&(u={});var f=n.call(this,t,r,u)||this;return i.MAX_MARKS=f.getEditorProperty("maxSections",i.MAX_MARKS),i.MARK_COLOR=BABYLON.Utilities.ParseColor3(f.getEditorProperty("textureColor",i.MARK_COLOR)),i.MARK_WIDTH=f.getEditorProperty("textureWidth",i.MARK_WIDTH),i.GROUND_OFFSET=f.getEditorProperty("groundOffset",i.GROUND_OFFSET),i.GPU_TRIANGLES=f.getEditorProperty("gpuQuadIndices",i.GPU_TRIANGLES),i.TEXTURE_MARKS=f.getEditorProperty("textureMarks",i.TEXTURE_MARKS),i.TEX_INTENSITY=f.getEditorProperty("textureIntensity",i.TEX_INTENSITY),i.MIN_DISTANCE=f.getEditorProperty("textureDistance",i.MIN_DISTANCE),i.MIN_SQR_DISTANCE=i.MIN_DISTANCE*i.MIN_DISTANCE,f}return __extends(i,n),i.prototype.start=function(){i.CreateSkidmarkManager(this.scene)},i.prototype.update=function(){i.UpdateSkidmarkManager()},i.AddSkidmarkSegment=function(n,t,r,u){var o,f,e,s;if(i.SkidmarkMesh==null)return null;if(i.TempVector3_POS.set(0,0,0),i.TempVector3_DIR.set(0,0,0),i.TempVector3_XDIR.set(0,0,0),i.TempVector3_SDIR.set(0,0,0),r>1)r=1;else if(r<0)return-1;return u>0&&(n.subtractToRef(i.SkidmarkSections[u].Pos,i.TempVector3_POS),o=i.TempVector3_POS.lengthSquared(),o<i.MIN_SQR_DISTANCE)?u:(f=i.SkidmarkSections[i.SkidmarkIndex],t.scaleToRef(i.GROUND_OFFSET,i.TempVector3_POS),n.addToRef(i.TempVector3_POS,f.Pos),f.Normal.copyFrom(t),f.Intensity=r*i.TEX_INTENSITY,f.LastIndex=u,u!=-1&&(e=i.SkidmarkSections[u],f.Pos.subtractToRef(e.Pos,i.TempVector3_DIR),BABYLON.Vector3.CrossToRef(i.TempVector3_DIR,t,i.TempVector3_XDIR),i.TempVector3_XDIR.normalizeToRef(i.TempVector3_XDIR),i.TempVector3_XDIR.scaleToRef(i.MARK_WIDTH*.5,i.TempVector3_SDIR),f.Pos.addToRef(i.TempVector3_SDIR,f.Posl),f.Pos.subtractToRef(i.TempVector3_SDIR,f.Posr),f.Tangent.set(i.TempVector3_XDIR.x,i.TempVector3_XDIR.y,i.TempVector3_XDIR.z,1),e.LastIndex===-1&&(f.Pos.addToRef(i.TempVector3_SDIR,e.Posl),f.Pos.subtractToRef(i.TempVector3_SDIR,e.Posr),e.Tangent.copyFrom(f.Tangent))),i.AddSkidmarkVertexData(),s=i.SkidmarkIndex,i.SkidmarkIndex=++i.SkidmarkIndex%i.MAX_MARKS,s)},i.CreateSkidmarkManager=function(n){var r,f,u;if(i.SkidmarkMesh==null){for(r=new BABYLON.StandardMaterial("SkidmarkMaterial",n),r.backFaceCulling=!1,r.disableLighting=!0,r.emissiveColor=i.MARK_COLOR,r.diffuseColor=i.MARK_COLOR,r.diffuseTexture=BABYLON.Utilities.ParseTexture(i.TEXTURE_MARKS,n),r.diffuseTexture!=null&&(r.diffuseTexture.hasAlpha=!0,r.useAlphaFromDiffuseTexture=!0),r.freeze(),i.SkidmarkMesh=new BABYLON.Mesh("SkidmarkMesh",n),i.SkidmarkMesh.material=r,i.SkidmarkMesh.alwaysSelectAsActiveMesh=!0,i.SkidmarkMesh.doNotSyncBoundingInfo=!0,i.SkidmarkMesh.receiveShadows=!1,i.SkidmarkMesh.checkCollisions=!1,i.SkidmarkMesh.useVertexColors=!0,i.SkidmarkMesh.hasVertexAlpha=!0,i.SkidmarkMesh.isPickable=!1,i.SkidmarkSections=new Array(i.MAX_MARKS),f=0;f<i.SkidmarkSections.length;f++)i.SkidmarkSections[f]=new t;i.SkidBufferPositions=new Float32Array(i.MAX_MARKS*12);i.SkidBufferNormals=new Float32Array(i.MAX_MARKS*12);i.SkidBufferTangents=new Float32Array(i.MAX_MARKS*16);i.SkidBufferColors=new Float32Array(i.MAX_MARKS*16);i.SkidBufferUvs=new Float32Array(i.MAX_MARKS*8);i.SkidBufferIndices=new Int32Array(i.MAX_MARKS*6);u=new BABYLON.VertexData;u.positions=i.SkidBufferPositions;u.normals=i.SkidBufferNormals;u.tangents=i.SkidBufferTangents;u.colors=i.SkidBufferColors;u.uvs=i.SkidBufferUvs;u.indices=i.SkidBufferIndices;u.applyToMesh(i.SkidmarkMesh,!0);i.SkidmarkMesh.freezeWorldMatrix()}},i.AddSkidmarkVertexData=function(){var t=i.SkidmarkSections[i.SkidmarkIndex],r,n;t.LastIndex!==-1&&(r=i.SkidmarkSections[t.LastIndex],i.SkidmarkUpdated=!0,n=i.SkidmarkIndex*4+0,i.SkidBufferPositions[n*3]=r.Posl.x,i.SkidBufferPositions[n*3+1]=r.Posl.y,i.SkidBufferPositions[n*3+2]=r.Posl.z,n=i.SkidmarkIndex*4+1,i.SkidBufferPositions[n*3]=r.Posr.x,i.SkidBufferPositions[n*3+1]=r.Posr.y,i.SkidBufferPositions[n*3+2]=r.Posr.z,n=i.SkidmarkIndex*4+2,i.SkidBufferPositions[n*3]=t.Posl.x,i.SkidBufferPositions[n*3+1]=t.Posl.y,i.SkidBufferPositions[n*3+2]=t.Posl.z,n=i.SkidmarkIndex*4+3,i.SkidBufferPositions[n*3]=t.Posr.x,i.SkidBufferPositions[n*3+1]=t.Posr.y,i.SkidBufferPositions[n*3+2]=t.Posr.z,n=i.SkidmarkIndex*4+0,i.SkidBufferNormals[n*3]=r.Normal.x,i.SkidBufferNormals[n*3+1]=r.Normal.y,i.SkidBufferNormals[n*3+2]=r.Normal.z,n=i.SkidmarkIndex*4+1,i.SkidBufferNormals[n*3]=r.Normal.x,i.SkidBufferNormals[n*3+1]=r.Normal.y,i.SkidBufferNormals[n*3+2]=r.Normal.z,n=i.SkidmarkIndex*4+2,i.SkidBufferNormals[n*3]=t.Normal.x,i.SkidBufferNormals[n*3+1]=t.Normal.y,i.SkidBufferNormals[n*3+2]=t.Normal.z,n=i.SkidmarkIndex*4+3,i.SkidBufferNormals[n*3]=t.Normal.x,i.SkidBufferNormals[n*3+1]=t.Normal.y,i.SkidBufferNormals[n*3+2]=t.Normal.z,n=i.SkidmarkIndex*4+0,i.SkidBufferTangents[n*4]=r.Tangent.x,i.SkidBufferTangents[n*4+1]=r.Tangent.y,i.SkidBufferTangents[n*4+2]=r.Tangent.z,i.SkidBufferTangents[n*4+3]=r.Tangent.w,n=i.SkidmarkIndex*4+1,i.SkidBufferTangents[n*4]=r.Tangent.x,i.SkidBufferTangents[n*4+1]=r.Tangent.y,i.SkidBufferTangents[n*4+2]=r.Tangent.z,i.SkidBufferTangents[n*4+3]=r.Tangent.w,n=i.SkidmarkIndex*4+2,i.SkidBufferTangents[n*4]=t.Tangent.x,i.SkidBufferTangents[n*4+1]=t.Tangent.y,i.SkidBufferTangents[n*4+2]=t.Tangent.z,i.SkidBufferTangents[n*4+3]=t.Tangent.w,n=i.SkidmarkIndex*4+3,i.SkidBufferTangents[n*4]=t.Tangent.x,i.SkidBufferTangents[n*4+1]=t.Tangent.y,i.SkidBufferTangents[n*4+2]=t.Tangent.z,i.SkidBufferTangents[n*4+3]=t.Tangent.w,n=i.SkidmarkIndex*4+0,i.SkidBufferColors[n*4]=1,i.SkidBufferColors[n*4+1]=1,i.SkidBufferColors[n*4+2]=1,i.SkidBufferColors[n*4+3]=r.Intensity,n=i.SkidmarkIndex*4+1,i.SkidBufferColors[n*4]=1,i.SkidBufferColors[n*4+1]=1,i.SkidBufferColors[n*4+2]=1,i.SkidBufferColors[n*4+3]=r.Intensity,n=i.SkidmarkIndex*4+2,i.SkidBufferColors[n*4]=1,i.SkidBufferColors[n*4+1]=1,i.SkidBufferColors[n*4+2]=1,i.SkidBufferColors[n*4+3]=t.Intensity,n=i.SkidmarkIndex*4+3,i.SkidBufferColors[n*4]=1,i.SkidBufferColors[n*4+1]=1,i.SkidBufferColors[n*4+2]=1,i.SkidBufferColors[n*4+3]=t.Intensity,n=i.SkidmarkIndex*4+0,i.SkidBufferUvs[n*2]=0,i.SkidBufferUvs[n*2+1]=0,n=i.SkidmarkIndex*4+1,i.SkidBufferUvs[n*2]=1,i.SkidBufferUvs[n*2+1]=0,n=i.SkidmarkIndex*4+2,i.SkidBufferUvs[n*2]=0,i.SkidBufferUvs[n*2+1]=1,n=i.SkidmarkIndex*4+3,i.SkidBufferUvs[n*2]=1,i.SkidBufferUvs[n*2+1]=1,i.SkidBufferIndices[i.SkidmarkIndex*6+0]=i.SkidmarkIndex*4+0,i.SkidBufferIndices[i.SkidmarkIndex*6+2]=i.SkidmarkIndex*4+1,i.SkidBufferIndices[i.SkidmarkIndex*6+1]=i.SkidmarkIndex*4+2,i.SkidBufferIndices[i.SkidmarkIndex*6+3]=i.SkidmarkIndex*4+2,i.SkidBufferIndices[i.SkidmarkIndex*6+5]=i.SkidmarkIndex*4+1,i.SkidBufferIndices[i.SkidmarkIndex*6+4]=i.SkidmarkIndex*4+3)},i.UpdateSkidmarkManager=function(){i.SkidmarkMesh!=null&&i.SkidmarkUpdated===!0&&(i.SkidmarkUpdated=!1,i.SkidmarkMesh.geometry!=null&&(i.SkidmarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.PositionKind,i.SkidBufferPositions,0,!1),i.SkidmarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.NormalKind,i.SkidBufferNormals,0,!1),i.SkidmarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.TangentKind,i.SkidBufferTangents,0,!1),i.SkidmarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.ColorKind,i.SkidBufferColors,0,!1),i.SkidmarkMesh.geometry.updateVerticesDataDirectly(BABYLON.VertexBuffer.UVKind,i.SkidBufferUvs,0,!1),i.SkidmarkMesh.geometry.updateIndices(i.SkidBufferIndices,0,i.GPU_TRIANGLES)))},i.MAX_MARKS=4096,i.GROUND_OFFSET=.01,i.GPU_TRIANGLES=!0,i.MARK_COLOR=BABYLON.Color3.Black(),i.MARK_WIDTH=.3,i.TEX_INTENSITY=1,i.MIN_DISTANCE=.1,i.MIN_SQR_DISTANCE=i.MIN_DISTANCE*i.MIN_DISTANCE,i.TEXTURE_MARKS=null,i.SkidBufferPositions=null,i.SkidBufferNormals=null,i.SkidBufferTangents=null,i.SkidBufferColors=null,i.SkidBufferUvs=null,i.SkidBufferIndices=null,i.SkidmarkSections=null,i.SkidmarkIndex=0,i.SkidmarkMesh=null,i.SkidmarkUpdated=!1,i.TempVector3_POS=new BABYLON.Vector3(0,0,0),i.TempVector3_DIR=new BABYLON.Vector3(0,0,0),i.TempVector3_XDIR=new BABYLON.Vector3(0,0,0),i.TempVector3_SDIR=new BABYLON.Vector3(0,0,0),i}(BABYLON.ScriptComponent);n.SkidmarkManager=i}(PROJECT||(PROJECT={})),function(n){var t=function(t){function i(n,i,r){var u,e,o,f;return r===void 0&&(r={}),u=t.call(this,n,i,r)||this,u._rigidbody=null,u._engineAudioSource=null,u._skidAudioSource=null,u.gearIndex=0,u.downShift=1e3,u.shiftingTime=0,u.engineForce=0,u.linearDamping=0,u.angularDamping=0,u.forwardSpeed=0,u.absoluteSpeed=0,u.americanSpeed=0,u.normalizedSpeed=0,u.frontWheelPower=0,u.backWheelPower=0,u.wheelBrakingForce=0,u.visualSteerAngle=0,u.physicsSteerAngle=0,u.vehicleResetCheck=0,u.raycastVehicle=null,u.frontLeftWheelTrans=null,u.frontRightWheelTrans=null,u.backLeftWheelTrans=null,u.backRightWheelTrans=null,u.frontLeftWheelMesh=null,u.frontRightWheelMesh=null,u.backLeftWheelMesh=null,u.backRightWheelMesh=null,u.frontLeftWheelEmitter=null,u.frontRightWheelEmitter=null,u.backLeftWheelEmitter=null,u.backRightWheelEmitter=null,u.frontLeftWheelParticle=null,u.frontRightWheelParticle=null,u.backLeftWheelParticle=null,u.backRightWheelParticle=null,u.frontLeftWheelCollider=null,u.frontRightWheelCollider=null,u.backLeftWheelCollider=null,u.backRightWheelCollider=null,u.engineTorqueCurve=null,u.wheelRadius=0,u.clutchSlip=0,u.engineRPM=0,u.pitchRPM=0,u.shiftRPM=0,u.FRONT_LEFT=-1,u.FRONT_RIGHT=-1,u.BACK_LEFT=-1,u.BACK_RIGHT=-1,u.onUpdateVehicleInformation=null,u.smokeTexture=null,u.shadowTexture=null,u.smokeIntensity=150,u.smokeOpacity=.1,u.smokeDonuts=2,u.velocityScaling=.02,u.skidThreashold=.65,u.maxTurnAngle=20,u.maxBurnAngle=40,u.overSteerDelay=.1,u.steeringBoost=3,u.topEngineSpeed=125,u.powerCoefficient=1,u.lowSpeedAngle=10,u.highSpeedAngle=1,u.lowSpeedTurning=.015,u.highSpeedTurning=.005,u.stableDownForce=1,u.transmissionRatio=.75,u.differentialRatio=3.55,u.maxFrontBraking=.2,u.maxReversePower=.5,u.minBrakingForce=50,u.maxBrakingForce=250,u.handBrakingForce=2500,u.linearBrakingForce=.3,u.angularBrakingForce=0,u.skidWhenFootBraking=!1,u.footBrakingThreashold=.9,u.footSkidBrakingFactor=1.5,u.footSkidBrakingSpeed=30,u.wheelLockFriction=1,u.wheelBurnFriction=1,u.defaultLerpSpeed=.65,u.driftingLerpSpeed=.25,u.burnoutLerpSpeed=.1,u.burnoutTimeDelay=1.5,u.burnoutWheelPitch=.85,u.burnoutCoefficient=0,u.burnoutTriggerMark=10,u.resetVehicleTime=3,u.playVehicleSounds=!0,u.throttleEngineSpeed=0,u.wheelDriveType=0,u.gearBoxMaxPitching=6500,u.gearBoxShiftChange=4500,u.gearBoxShiftDelay=.35,u.gearBoxShiftRatios=[4.17,2.34,1.52,1.14,.89,.68],u.gearBoxShiftRanges=[1e3,2400,2800,3200,3200,3200],u.m_frontLeftWheel=null,u.m_frontRightWheel=null,u.m_backLeftWheel=null,u.m_backRightWheel=null,u.m_physicsWorld=null,u.m_frontLeftWheelSkid=-1,u.m_frontRightWheelSkid=-1,u.m_backLeftWheelSkid=-1,u.m_backRightWheelSkid=-1,u.m_velocityOffset=new BABYLON.Vector3(0,0,0),u.burnoutTimer=0,u.restoreTimer=0,u.cooldownTimer=0,u.driftingTimer=0,u.wheelDonuts=!1,u.wheelBurnout=!1,u.wheelSkidding=!1,u.donutSpinTime=0,u.currentForward=0,u.currentTurning=0,u.currentSkidding=!1,u.currentDrifting=!1,u.allowedTurningAngle=0,u.allowedTurningIncement=0,u.engineForce=0,u.frontWheelPower=0,u.backWheelPower=0,u.wheelBrakingForce=0,u.visualSteerAngle=0,u.physicsSteerAngle=0,u.vehicleResetCheck=0,u.m_physicsWorld=BABYLON.SceneManager.GetPhysicsWorld(u.scene),u.smokeIntensity=u.getEditorProperty("smokeIntensity",u.smokeIntensity),u.smokeOpacity=u.getEditorProperty("smokeOpacity",u.smokeOpacity),u.smokeDonuts=u.getEditorProperty("smokeDonuts",u.smokeDonuts),u.velocityScaling=u.getEditorProperty("velocityScaling",u.velocityScaling),u.skidThreashold=u.getEditorProperty("skidThreashold",u.skidThreashold),u.topEngineSpeed=u.getEditorProperty("topEngineSpeed",u.topEngineSpeed),u.powerCoefficient=u.getEditorProperty("powerCoefficient",u.powerCoefficient),u.maxFrontBraking=u.getEditorProperty("maxFrontBraking",u.maxFrontBraking),u.maxReversePower=u.getEditorProperty("maxReversePower",u.maxReversePower),u.stableDownForce=u.getEditorProperty("stableDownForce",u.stableDownForce),u.maxTurnAngle=u.getEditorProperty("maxTurnAngle",u.maxTurnAngle),u.maxBurnAngle=u.getEditorProperty("maxBurnAngle",u.maxBurnAngle),u.steeringBoost=u.getEditorProperty("steeringBoost",u.steeringBoost),u.overSteerDelay=u.getEditorProperty("overSteerDelay",u.overSteerDelay),u.lowSpeedAngle=u.getEditorProperty("lowSpeedAngle",u.lowSpeedAngle),u.highSpeedAngle=u.getEditorProperty("highSpeedAngle",u.highSpeedAngle),u.wheelDriveType=u.getEditorProperty("wheelDriveType",u.wheelDriveType),u.minBrakingForce=u.getEditorProperty("minBrakingForce",u.minBrakingForce),u.maxBrakingForce=u.getEditorProperty("maxBrakingForce",u.maxBrakingForce),u.handBrakingForce=u.getEditorProperty("handBrakingForce",u.handBrakingForce),u.linearBrakingForce=u.getEditorProperty("linearBrakingForce",u.linearBrakingForce),u.angularBrakingForce=u.getEditorProperty("angularBrakingForce",u.angularBrakingForce),u.footBrakingThreashold=u.getEditorProperty("footBrakingThreashold",u.footBrakingThreashold),u.skidWhenFootBraking=u.getEditorProperty("skidWhenFootBraking",u.skidWhenFootBraking),u.footSkidBrakingFactor=u.getEditorProperty("footSkidBrakingFactor",u.footSkidBrakingFactor),u.footSkidBrakingSpeed=u.getEditorProperty("footSkidBrakingSpeed",u.footSkidBrakingSpeed),u.wheelBurnFriction=u.getEditorProperty("wheelBurnFriction",u.wheelBurnFriction),u.wheelLockFriction=u.getEditorProperty("wheelLockFriction",u.wheelLockFriction),u.lowSpeedTurning=u.getEditorProperty("lowSpeedTurning",u.lowSpeedTurning),u.highSpeedTurning=u.getEditorProperty("highSpeedTurning",u.highSpeedTurning),u.frontLeftWheelTrans=u.getEditorProperty("frontLeftWheelMesh",u.frontLeftWheelTrans),u.frontRightWheelTrans=u.getEditorProperty("frontRightWheelMesh",u.frontRightWheelTrans),u.backLeftWheelTrans=u.getEditorProperty("rearLeftWheelMesh",u.backLeftWheelTrans),u.backRightWheelTrans=u.getEditorProperty("rearRightWheelMesh",u.backRightWheelTrans),u.frontLeftWheelCollider=u.getEditorProperty("frontLeftWheelCollider",u.frontLeftWheelCollider),u.frontRightWheelCollider=u.getEditorProperty("frontRightWheelCollider",u.frontRightWheelCollider),u.backLeftWheelCollider=u.getEditorProperty("rearLeftWheelCollider",u.backLeftWheelCollider),u.backRightWheelCollider=u.getEditorProperty("rearRightWheelCollider",u.backRightWheelCollider),u.defaultLerpSpeed=u.getEditorProperty("defaultLerpSpeed",u.defaultLerpSpeed),u.driftingLerpSpeed=u.getEditorProperty("driftingLerpSpeed",u.driftingLerpSpeed),u.burnoutLerpSpeed=u.getEditorProperty("burnoutLerpSpeed",u.burnoutLerpSpeed),u.burnoutTimeDelay=u.getEditorProperty("burnoutTimeDelay",u.burnoutTimeDelay),u.burnoutWheelPitch=u.getEditorProperty("burnoutWheelPitch",u.burnoutWheelPitch),u.burnoutCoefficient=u.getEditorProperty("burnoutCoefficient",u.burnoutCoefficient),u.burnoutTriggerMark=u.getEditorProperty("burnoutTriggerMark",u.burnoutTriggerMark),u.resetVehicleTime=u.getEditorProperty("resetVehicleTime",u.resetVehicleTime),u.playVehicleSounds=u.getEditorProperty("playVehicleSounds",u.playVehicleSounds),u.differentialRatio=u.getEditorProperty("gearBoxDifferential",u.differentialRatio),u.transmissionRatio=u.getEditorProperty("gearBoxOverdrive",u.transmissionRatio),u.gearBoxMaxPitching=u.getEditorProperty("gearBoxMaxPitching",u.gearBoxMaxPitching),u.gearBoxShiftChange=u.getEditorProperty("gearBoxShiftChange",u.gearBoxShiftChange),u.gearBoxShiftDelay=u.getEditorProperty("gearBoxShiftDelay",u.gearBoxShiftDelay),u.gearBoxShiftRatios=u.getEditorProperty("gearBoxShiftRatios",u.gearBoxShiftRatios),u.gearBoxShiftRanges=u.getEditorProperty("gearBoxShiftRanges",u.gearBoxShiftRanges),u.maxTurnAngle<=0&&(u.maxTurnAngle=20),u.maxBurnAngle<=0&&(u.maxBurnAngle=45),u.maxFrontBraking<=0&&(u.maxFrontBraking=.01),u.maxReversePower<=0&&(u.maxReversePower=.5),u.lowSpeedAngle<=0&&(u.lowSpeedAngle=10),u.highSpeedAngle<=0&&(u.highSpeedAngle=1),u.lowSpeedTurning<=0&&(u.lowSpeedTurning=.015),u.highSpeedTurning<=0&&(u.highSpeedTurning=.005),u.powerCoefficient<=0&&(u.powerCoefficient=1),u.topEngineSpeed<=0&&(u.topEngineSpeed=125),u.gearBoxMaxPitching<=0&&(u.gearBoxMaxPitching=6500),u.gearBoxShiftChange<=0&&(u.gearBoxShiftChange=4500),u.gearBoxShiftDelay<=0&&(u.gearBoxShiftDelay=.35),u.transmissionRatio<=0&&(u.transmissionRatio=1),u.differentialRatio<=0&&(u.differentialRatio=1),u.defaultLerpSpeed<=0&&(u.defaultLerpSpeed=1),u.driftingLerpSpeed<=0&&(u.driftingLerpSpeed=1),u.burnoutLerpSpeed<=0&&(u.burnoutLerpSpeed=1),u.burnoutTimeDelay<=0&&(u.burnoutTimeDelay=1),u.burnoutWheelPitch<=0&&(u.burnoutWheelPitch=1),e=u.getEditorProperty("smokeTexture"),e!=null&&(u.smokeTexture=BABYLON.Utilities.ParseTexture(e,u.scene)),o=u.getEditorProperty("shadowTexture"),o!=null&&(u.shadowTexture=BABYLON.Utilities.ParseTexture(o,u.scene)),f=u.getEditorProperty("engineTorque"),f!=null&&f.animation!=null&&(u.engineTorqueCurve=BABYLON.Animation.Parse(f.animation),f.animation=null),u.engineTorqueCurve==null&&BABYLON.Tools.Warn("Failed to parse engine torque curve for: "+u.transform.name),u}return __extends(i,t),i.prototype.getCurrentBraking=function(){return this.currentForward<0&&this.forwardSpeed>1},i.prototype.getCurrentForward=function(){return this.currentForward},i.prototype.getCurrentTurning=function(){return this.currentTurning},i.prototype.getCurrentSkidding=function(){return this.currentSkidding},i.prototype.getCurrentDrifting=function(){return this.currentDrifting},i.prototype.getRigidbodyPhysics=function(){return this._rigidbody},i.prototype.getRaycastVehicle=function(){return this.raycastVehicle},i.prototype.getForwardSpeed=function(){return this.absoluteSpeed},i.prototype.getAbsoluteSpeed=function(){return this.forwardSpeed},i.prototype.getAmericanSpeed=function(){return this.americanSpeed},i.prototype.getNormalizedSpeed=function(){return this.normalizedSpeed},i.prototype.getCurrentGearIndex=function(){return this.gearIndex},i.prototype.getCurrentEngineRPM=function(){return this.engineRPM},i.prototype.getCurrentEnginePitch=function(){return BABYLON.Scalar.Clamp(this.pitchRPM/this.gearBoxMaxPitching+.1)},i.prototype.getGearShiftRatioCount=function(){return this.gearBoxShiftRatios!=null?this.gearBoxShiftRatios.length:0},i.prototype.getSmokeTextureMask=function(){return this.smokeTexture},i.prototype.getShadowTextureMask=function(){return this.shadowTexture},i.prototype.getFrontLeftWheelNode=function(){return this.frontLeftWheelMesh},i.prototype.getFrontRightWheelNode=function(){return this.frontRightWheelMesh},i.prototype.getBackLeftWheelNode=function(){return this.backLeftWheelMesh},i.prototype.getBackRightWheelNode=function(){return this.backRightWheelMesh},i.prototype.getWheelBurnoutEnabled=function(){return this.wheelBurnout},i.prototype.getWheelDonutsEnabled=function(){return this.wheelDonuts},i.prototype.getCurrentDonutSpinTime=function(){return this.donutSpinTime},i.prototype.start=function(){this.initVehicleState()},i.prototype.update=function(){this.updateVehicleState()},i.prototype.destroy=function(){this.destroyVehicleState()},i.prototype.initVehicleState=function(){if(BABYLON.Utilities.ValidateTransformQuaternion(this.transform),this._engineAudioSource=this.getComponent("BABYLON.AudioSource"),this._engineAudioSource==null&&BABYLON.Tools.Warn("No engine audio source manager found for: "+this.transform.name),this._rigidbody=this.getComponent("BABYLON.RigidbodyPhysics"),this._rigidbody!=null)if(this._rigidbody.hasRaycastVehicle())if(this.raycastVehicle=this._rigidbody.getRaycastVehicle(),this.raycastVehicle!=null){this.linearDamping=this._rigidbody.getLinearDamping();this.angularDamping=this._rigidbody.getAngularDamping();var n=this.frontLeftWheelTrans!=null&&this.frontLeftWheelTrans.name!=null&&this.frontLeftWheelTrans.name!==""?this.frontLeftWheelTrans.name:null,t=this.frontRightWheelTrans!=null&&this.frontRightWheelTrans.name!=null&&this.frontRightWheelTrans.name!==""?this.frontRightWheelTrans.name:null,i=this.backLeftWheelTrans!=null&&this.backLeftWheelTrans.name!=null&&this.backLeftWheelTrans.name!==""?this.backLeftWheelTrans.name:null,r=this.backRightWheelTrans!=null&&this.backRightWheelTrans.name!=null&&this.backRightWheelTrans.name!==""?this.backRightWheelTrans.name:null,u=this.frontLeftWheelCollider!=null&&this.frontLeftWheelCollider.name!=null&&this.frontLeftWheelCollider.name!==""?this.frontLeftWheelCollider.name:null,f=this.frontRightWheelCollider!=null&&this.frontRightWheelCollider.name!=null&&this.frontRightWheelCollider.name!==""?this.frontRightWheelCollider.name:null,e=this.backLeftWheelCollider!=null&&this.backLeftWheelCollider.name!=null&&this.backLeftWheelCollider.name!==""?this.backLeftWheelCollider.name:null,o=this.backRightWheelCollider!=null&&this.backRightWheelCollider.name!=null&&this.backRightWheelCollider.name!==""?this.backRightWheelCollider.name:null;u!=null&&(this.FRONT_LEFT=this.raycastVehicle.getWheelIndexByName(u));f!=null&&(this.FRONT_RIGHT=this.raycastVehicle.getWheelIndexByName(f));e!=null&&(this.BACK_LEFT=this.raycastVehicle.getWheelIndexByName(e));o!=null&&(this.BACK_RIGHT=this.raycastVehicle.getWheelIndexByName(o));this.raycastVehicle.getNumWheels()>=4?(this.FRONT_LEFT>=0&&n!=null&&(this.m_frontLeftWheel=this.raycastVehicle.getWheelInfo(this.FRONT_LEFT),this.frontLeftWheelMesh=this.getChildTransform(n,BABYLON.SearchType.StartsWith,!1),this.frontLeftWheelMesh!=null&&(this.m_frontLeftWheel.spinner=BABYLON.SceneManager.FindSceneChildTransform(this.frontLeftWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.FRONT_LEFT,this.frontLeftWheelMesh),(this.wheelDriveType===1||this.wheelDriveType===2)&&(this.frontLeftWheelEmitter=new BABYLON.AbstractMesh("Emitter_FL"),this.frontLeftWheelEmitter.parent=this.m_frontLeftWheel.spinner||this.frontLeftWheelMesh,this.frontLeftWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.frontLeftWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_FL",this.frontLeftWheelEmitter),this.wheelRadius<=0&&this.m_frontLeftWheel!=null&&(this.wheelRadius=this.m_frontLeftWheel.get_m_wheelsRadius())))),this.FRONT_RIGHT>=0&&t!=null&&(this.m_frontRightWheel=this.raycastVehicle.getWheelInfo(this.FRONT_RIGHT),this.frontRightWheelMesh=this.getChildTransform(t,BABYLON.SearchType.StartsWith,!1),this.frontRightWheelMesh!=null&&(this.m_frontRightWheel.spinner=BABYLON.SceneManager.FindSceneChildTransform(this.frontRightWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.FRONT_RIGHT,this.frontRightWheelMesh),(this.wheelDriveType===1||this.wheelDriveType===2)&&(this.frontRightWheelEmitter=new BABYLON.AbstractMesh("Emitter_FR"),this.frontRightWheelEmitter.parent=this.m_frontRightWheel.spinner||this.frontRightWheelMesh,this.frontRightWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.frontRightWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_FR",this.frontRightWheelEmitter),this.wheelRadius<=0&&this.m_frontRightWheel!=null&&(this.wheelRadius=this.m_frontRightWheel.get_m_wheelsRadius())))),this.BACK_LEFT>=0&&i!=null&&(this.m_backLeftWheel=this.raycastVehicle.getWheelInfo(this.BACK_LEFT),this.backLeftWheelMesh=this.getChildTransform(i,BABYLON.SearchType.StartsWith,!1),this.backLeftWheelMesh!=null&&(this.m_backLeftWheel.spinner=BABYLON.SceneManager.FindSceneChildTransform(this.backLeftWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.BACK_LEFT,this.backLeftWheelMesh),this.backLeftWheelEmitter=new BABYLON.AbstractMesh("Emitter_RL"),this.backLeftWheelEmitter.parent=this.m_backLeftWheel.spinner||this.backLeftWheelMesh,this.backLeftWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.backLeftWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_RL",this.backLeftWheelEmitter),(this.wheelDriveType===0||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_backLeftWheel!=null&&(this.wheelRadius=this.m_backLeftWheel.get_m_wheelsRadius()))),this.BACK_RIGHT>=0&&r!=null&&(this.m_backRightWheel=this.raycastVehicle.getWheelInfo(this.BACK_RIGHT),this.backRightWheelMesh=this.getChildTransform(r,BABYLON.SearchType.StartsWith,!1),this.backRightWheelMesh!=null&&(this.m_backRightWheel.spinner=BABYLON.SceneManager.FindSceneChildTransform(this.backRightWheelMesh,"Wheel",BABYLON.SearchType.IndexOf,!0),this.raycastVehicle.setWheelTransformMesh(this.BACK_RIGHT,this.backRightWheelMesh),this.backRightWheelEmitter=new BABYLON.AbstractMesh("Emitter_RR"),this.backRightWheelEmitter.parent=this.m_backRightWheel.spinner||this.backRightWheelMesh,this.backRightWheelEmitter.position=new BABYLON.Vector3(0,0,0),this.backRightWheelParticle=this.createSmokeParticleSystem(this.transform.name+"Smoke_RR",this.backRightWheelEmitter),(this.wheelDriveType===0||this.wheelDriveType===2)&&this.wheelRadius<=0&&this.m_backRightWheel!=null&&(this.wheelRadius=this.m_backRightWheel.get_m_wheelsRadius()))),this._skidAudioSource==null&&this.backRightWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.backRightWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.backLeftWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.backLeftWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.frontRightWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.frontRightWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&this.frontLeftWheelMesh!=null&&(this._skidAudioSource=BABYLON.SceneManager.FindScriptComponent(this.frontLeftWheelMesh,"BABYLON.AudioSource")),this._skidAudioSource==null&&BABYLON.Tools.Warn("No skid audio source manager found for: "+this.transform.name)):BABYLON.Tools.Warn("Invalid vehicle controller wheel count info for: "+this.transform.name)}else BABYLON.Tools.Warn("Failed to create vehicle controller for: "+this.transform.name);else BABYLON.Tools.Warn("No wheel collider information found for: "+this.transform.name);else BABYLON.Tools.Warn("Failed to get rigidbody component: "+this.transform.name)},i.prototype.updateVehicleState=function(){var ft=this.getDeltaSeconds(),s=this.getGearShiftRatioCount(),v,y,p,o,et,h,st,c,ct,l,at,a,e,rt,ut;if(this.shiftingTime>0&&(this.shiftingTime-=ft,this.shiftingTime<0&&(this.shiftingTime=0)),this._rigidbody!=null&&this.raycastVehicle!=null&&(v=.2,this.forwardSpeed=this.raycastVehicle.getRawCurrentSpeedKph(),Math.abs(this.forwardSpeed)<v&&(this.forwardSpeed=0),this.absoluteSpeed=this.raycastVehicle.getAbsCurrentSpeedKph(),this.absoluteSpeed<v&&(this.absoluteSpeed=0),this.americanSpeed=this.absoluteSpeed*BABYLON.System.Kph2Mph,this.normalizedSpeed=BABYLON.Scalar.Clamp(this.absoluteSpeed/this.topEngineSpeed),this.gearBoxShiftRatios!=null&&this.gearIndex>=0&&this.gearIndex<s)){var yt=Math.min(Math.max(ft,1/200),1),pt=this.wheelRadius*2*BABYLON.System.Meter2Inch,wt=this.gearBoxShiftRatios[this.gearIndex]*this.differentialRatio*this.transmissionRatio;this.downShift=this.gearBoxShiftRanges!=null&&this.gearBoxShiftRanges.length===this.gearBoxShiftRatios.length?this.gearBoxShiftRanges[this.gearIndex]:1e3;this.clutchSlip=BABYLON.Utilities.LerpClamp(this.clutchSlip,0,1-Math.pow(.01,yt));this.engineRPM=this.americanSpeed*wt*336/pt;this.pitchRPM=BABYLON.Utilities.LerpClamp(this.shiftRPM,this.engineRPM,1-this.clutchSlip)+i.MIN_RPM;this.americanSpeed<5?this.gearIndex=0:this.engineRPM>this.gearBoxShiftChange?(this.shiftRPM=this.engineRPM,this.clutchSlip=1,this.shiftingTime=this.gearBoxShiftDelay,this.gearIndex<s-1&&this.gearIndex++):this.engineRPM<this.downShift&&(this.shiftRPM=this.engineRPM,this.clutchSlip=1,this.shiftingTime=0,this.gearIndex>0&&this.gearIndex--);this.gearIndex<0?this.gearIndex=0:this.gearIndex>=s&&(this.gearIndex=s-1)}this.velocityScaling>0&&this._rigidbody!=null&&(this.m_velocityOffset.copyFrom(this._rigidbody.getLinearVelocity()),this.m_velocityOffset.scaleInPlace(this.velocityScaling));y=0;this.playVehicleSounds===!0&&(y=this.getCurrentEnginePitch()*.75);this._engineAudioSource!=null&&(p=this._engineAudioSource.getSoundClip(),p!=null&&p.setPlaybackRate(y));this.smokeDonuts=BABYLON.Scalar.Clamp(this.smokeDonuts,1,10);o=this.smokeIntensity;this.wheelBurnout===!0&&this.wheelDonuts===!0&&(o*=this.smokeDonuts);var t=0,r=0,u=0,f=0;if(this.wheelDriveType===1||this.wheelDriveType===2){if(this.m_frontLeftWheel!=null)if(et=this.m_frontLeftWheel.get_m_raycastInfo().get_m_groundObject()!==0,t=this.updateCurrentSkidInfo(this.m_frontLeftWheel),t<this.skidThreashold&&(t=0),t>0&&et===!0){var w=this.m_frontLeftWheel.get_m_raycastInfo().get_m_contactPointWS(),b=this.m_frontLeftWheel.get_m_raycastInfo().get_m_contactNormalWS(),ot=new BABYLON.Vector3(w.x(),w.y(),w.z()),bt=new BABYLON.Vector3(b.x(),b.y(),b.z()),kt=BABYLON.Scalar.Normalize(t,this.skidThreashold,1);this.velocityScaling>0&&ot.addInPlace(this.m_velocityOffset);this.m_frontLeftWheelSkid=n.SkidmarkManager.AddSkidmarkSegment(ot,bt,kt,this.m_frontLeftWheelSkid);this.frontLeftWheelParticle!=null&&(this.frontLeftWheelParticle.isStarted()===!1&&this.frontLeftWheelParticle.start(),h=t*t,this.frontLeftWheelParticle.emitRate=o*h,this.frontLeftWheelParticle.minSize=.2*h+.2,this.frontLeftWheelParticle.maxSize=1.5*h+1.2)}else this.frontLeftWheelParticle!=null&&(this.frontLeftWheelParticle.emitRate=0),this.m_frontLeftWheelSkid=-1;if(this.m_frontRightWheel!=null)if(st=this.m_frontRightWheel.get_m_raycastInfo().get_m_groundObject()!==0,r=this.updateCurrentSkidInfo(this.m_frontRightWheel),r<this.skidThreashold&&(r=0),r>0&&st===!0){var k=this.m_frontRightWheel.get_m_raycastInfo().get_m_contactPointWS(),d=this.m_frontRightWheel.get_m_raycastInfo().get_m_contactNormalWS(),ht=new BABYLON.Vector3(k.x(),k.y(),k.z()),dt=new BABYLON.Vector3(d.x(),d.y(),d.z()),gt=BABYLON.Scalar.Normalize(r,this.skidThreashold,1);this.velocityScaling>0&&ht.addInPlace(this.m_velocityOffset);this.m_frontRightWheelSkid=n.SkidmarkManager.AddSkidmarkSegment(ht,dt,gt,this.m_frontRightWheelSkid);this.frontRightWheelParticle!=null&&(this.frontRightWheelParticle.isStarted()===!1&&this.frontRightWheelParticle.start(),c=r*r,this.frontRightWheelParticle.emitRate=o*c,this.frontRightWheelParticle.minSize=.2*c+.2,this.frontRightWheelParticle.maxSize=1.5*c+1.2)}else this.frontRightWheelParticle!=null&&(this.frontRightWheelParticle.emitRate=0),this.m_frontRightWheelSkid=-1;(this.wheelBurnout==!0||this.restoreTimer>0)&&(t*=this.burnoutWheelPitch,r*=this.burnoutWheelPitch);t*=.5;r*=.5}if(this.m_backLeftWheel!=null)if(ct=this.m_backLeftWheel.get_m_raycastInfo().get_m_groundObject()!==0,u=this.updateCurrentSkidInfo(this.m_backLeftWheel),u<this.skidThreashold&&(u=0),u>0&&ct===!0){var g=this.m_backLeftWheel.get_m_raycastInfo().get_m_contactPointWS(),nt=this.m_backLeftWheel.get_m_raycastInfo().get_m_contactNormalWS(),lt=new BABYLON.Vector3(g.x(),g.y(),g.z()),ni=new BABYLON.Vector3(nt.x(),nt.y(),nt.z()),ti=BABYLON.Scalar.Normalize(u,this.skidThreashold,1);this.velocityScaling>0&&lt.addInPlace(this.m_velocityOffset);this.m_backLeftWheelSkid=n.SkidmarkManager.AddSkidmarkSegment(lt,ni,ti,this.m_backLeftWheelSkid);this.backLeftWheelParticle!=null&&(this.backLeftWheelParticle.isStarted()===!1&&this.backLeftWheelParticle.start(),l=u*u,this.backLeftWheelParticle.emitRate=o*l,this.backLeftWheelParticle.minSize=.2*l+.2,this.backLeftWheelParticle.maxSize=1.5*l+1.2)}else this.backLeftWheelParticle!=null&&(this.backLeftWheelParticle.emitRate=0),this.m_backLeftWheelSkid=-1;if(this.m_backRightWheel!=null)if(at=this.m_backRightWheel.get_m_raycastInfo().get_m_groundObject()!==0,f=this.updateCurrentSkidInfo(this.m_backRightWheel),f<this.skidThreashold&&(f=0),f>0&&at===!0){var tt=this.m_backRightWheel.get_m_raycastInfo().get_m_contactPointWS(),it=this.m_backRightWheel.get_m_raycastInfo().get_m_contactNormalWS(),vt=new BABYLON.Vector3(tt.x(),tt.y(),tt.z()),ii=new BABYLON.Vector3(it.x(),it.y(),it.z()),ri=BABYLON.Scalar.Normalize(f,this.skidThreashold,1);this.velocityScaling>0&&vt.addInPlace(this.m_velocityOffset);this.m_backRightWheelSkid=n.SkidmarkManager.AddSkidmarkSegment(vt,ii,ri,this.m_backRightWheelSkid);this.backRightWheelParticle!=null&&(this.backRightWheelParticle.isStarted()===!1&&this.backRightWheelParticle.start(),a=f*f,this.backRightWheelParticle.emitRate=o*a,this.backRightWheelParticle.minSize=.2*a+.2,this.backRightWheelParticle.maxSize=1.5*a+1.2)}else this.backRightWheelParticle!=null&&(this.backRightWheelParticle.emitRate=0),this.m_backRightWheelSkid=-1;if((this.wheelBurnout==!0||this.restoreTimer>0)&&(u*=this.burnoutWheelPitch,f*=this.burnoutWheelPitch),e=0,this.playVehicleSounds===!0&&(t>e&&(e=t),r>e&&(e=r),u>e&&(e=u),f>e&&(e=f)),this._skidAudioSource!=null&&(rt=this._skidAudioSource.getSoundClip(),rt!=null&&rt.setPlaybackRate(e)),this.resetVehicleTime>0&&(ut=BABYLON.SceneManager.GetGameTime(),(this.transform.up.y>.5||this.absoluteSpeed>1)&&(this.vehicleResetCheck=ut),ut>this.vehicleResetCheck+this.resetVehicleTime&&(this.transform.position.addInPlace(BABYLON.Vector3.Up().scale(.5)),BABYLON.Utilities.LookRotationToRef(this.transform.forward,BABYLON.Vector3.Up(),this.transform.rotationQuaternion))),this.onUpdateVehicleInformation!=null)this.onUpdateVehicleInformation(t,r,u,f)},i.prototype.destroyVehicleState=function(){this._rigidbody=null;this._engineAudioSource=null;this._skidAudioSource=null;this.m_frontLeftWheel!=null&&(Ammo.destroy(this.m_frontLeftWheel),this.m_frontLeftWheel=null);this.m_frontRightWheel!=null&&(Ammo.destroy(this.m_frontRightWheel),this.m_frontRightWheel=null);this.m_backLeftWheel!=null&&(Ammo.destroy(this.m_backLeftWheel),this.m_backLeftWheel=null);this.m_backRightWheel!=null&&(Ammo.destroy(this.m_backRightWheel),this.m_backRightWheel=null);this.m_physicsWorld=null;this.raycastVehicle=null;this.frontLeftWheelMesh=null;this.frontRightWheelMesh=null;this.backLeftWheelMesh=null;this.backRightWheelMesh=null;this.frontLeftWheelTrans=null;this.frontRightWheelTrans=null;this.backLeftWheelTrans=null;this.backRightWheelTrans=null;this.frontLeftWheelCollider=null;this.frontRightWheelCollider=null;this.backLeftWheelCollider=null;this.backRightWheelCollider=null},i.prototype.drive=function(n,t,i,r,u){var f,c,o,e,l,b;if((i===void 0&&(i=!1),u===void 0&&(u=!0),this.currentForward=BABYLON.Scalar.Clamp(n,-1,1),this.currentTurning=BABYLON.Scalar.Clamp(t,-1,1),this.currentSkidding=i,this.currentDrifting=r,this._rigidbody!=null&&this.raycastVehicle!=null)&&this.FRONT_LEFT>=0&&this.FRONT_RIGHT>=0&&this.BACK_LEFT>=0&&this.BACK_RIGHT>=0){f=this.getDeltaSeconds();this.engineForce=0;this.wheelBrakingForce=0;this.frontWheelPower=0;this.backWheelPower=0;var s=this.getCurrentSkidding()===!0&&this.handBrakingForce>0,k=this.gearBoxShiftRatios!=null&&this.gearBoxShiftRatios.length>this.gearIndex?this.gearBoxShiftRatios[this.gearIndex]:1,d=k*this.differentialRatio*this.transmissionRatio,g=this.getVehicleEngineTorque(this.engineRPM)*Math.abs(this.currentForward),h=g*d,a=BABYLON.Scalar.Lerp(this.minBrakingForce,this.maxBrakingForce,this.normalizedSpeed)*Math.abs(this.currentForward);if(this.currentForward>0&&this.wheelBurnout===!0&&this.wheelDonuts===!0?this.engineForce=h:this.currentForward>0?this.forwardSpeed<-1?this.wheelBrakingForce=a:this.engineForce=h:this.currentForward<0?this.forwardSpeed>1?this.wheelBrakingForce=a:this.engineForce=-(h*this.maxReversePower):(this.engineForce=0,this.wheelBrakingForce=10),c=this.throttleEngineSpeed>0?this.throttleEngineSpeed:this.topEngineSpeed,(this.shiftingTime>0||this.americanSpeed>c)&&(this.engineForce=0),u===!1?(this.americanSpeed>=10?(o=BABYLON.Scalar.Lerp(this.lowSpeedAngle,this.highSpeedAngle,this.normalizedSpeed)*BABYLON.System.Deg2Rad,o*=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed)*100,this.physicsSteerAngle=this.currentTurning*o,this.visualSteerAngle=this.currentTurning*o):(this.physicsSteerAngle=this.currentTurning*this.maxTurnAngle*BABYLON.System.Deg2Rad,this.visualSteerAngle=this.currentTurning*this.maxTurnAngle*BABYLON.System.Deg2Rad),this.overSteerDelay>0&&s===!0&&this.driftingTimer>=this.overSteerDelay&&(this.visualSteerAngle*=-1)):(this.allowedTurningIncement=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed),this.allowedTurningAngle=this.americanSpeed>=10?BABYLON.Scalar.Lerp(this.lowSpeedAngle*BABYLON.System.Deg2Rad,this.highSpeedAngle*BABYLON.System.Deg2Rad,this.normalizedSpeed):this.maxTurnAngle*BABYLON.System.Deg2Rad,this.wheelBurnout===!0&&this.wheelDonuts===!0&&(this.allowedTurningAngle=this.maxBurnAngle*BABYLON.System.Deg2Rad),this.currentTurning>0?this.physicsSteerAngle<this.allowedTurningAngle&&(this.physicsSteerAngle+=this.allowedTurningIncement):this.currentTurning<0?this.physicsSteerAngle>-this.allowedTurningAngle&&(this.physicsSteerAngle-=this.allowedTurningIncement):this.physicsSteerAngle<-this.allowedTurningIncement?this.physicsSteerAngle+=this.allowedTurningIncement:this.physicsSteerAngle>this.allowedTurningIncement?this.physicsSteerAngle-=this.allowedTurningIncement:this.physicsSteerAngle=0,this.wheelBurnout===!0||this.wheelSkidding==!0?(this.allowedTurningAngle=this.maxTurnAngle*BABYLON.System.Deg2Rad,this.allowedTurningIncement=this.lowSpeedTurning):(this.allowedTurningIncement=BABYLON.Scalar.Lerp(this.lowSpeedTurning,this.highSpeedTurning,this.normalizedSpeed),this.allowedTurningAngle=BABYLON.Scalar.Lerp(this.lowSpeedAngle*BABYLON.System.Deg2Rad,this.highSpeedAngle*BABYLON.System.Deg2Rad,this.normalizedSpeed),this.steeringBoost>0&&Math.abs(this.currentTurning)>=.1&&(this.allowedTurningAngle+=this.steeringBoost*BABYLON.System.Deg2Rad)),this.overSteerDelay>0&&s===!0&&this.driftingTimer>=this.overSteerDelay&&(this.currentTurning*=-1),this.currentTurning>0?this.visualSteerAngle<this.allowedTurningAngle&&(this.visualSteerAngle+=this.allowedTurningIncement):this.currentTurning<0?this.visualSteerAngle>-this.allowedTurningAngle&&(this.visualSteerAngle-=this.allowedTurningIncement):this.visualSteerAngle<-this.allowedTurningIncement?this.visualSteerAngle+=this.allowedTurningIncement:this.visualSteerAngle>this.allowedTurningIncement?this.visualSteerAngle-=this.allowedTurningIncement:this.visualSteerAngle=0),e=!0,s===!0)this.wheelBurnout=!1,this.wheelDonuts=!1,this.burnoutTimer=0,this.driftingTimer+=f,this.raycastVehicle.lockedWheelIndexes==null&&(this.raycastVehicle.lockedWheelIndexes=[this.BACK_LEFT,this.BACK_RIGHT]),this.americanSpeed>=5&&this.wheelSkidding===!1&&(this.wheelSkidding=!0,this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.set_m_frictionSlip(this.wheelLockFriction),this.m_frontRightWheel!=null&&this.m_frontRightWheel.set_m_frictionSlip(this.wheelLockFriction),this.m_backLeftWheel!=null&&this.m_backLeftWheel.set_m_frictionSlip(this.wheelLockFriction),this.m_backRightWheel!=null&&this.m_backRightWheel.set_m_frictionSlip(this.wheelLockFriction),e=!1),this.updateCurrentBrakeDamping(this.linearBrakingForce,this.angularBrakingForce),e===!0&&this.updateCurrentFrictionSlip(f*this.driftingLerpSpeed),this.updateCurrentRotationBoost(0),this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_LEFT),this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_RIGHT),this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_LEFT),this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_RIGHT),this.raycastVehicle.setEngineForce(0,this.FRONT_LEFT),this.raycastVehicle.setEngineForce(0,this.FRONT_RIGHT),this.raycastVehicle.setEngineForce(0,this.BACK_LEFT),this.raycastVehicle.setEngineForce(0,this.BACK_RIGHT),this.raycastVehicle.setBrakingForce(0,this.FRONT_LEFT),this.raycastVehicle.setBrakingForce(0,this.FRONT_RIGHT),this.raycastVehicle.setBrakingForce(this.handBrakingForce,this.BACK_LEFT),this.raycastVehicle.setBrakingForce(this.handBrakingForce,this.BACK_RIGHT);else{this.driftingTimer=0;this.wheelSkidding=!1;this.raycastVehicle.lockedWheelIndexes!=null&&(this.raycastVehicle.lockedWheelIndexes=null);this.burnoutCoefficient>0&&(this.burnoutCoefficient=BABYLON.Scalar.Clamp(this.burnoutCoefficient,1,20));this.burnoutTriggerMark>0&&(this.burnoutTriggerMark=BABYLON.Scalar.Clamp(this.burnoutTriggerMark,1,20));var nt=this.americanSpeed<=this.burnoutTriggerMark,v=this.currentForward<-.9||this.currentForward>.9,y=this.currentTurning<-.9||this.currentTurning>.9,p=f*this.defaultLerpSpeed,w=0;this.burnoutTimer<=0&&this.burnoutCoefficient>=1&&nt===!0&&v===!0&&(this.burnoutTimer=this.burnoutTimeDelay*.25,this.wheelDonuts=!1,this.wheelBurnout=!0);this.restoreTimer>0&&(this.restoreTimer-=f,this.restoreTimer<0&&(this.restoreTimer=0),p*=this.burnoutLerpSpeed);this.cooldownTimer>0&&(this.cooldownTimer-=f,this.cooldownTimer<0&&(this.cooldownTimer=0));this.wheelDonuts===!0?(this.donutSpinTime+=f,y===!1&&(this.burnoutTimer=0)):this.donutSpinTime=0;this.burnoutTimer>0&&v===!0?(w=.185,l=this.wheelDonuts===!0?1.25:1,this.burnoutCoefficient>=1&&(this.engineForce*=this.burnoutCoefficient),this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.set_m_frictionSlip(this.wheelBurnFriction*l),this.m_frontRightWheel!=null&&this.m_frontRightWheel.set_m_frictionSlip(this.wheelBurnFriction*l),this.m_backLeftWheel!=null&&this.m_backLeftWheel.set_m_frictionSlip(this.wheelBurnFriction),this.m_backRightWheel!=null&&this.m_backRightWheel.set_m_frictionSlip(this.wheelBurnFriction),e=!1,this.burnoutTimer-=f,this.burnoutTimer<=0&&this.cooldownTimer<=0&&y===!0&&this.currentForward>0&&this.currentDrifting===!0&&(this.burnoutTimer=.01,this.wheelDonuts=!0)):(this.burnoutTimer=0,this.donutSpinTime=0,this.wheelDonuts===!0&&(this.wheelDonuts=!1,this.cooldownTimer=this.burnoutTimeDelay*2),this.wheelBurnout===!0&&(this.wheelBurnout=!1,this.restoreTimer=this.burnoutTimeDelay*.75));this.wheelBurnout===!0&&this.wheelDonuts===!0?this.frontWheelPower=this.engineForce*.2:(this.wheelDriveType===1||this.wheelDriveType===2)&&(this.frontWheelPower=this.engineForce);(this.wheelDriveType===0||this.wheelDriveType===2)&&(this.backWheelPower=this.engineForce);this.getCurrentBraking()===!0?this.updateCurrentBrakeDamping(this.linearBrakingForce,this.angularBrakingForce):this.updateCurrentBrakeDamping(this.linearDamping,this.angularDamping);e===!0&&this.updateCurrentFrictionSlip(p);this.updateCurrentRotationBoost(w);this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_LEFT);this.raycastVehicle.setVisualSteeringAngle(this.visualSteerAngle,this.FRONT_RIGHT);this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_LEFT);this.raycastVehicle.setPhysicsSteeringAngle(this.physicsSteerAngle,this.FRONT_RIGHT);this.raycastVehicle.setEngineForce(this.frontWheelPower,this.FRONT_LEFT);this.raycastVehicle.setEngineForce(this.frontWheelPower,this.FRONT_RIGHT);this.raycastVehicle.setEngineForce(this.backWheelPower,this.BACK_LEFT);this.raycastVehicle.setEngineForce(this.backWheelPower,this.BACK_RIGHT);this.raycastVehicle.setBrakingForce(this.wheelBrakingForce*this.maxFrontBraking,this.FRONT_LEFT);this.raycastVehicle.setBrakingForce(this.wheelBrakingForce*this.maxFrontBraking,this.FRONT_RIGHT);this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.BACK_LEFT);this.raycastVehicle.setBrakingForce(this.wheelBrakingForce,this.BACK_RIGHT)}b="Car Speed: "+this.americanSpeed.toFixed(1)+" --> Gear Index: "+this.gearIndex.toFixed(0)+" --> Engine RPM: "+this.engineRPM.toFixed(0)+" --> Speed Throttle: "+c.toFixed(0);BABYLON.Utilities.PrintToScreen(b,"#008000")}},i.prototype.getVehicleEngineTorque=function(n){var t=0;return this.engineTorqueCurve!=null&&(t=BABYLON.Utilities.FastFloatInterpolate(this.engineTorqueCurve,BABYLON.Scalar.Clamp(n,i.MIN_RPM,i.MAX_RPM),0,0)*this.powerCoefficient),t},i.prototype.createSmokeParticleSystem=function(n,t){var i=new BABYLON.ParticleSystem(n,1e4,this.scene);return i.blendMode=BABYLON.ParticleSystem.BLENDMODE_STANDARD,i.particleTexture=this.smokeTexture,i.emitter=t,i.emitRate=0,i.updateSpeed=.01,i.minSize=.2,i.maxSize=1.3,i.minAngularSpeed=-1.5,i.maxAngularSpeed=1.5,i.minLifeTime=3,i.maxLifeTime=5,i.addVelocityGradient(0,1),i.addVelocityGradient(.1,.7),i.addVelocityGradient(.7,.2),i.addVelocityGradient(1,.05),i.gravity=new BABYLON.Vector3(0,-.1,0),i.minEmitBox=new BABYLON.Vector3(0,-.25,0),i.maxEmitBox=new BABYLON.Vector3(0,-.25,0),i.direction1=new BABYLON.Vector3(-1,-1,-1),i.direction2=new BABYLON.Vector3(1,1,1),i.color1=new BABYLON.Color4(.95,.95,.95,this.smokeOpacity),i.color2=new BABYLON.Color4(.85,.85,.85,this.smokeOpacity),i.colorDead=new BABYLON.Color4(.9,.9,.9,this.smokeOpacity*.5),i},i.prototype.updateCurrentSkidInfo=function(n){var t=BABYLON.Scalar.Clamp(1-n.get_m_skidInfo()),i=this.getCurrentBraking(),r=i===!0&&this.currentForward<=-this.footBrakingThreashold;return this.skidWhenFootBraking===!0&&r===!0&&this.americanSpeed>=this.footSkidBrakingSpeed&&(t=BABYLON.Scalar.Clamp(0,1,this.normalizedSpeed*this.footSkidBrakingFactor)),t},i.prototype.updateCurrentBrakeDamping=function(n,t){this._rigidbody!=null&&this._rigidbody.setDamping(n,t)},i.prototype.updateCurrentRotationBoost=function(n){(this.wheelDriveType===1||this.wheelDriveType===2)&&(this.m_frontLeftWheel!=null&&(this.m_frontLeftWheel.rotationBoost=n),this.m_frontRightWheel!=null&&(this.m_frontRightWheel.rotationBoost=n));(this.wheelDriveType===0||this.wheelDriveType===2)&&(this.m_backLeftWheel!=null&&(this.m_backLeftWheel.rotationBoost=n),this.m_backRightWheel!=null&&(this.m_backRightWheel.rotationBoost=n))},i.prototype.updateCurrentFrictionSlip=function(n){var t,i,r,u;this.m_frontLeftWheel!=null&&this.m_frontLeftWheel.defaultFriction!=null&&(t=this.m_frontLeftWheel.get_m_frictionSlip(),t<this.m_frontLeftWheel.defaultFriction?(t=BABYLON.Scalar.Lerp(t,this.m_frontLeftWheel.defaultFriction,n),this.m_frontLeftWheel.set_m_frictionSlip(t)):t>this.m_frontLeftWheel.defaultFriction&&this.m_frontLeftWheel.set_m_frictionSlip(this.m_frontLeftWheel.defaultFriction));this.m_frontRightWheel!=null&&this.m_frontRightWheel.defaultFriction!=null&&(i=this.m_frontRightWheel.get_m_frictionSlip(),i!==this.m_frontRightWheel.defaultFriction?(i=BABYLON.Scalar.Lerp(i,this.m_frontRightWheel.defaultFriction,n),this.m_frontRightWheel.set_m_frictionSlip(i)):i>this.m_frontRightWheel.defaultFriction&&this.m_frontRightWheel.set_m_frictionSlip(this.m_frontRightWheel.defaultFriction));this.m_backLeftWheel!=null&&this.m_backLeftWheel.defaultFriction!=null&&(r=this.m_backLeftWheel.get_m_frictionSlip(),r!==this.m_backLeftWheel.defaultFriction?(r=BABYLON.Scalar.Lerp(r,this.m_backLeftWheel.defaultFriction,n),this.m_backLeftWheel.set_m_frictionSlip(r)):r>this.m_backLeftWheel.defaultFriction&&this.m_backLeftWheel.set_m_frictionSlip(this.m_backLeftWheel.defaultFriction));this.m_backRightWheel!=null&&this.m_backRightWheel.defaultFriction!=null&&(u=this.m_backRightWheel.get_m_frictionSlip(),u!==this.m_backRightWheel.defaultFriction?(u=BABYLON.Scalar.Lerp(u,this.m_backRightWheel.defaultFriction,n),this.m_backRightWheel.set_m_frictionSlip(u)):u>this.m_backRightWheel.defaultFriction&&this.m_backRightWheel.set_m_frictionSlip(this.m_backRightWheel.defaultFriction))},i.MIN_RPM=1e3,i.MAX_RPM=6e3,i}(BABYLON.ScriptComponent);n.StandardCarController=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){var u,f;return r===void 0&&(r={}),u=n.call(this,t,i,r)||this,u.playerDeltaX=0,u.playerDeltaY=0,u.playerMouseX=0,u.playerMouseY=0,u.avoidancePath=0,u.avoidanceTime=0,u.targetPosition=BABYLON.Vector3.Zero(),u.targetRotation=BABYLON.Quaternion.Zero(),u.waypointIndex=0,u.lastMovementTime=0,u.showRabbitChasing=!1,u.showTriggerVolume=!1,u.circuitSpeedLimit=0,u.drawRabbitTracker=!1,u.rabbitTrackerLine=null,u.rabbitTrackerColor=new BABYLON.Color3(0,0,0),u.targetAngles=new BABYLON.Vector3(0,0,0),u.transformAngles=new BABYLON.Vector3(0,0,0),u.positionBuffer=new BABYLON.Vector3(0,0,0),u.rotationBuffer=new BABYLON.Quaternion(0,0,0,1),u.tempRotationBuffer=new BABYLON.Vector3(0,0,0),u.localTargetPosition=new BABYLON.Vector3(0,0,0),u.localTargetAvoidance=new BABYLON.Vector3(0,0,0),u.playerNumber=BABYLON.PlayerNumber.One,u.triggerForward=BABYLON.Xbox360Trigger.Right,u.keyboardForawrd=BABYLON.UserInputKey.W,u.auxKeyboardForawrd=BABYLON.UserInputKey.UpArrow,u.triggerBackwards=BABYLON.Xbox360Trigger.Left,u.keyboardBackwards=BABYLON.UserInputKey.S,u.auxKeyboardBackwards=BABYLON.UserInputKey.DownArrow,u.buttonHandbrake=BABYLON.Xbox360Button.X,u.keyboardHandbrake=BABYLON.UserInputKey.SpaceBar,u.buttonDonuts=BABYLON.Xbox360Button.B,u.keyboardDonuts=BABYLON.UserInputKey.Shift,u.enableInput=!1,u.attachCamera=!1,u.followBehind=!1,u.followDistance=5,u.followHeight=1.65,u.heightOffset=0,u.heightDamping=3,u.rotationDamping=3,u.assistedSteering=!0,u.useTriggerVolume=!1,u.donutCameraLock=new BABYLON.Vector3(0,.5,7.5),u.triggerVolumePos=new BABYLON.Vector3(0,0,0),u.triggerVolumeSize=new BABYLON.Vector3(1,1,1),u.minCircuitSpeed=80,u.maxCircuitSpeed=85,u.chaseRabbitSpeed=1,u.waypointThreashold=1,u.wanderingDistance=1,u.avoidOthersTimer=.1,u.driverLookAhead=15,u.brakingMultiplier=6,u.brakingSensitivity=1,u.steeringSensitivity=1,u.throttleSensitivity=1,u.throttleSpeedAngle=5,u.brakingSpeedAngle=10,u.skiddingSpeedAngle=20,u.throttleSpeedLimit=5,u.brakingSpeedLimit=25,u.skiddingSpeedLimit=50,u.resetMovingTimeout=5,u.m_chaseRabbitMesh=null,u.m_triggerVolumeMesh=null,u.m_cameraTransform=null,u.m_circuitWaypoints=null,u.m_rigidbodyPhysics=null,u.m_standardCarController=null,u.lastSteeringAngle=0,u.enableInput=u.getEditorProperty("enableInput",u.enableInput),u.playerNumber=u.getEditorProperty("playerNumber",u.playerNumber),u.attachCamera=u.getEditorProperty("attachCamera",u.attachCamera),u.followBehind=u.getEditorProperty("followBehind",u.followBehind),u.followDistance=u.getEditorProperty("followDistance",u.followDistance),u.followHeight=u.getEditorProperty("followHeight",u.followHeight),u.heightOffset=u.getEditorProperty("heightOffset",u.heightOffset),u.heightDamping=u.getEditorProperty("heightDamping",u.heightDamping),u.rotationDamping=u.getEditorProperty("rotationDamping",u.rotationDamping),u.assistedSteering=u.getEditorProperty("useAssistedSteering",u.assistedSteering),u.showRabbitChasing=u.getEditorProperty("showRabbitChasing",u.showRabbitChasing),u.showTriggerVolume=u.getEditorProperty("showTriggerVolume",u.showTriggerVolume),u.useTriggerVolume=u.getEditorProperty("useTriggerVolume",u.useTriggerVolume),u.triggerVolumePos=BABYLON.Utilities.ParseVector3(u.getEditorProperty("triggerVolumePos"),u.triggerVolumePos),u.triggerVolumeSize=BABYLON.Utilities.ParseVector3(u.getEditorProperty("triggerVolumeSize"),u.triggerVolumeSize),u.driverLookAhead=u.getEditorProperty("driverLookAhead",u.driverLookAhead),u.chaseRabbitSpeed=u.getEditorProperty("chaseRabbitSpeed",u.chaseRabbitSpeed),u.waypointThreashold=u.getEditorProperty("waypointThreashold",u.waypointThreashold),u.brakingMultiplier=u.getEditorProperty("brakingMultiplier",u.brakingMultiplier),u.brakingSensitivity=u.getEditorProperty("brakingSensitivity",u.brakingSensitivity),u.steeringSensitivity=u.getEditorProperty("steeringSensitivity",u.steeringSensitivity),u.throttleSensitivity=u.getEditorProperty("throttleSensitivity",u.throttleSensitivity),u.throttleSpeedAngle=u.getEditorProperty("throttleSpeedAngle",u.throttleSpeedAngle),u.brakingSpeedAngle=u.getEditorProperty("brakingSpeedAngle",u.brakingSpeedAngle),u.skiddingSpeedAngle=u.getEditorProperty("skiddingSpeedAngle",u.skiddingSpeedAngle),u.throttleSpeedLimit=u.getEditorProperty("throttleSpeedLimit",u.throttleSpeedLimit),u.brakingSpeedLimit=u.getEditorProperty("brakingSpeedLimit",u.brakingSpeedLimit),u.skiddingSpeedLimit=u.getEditorProperty("skiddingSpeedLimit",u.skiddingSpeedLimit),u.minCircuitSpeed=u.getEditorProperty("minCircuitSpeed",u.minCircuitSpeed),u.maxCircuitSpeed=u.getEditorProperty("maxCircuitSpeed",u.maxCircuitSpeed),u.wanderingDistance=u.getEditorProperty("wanderingDistance",u.wanderingDistance),u.avoidOthersTimer=u.getEditorProperty("avoidOthersTimer",u.avoidOthersTimer),u.resetMovingTimeout=u.getEditorProperty("resetMovingTimeout",u.resetMovingTimeout),u.throttleSensitivity<=0&&(u.throttleSensitivity=1),u.steeringSensitivity<=0&&(u.steeringSensitivity=1),u.brakingSensitivity<=0&&(u.brakingSensitivity=1),u.brakingMultiplier<=0&&(u.brakingMultiplier=6),u.wanderingDistance<=0&&(u.wanderingDistance=.5),u.avoidOthersTimer<=0&&(u.brakingMultiplier=.1),f=u.getEditorProperty("donutCameraLock"),f!=null&&(u.donutCameraLock=BABYLON.Utilities.ParseVector3(f)),console.log("Donut Camera Lock: "+u.donutCameraLock),u}return __extends(t,n),t.prototype.getPlayerDeltaX=function(){return this.playerDeltaX},t.prototype.getPlayerDeltaY=function(){return this.playerDeltaY},t.prototype.getPlayerMouseX=function(){return this.playerMouseX},t.prototype.getPlayerMouseY=function(){return this.playerMouseY},t.prototype.getWaypointIndex=function(){return this.waypointIndex},t.prototype.getChaseRabbitMesh=function(){return this.m_chaseRabbitMesh},t.prototype.resetChaseRabbitMesh=function(){this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.position=this.transform.position.clone(),this.m_chaseRabbitMesh.rotationQuaternion=this.transform.rotationQuaternion.clone())},t.prototype.start=function(){this.initVehicleController()},t.prototype.update=function(){this.updateVehicleController()},t.prototype.destroy=function(){this.destroyVehicleController()},t.prototype.initVehicleController=function(){var n=this,i,t;this.m_rigidbodyPhysics=this.getComponent("BABYLON.RigidbodyPhysics");this.m_rigidbodyPhysics!=null?(this.m_rigidbodyPhysics.registerOnCollisionEnter(function(n){var t=BABYLON.SceneManager.GetTransformTag(n);t==="Vehicle"}),this.m_rigidbodyPhysics.registerOnCollisionStay(function(t){var r,i,u;t!=null&&(r=BABYLON.SceneManager.GetTransformTag(t),r==="Vehicle"&&(i=BABYLON.Utilities.InverseTransformPoint(n.transform,t.getAbsolutePosition()),u=Math.atan2(i.x,i.z)*BABYLON.System.Rad2Deg,n.avoidancePath=n.wanderingDistance*-Math.sign(u),n.avoidanceTime=n.getGameTime()+n.avoidOthersTimer))}),this.m_rigidbodyPhysics.registerOnCollisionExit(function(n){if(n!=null){var t=BABYLON.SceneManager.GetTransformTag(n);t==="Vehicle"}})):BABYLON.Tools.Warn("Null rigidbody physics for: "+this.transform.name);this.m_standardCarController=this.getComponent("PROJECT.StandardCarController");this.m_standardCarController!=null?(this.m_standardCarController.playVehicleSounds=!0,this.m_standardCarController.onUpdateVehicleInformation=function(){}):BABYLON.Tools.Warn("Null standard car controller for: "+this.transform.name);this.attachCamera===!0&&(this.m_cameraTransform=BABYLON.SceneManager.GetTransformNode(this.scene,"Main Camera"),this.m_cameraTransform!=null&&BABYLON.Utilities.ValidateTransformQuaternion(this.m_cameraTransform));i=BABYLON.SceneManager.GetTransformNode(this.scene,"Waypoints");i!=null&&(t=BABYLON.SceneManager.FindScriptComponent(i,"PROJECT.WaypointManager"),t!=null&&(this.waypointIndex=0,this.circuitSpeedLimit=this.maxCircuitSpeed,this.drawRabbitTracker=t.drawTraces,this.rabbitTrackerColor=t.traceColor,this.m_circuitWaypoints=t.getSplineCurvePositions()));this.updateVehicleFollowCamera(this.followBehind,!0)},t.prototype.updateVehicleController=function(){var n=this,e,t;if(this.useTriggerVolume===!0){if(this.m_triggerVolumeMesh==null){this.m_triggerVolumeMesh=BABYLON.MeshBuilder.CreateBox(this.transform.name+".TriggerVolumer",{size:this.triggerVolumeSize.z,width:this.triggerVolumeSize.x,height:this.triggerVolumeSize.y},this.scene);this.m_triggerVolumeMesh.position.copyFrom(this.triggerVolumePos);this.m_triggerVolumeMesh.rotationQuaternion=this.transform.rotationQuaternion!=null?this.transform.rotationQuaternion.clone():new BABYLON.Quaternion(0,0,0,1);this.m_triggerVolumeMesh.checkCollisions=!1;this.m_triggerVolumeMesh.receiveShadows=!1;this.m_triggerVolumeMesh.visibility=.25;this.m_triggerVolumeMesh.isVisible=!1;var i=0,r=0,u=.05,f=.6;BABYLON.Utilities.ValidateTransformMetadata(this.m_triggerVolumeMesh);this.m_triggerVolumeMesh.metadata.unity.physics=BABYLON.RigidbodyPhysics.CreatePhysicsMetadata(i,r,u,new BABYLON.Vector3(0,0,0));this.m_triggerVolumeMesh.metadata.unity.collision=BABYLON.RigidbodyPhysics.CreateCollisionMetadata("BoxCollider",!0,!1,0,f,f);e=BABYLON.RigidbodyPhysics.CreatePhysicsProperties(i,r,u,!0,!0);BABYLON.RigidbodyPhysics.SetupPhysicsComponent(this.scene,this.m_triggerVolumeMesh);t=new BABYLON.RigidbodyPhysics(this.m_triggerVolumeMesh,this.scene,e);BABYLON.SceneManager.RegisterScriptComponent(t,!0);t.registerOnCollisionEnter(function(t){n.useTriggerVolume===!0&&t.name!==n.transform.name});t.registerOnCollisionStay(function(t){n.useTriggerVolume===!0&&t.name!==n.transform.name});t.registerOnCollisionExit(function(t){n.useTriggerVolume===!0&&t.name!==n.transform.name})}this.m_triggerVolumeMesh!=null&&(this.m_triggerVolumeMesh.isVisible===!0&&this.showTriggerVolume===!1&&(this.m_triggerVolumeMesh.isVisible=!1),this.m_triggerVolumeMesh.isVisible===!1&&this.showTriggerVolume===!0&&(this.m_triggerVolumeMesh.isVisible=!0),this.m_triggerVolumeMesh.position.copyFrom(this.transform.position),this.m_triggerVolumeMesh.position.addInPlace(this.triggerVolumePos),this.transform.rotationQuaternion!=null&&(this.m_triggerVolumeMesh.rotationQuaternion==null?this.m_triggerVolumeMesh.rotationQuaternion=this.transform.rotationQuaternion.clone():this.m_triggerVolumeMesh.rotationQuaternion.copyFrom(this.transform.rotationQuaternion)))}this.enableInput===!0&&(this.playerNumber===0?this.updateAutoPilotDrive():this.updateManualInputDrive());this.updateVehicleFollowCamera(this.followBehind,!0)},t.prototype.updateManualInputDrive=function(){if(this.m_standardCarController!=null){this.playerDeltaX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Horizontal,this.playerNumber);this.playerDeltaY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.Vertical,this.playerNumber);this.playerMouseX=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseX,this.playerNumber);this.playerMouseY=BABYLON.SceneManager.GetUserInput(BABYLON.UserInputAxis.MouseY,this.playerNumber);Math.abs(this.playerDeltaX)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerDeltaX=0);Math.abs(this.playerDeltaY)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerDeltaY=0);Math.abs(this.playerMouseX)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerMouseX=0);Math.abs(this.playerMouseY)<=BABYLON.UserInputOptions.GamepadDeadStickValue&&(this.playerMouseY=0);var e=BABYLON.SceneManager.GetKeyboardInput(this.auxKeyboardForawrd),o=BABYLON.SceneManager.GetKeyboardInput(this.keyboardForawrd),t=BABYLON.SceneManager.GetGamepadTriggerInput(this.triggerForward,this.playerNumber),s=BABYLON.SceneManager.GetKeyboardInput(this.auxKeyboardBackwards),h=BABYLON.SceneManager.GetKeyboardInput(this.keyboardBackwards),i=BABYLON.SceneManager.GetGamepadTriggerInput(this.triggerBackwards,this.playerNumber),c=BABYLON.SceneManager.GetKeyboardInput(this.keyboardHandbrake),l=BABYLON.SceneManager.GetGamepadButtonInput(this.buttonHandbrake,this.playerNumber),a=BABYLON.SceneManager.GetKeyboardInput(this.keyboardDonuts),v=BABYLON.SceneManager.GetGamepadButtonInput(this.buttonDonuts,this.playerNumber),n=0,r=0,u=!1,f=!1,y=this.assistedSteering;t>.2?n=t:this.playerNumber===BABYLON.PlayerNumber.One&&(o===!0||e===!0)&&(n=1);i>.2?n=-i:this.playerNumber===BABYLON.PlayerNumber.One&&(h===!0||s===!0)&&(n=-1);r=this.playerDeltaX;u=c===!0||l===!0;f=a===!0||v===!0;this.m_standardCarController.throttleEngineSpeed=0;this.m_standardCarController.drive(n,r,u,f,y)}},t.prototype.updateAutoPilotDrive=function(){var f=this.getGameTime(),o;if(this.m_chaseRabbitMesh==null&&(this.m_chaseRabbitMesh=BABYLON.MeshBuilder.CreateSphere(this.transform.name+".Rabbit",{segments:24,diameter:2},this.scene),this.m_chaseRabbitMesh.checkCollisions=!1,this.m_chaseRabbitMesh.receiveShadows=!1,this.m_chaseRabbitMesh.visibility=.5,this.m_chaseRabbitMesh.isVisible=!1,this.resetChaseRabbitMesh()),this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.isVisible===!0&&this.showRabbitChasing===!1&&(this.m_chaseRabbitMesh.isVisible=!1),this.m_chaseRabbitMesh.isVisible===!1&&this.showRabbitChasing===!0&&(this.m_chaseRabbitMesh.isVisible=!0)),this.m_standardCarController!=null&&this.m_standardCarController.getAbsoluteSpeed()>=1&&(this.lastMovementTime=f),this.m_standardCarController!=null&&this.m_circuitWaypoints!=null&&this.m_chaseRabbitMesh!=null){var e=this.m_circuitWaypoints[this.waypointIndex],h=this.transform.getAbsolutePosition(),i=this.m_chaseRabbitMesh.getAbsolutePosition(),c=BABYLON.Vector3.Distance(h,i);c<=this.driverLookAhead&&(this.m_chaseRabbitMesh.lookAt(e),this.m_chaseRabbitMesh.translate(BABYLON.Axis.Z,this.chaseRabbitSpeed));o=BABYLON.Vector3.Distance(i,e);o<=this.waypointThreashold&&(this.waypointIndex++,this.waypointIndex>=this.m_circuitWaypoints.length&&(this.waypointIndex=0));BABYLON.Utilities.InverseTransformPointToRef(this.transform,i,this.localTargetPosition);this.avoidanceTime=0;this.avoidancePath=0;f>this.lastMovementTime+this.resetMovingTimeout;var l=Math.atan2(this.localTargetPosition.x,this.localTargetPosition.z)*BABYLON.System.Rad2Deg,a=this.m_standardCarController.getNormalizedSpeed(),r=this.m_standardCarController.getAmericanSpeed(),t=BABYLON.Scalar.Clamp(Math.abs(l),0,90),s=t/90,n=0,u=1*this.throttleSensitivity,v=BABYLON.Scalar.Clamp(this.localTargetPosition.x/this.localTargetPosition.length()*this.steeringSensitivity,-1,1);this.throttleSpeedAngle>0&&t>=this.throttleSpeedAngle&&r>=this.throttleSpeedLimit&&(u=BABYLON.Scalar.Lerp(0,1*this.throttleSensitivity,1-s));this.brakingSpeedAngle>0&&t>=this.brakingSpeedAngle&&r>=this.brakingSpeedLimit&&(n=BABYLON.Scalar.Lerp(0,1+a,s),n*=this.brakingSensitivity*this.brakingMultiplier,n=BABYLON.Scalar.Clamp(n,0,1));this.skiddingSpeedAngle>0&&t>=this.skiddingSpeedAngle&&r>=this.skiddingSpeedLimit;n>0&&(u=-n);this.m_standardCarController.throttleEngineSpeed=this.circuitSpeedLimit;this.m_standardCarController.drive(u,v,!1,!1,!1)}},t.prototype.updateVehicleFollowCamera=function(n,t){var i;if(this.enableInput===!0&&this.attachCamera===!0&&this.m_cameraTransform!=null&&this.m_rigidbodyPhysics!=null){if(i=this.getDeltaSeconds(),this.m_rigidbodyPhysics.getTransformPositionToRef(this.targetPosition),this.m_rigidbodyPhysics.getTransformRotationToRef(this.targetRotation),n===!0){BABYLON.Utilities.ToEulerToRef(this.targetRotation,this.targetAngles);BABYLON.Utilities.ToEulerToRef(this.m_cameraTransform.rotationQuaternion,this.transformAngles);var f=this.targetAngles.y,e=this.targetPosition.y+this.followHeight,r=this.transformAngles.y,u=this.m_cameraTransform.position.y;r=BABYLON.Scalar.LerpAngle(r,f,this.rotationDamping*i);u=BABYLON.Scalar.Lerp(u,e,this.heightDamping*i);BABYLON.Utilities.FromEulerToRef(0,r,0,this.rotationBuffer);BABYLON.Utilities.MultiplyQuaternionByVectorToRef(this.rotationBuffer,BABYLON.Vector3.Forward(),this.tempRotationBuffer);this.tempRotationBuffer.scaleInPlace(this.followDistance);this.positionBuffer.copyFrom(this.targetPosition);this.positionBuffer.subtractInPlace(this.tempRotationBuffer);this.m_cameraTransform.position.set(this.positionBuffer.x,u+this.heightOffset,this.positionBuffer.z)}t===!0&&this.m_cameraTransform.lookAt(this.targetPosition)}},t.prototype.destroyVehicleController=function(){this.targetAngles=null;this.targetPosition=null;this.targetRotation=null;this.transformAngles=null;this.positionBuffer=null;this.rotationBuffer=null;this.tempRotationBuffer=null;this.m_cameraTransform=null;this.m_circuitWaypoints=null;this.m_rigidbodyPhysics=null;this.m_chaseRabbitMesh!=null&&(this.m_chaseRabbitMesh.dispose(),this.m_chaseRabbitMesh=null);this.m_standardCarController=null;this.m_triggerVolumeMesh!=null&&(this.m_triggerVolumeMesh.dispose(),this.m_triggerVolumeMesh=null)},t}(BABYLON.ScriptComponent);n.VehicleInputController=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.rotateSpeed=1,u.rotateSpeed=u.getEditorProperty("rotateSpeed",u.rotateSpeed),u}return __extends(t,n),t.prototype.start=function(){console.log("===> Starting item rotator for: "+this.transform.name)},t.prototype.update=function(){var n=this.getDeltaSeconds();this.transform.addRotation(0,this.rotateSpeed*n,0)},t.prototype.destroy=function(){console.log("===> Destroying item rotator for: "+this.transform.name)},t}(BABYLON.ScriptComponent);n.ItemRotator=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.animator=null,u}return __extends(t,n),t.prototype.start=function(){console.log("===> Starting animation test for: "+this.transform.name);this.animator=this.getComponent("BABYLON.AnimationState");this.animator==null&&BABYLON.Tools.Warn("Failed to get animation state component: "+this.transform.name)},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.TestAnimation=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){return r===void 0&&(r={}),n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.start=function(){var n=this.getComponent("BABYLON.RigidbodyPhysics");console.warn("### FINAL COM ###");console.log(n.centerOfMass)},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.TestCenter=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.rigidbody=null,u}return __extends(t,n),t.prototype.start=function(){var n=this;console.log("Test collision for: "+this.transform.name);this.rigidbody=this.getComponent("BABYLON.RigidbodyPhysics");this.rigidbody!=null?(this.rigidbody.registerOnCollisionEnter(function(t){var i=BABYLON.SceneManager.GetTransformTag(t);console.log("###: "+n.transform.name+": Begin Contact With: "+t.name)}),this.rigidbody.registerOnCollisionStay(function(n){var t=BABYLON.SceneManager.GetTransformTag(n)}),this.rigidbody.registerOnCollisionExit(function(t){var i=BABYLON.SceneManager.GetTransformTag(t);console.warn("###: "+n.transform.name+": End Contact With: "+t.name)})):console.warn("Failed to locate rigidbody component for: "+this.transform.name)},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.TestCollision=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){r===void 0&&(r={});var u=n.call(this,t,i,r)||this;return u.testTexture=null,u.m_physicsWorld=null,u.m_physicsEngine=null,u.ran=!1,u.testTexture=u.getEditorProperty("testTexture",u.testTexture),u}return __extends(t,n),t.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return console.log("===> Starting test controller..."),this.m_physicsWorld=BABYLON.SceneManager.GetPhysicsWorld(this.scene),this.m_physicsEngine=BABYLON.SceneManager.GetPhysicsEngine(this.scene),[2]})})},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.TestController=t}(PROJECT||(PROJECT={})),function(n){var t=function(n){function t(t,i,r){return r===void 0&&(r={}),n.call(this,t,i,r)||this}return __extends(t,n),t.prototype.start=function(){},t.prototype.update=function(){},t.prototype.after=function(){},t.prototype.destroy=function(){},t}(BABYLON.ScriptComponent);n.WTFComp=t}(PROJECT||(PROJECT={}))

// Project Data Store
if (navigator.dataStore == null) navigator.dataStore = {};

navigator.dataStore['manifest'] = JSON.parse(window.atob("ewogICJuYW1lIjogIiMjI1RJVExFIyMjIiwKICAic2hvcnRfbmFtZSI6ICIjIyNTSE9SVCMjIyIsCiAgInRoZW1lX2NvbG9yIjogIiMjI1NQTEFTSCMjIyIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIyMjU1BMQVNIIyMjIiwKICAib3JpZW50YXRpb24iOiAiIyMjT1JJRU5UIyMjIiwgIAogICJkaXNwbGF5IjogIiMjI0RJU1BMQVkjIyMiLAogICJzdGFydF91cmwiOiAiIyMjU1RBUlQjIyMiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJpY29ucy9pY29uLTcyeDcyLnBuZyIsCiAgICAgICJzaXplcyI6ICI3Mng3MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaWNvbnMvaWNvbi05Nng5Ni5wbmciLAogICAgICAic2l6ZXMiOiAiOTZ4OTYiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9LAogICAgewogICAgICAic3JjIjogImljb25zL2ljb24tMTI4eDEyOC5wbmciLAogICAgICAic2l6ZXMiOiAiMTI4eDEyOCIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaWNvbnMvaWNvbi0xNDR4MTQ0LnBuZyIsCiAgICAgICJzaXplcyI6ICIxNDR4MTQ0IiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJpY29ucy9pY29uLTE1MngxNTIucG5nIiwKICAgICAgInNpemVzIjogIjE1MngxNTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9LAogICAgewogICAgICAic3JjIjogImljb25zL2ljb24tMTkyeDE5Mi5wbmciLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaWNvbnMvaWNvbi0zODR4Mzg0LnBuZyIsCiAgICAgICJzaXplcyI6ICIzODR4Mzg0IiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJpY29ucy9pY29uLTUxMng1MTIucG5nIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9CiAgXQp9"));


// Project Shader Store
// Project Shader Chunks
